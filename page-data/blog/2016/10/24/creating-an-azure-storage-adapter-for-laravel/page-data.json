{
    "componentChunkName": "component---src-templates-post-tsx",
    "path": "/blog/2016/10/24/creating-an-azure-storage-adapter-for-laravel/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Matthew Daly","siteUrl":"https://matthewdaly.co.uk"}},"mdx":{"id":"267d714c-0d79-53a2-8aba-febc628a059c","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Creating an Azure storage adapter for Laravel\",\n  \"date\": \"2016-10-24 00:25:27 +0100\",\n  \"layout\": \"post\",\n  \"categories\": [\"php\", \"laravel\"],\n  \"comments\": true\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"UPDATE: This post has now been superseded by \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/blog/2017/10/29/an-azure-filesystem-integration-for-laravel/\"\n  }, \"this one\"), \" as I've released this integration as a package.\"), mdx(\"p\", null, \"About a year ago I was working on my first non-trivial Laravel application. The client had, for their own reasons, wanted to use Microsoft's Azure platform, particularly for its blob storage functionality, which is somewhat comparable to Amazon S3. Now, Laravel has the excellent \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Storage\"), \" facade  that allows consistent access to both local files and those stored on various file hosting services, which is built on top of \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://flysystem.thephpleague.com/\"\n  }, \"Flysystem\"), \". Flysystem has an Azure driver, but the Laravel storage doesn't include support for it, so at the time I resigned myself to using Flysystem directly, which wasn't actually that bad, but not ideal.\"), mdx(\"p\", null, \"A few days ago I stumbled across \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://laravel.com/docs/5.1/filesystem#custom-filesystems\"\n  }, \"this section of the Laravel documentation\"), \", which had me kicking myself. It's actually trivially easy to implement a custom filesystem for Laravel if it already has a Flysystem adapter, as demonstrated in their Dropbox implementation in the docs. Using this as a guide, I was able to produce the following service provider for using Azure as a storage backend very quickly:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-php\"\n  }, \"<?php\\n\\nnamespace App\\\\Providers;\\n\\nuse Storage;\\nuse League\\\\Flysystem\\\\Filesystem;\\nuse Illuminate\\\\Support\\\\ServiceProvider;\\nuse League\\\\Flysystem\\\\Azure\\\\AzureAdapter;\\nuse WindowsAzure\\\\Common\\\\ServicesBuilder;\\n\\nclass AzureStorageServiceProvider extends ServiceProvider\\n{\\n    /**\\n     * Perform post-registration booting of services.\\n     *\\n     * @return void\\n     */\\n    public function boot()\\n    {\\n        Storage::extend('azure', function($app, $config) {\\n            $endpoint = sprintf(\\n                'DefaultEndpointsProtocol=https;AccountName=%s;AccountKey=%s',\\n                $config['name'],\\n                $config['key']\\n            );\\n\\n            $blobRestProxy = ServicesBuilder::getInstance()->createBlobService($endpoint);\\n            return new Filesystem(new AzureAdapter($blobRestProxy, $config['container']));\\n        });\\n    }\\n\\n    /**\\n     * Register bindings in the container.\\n     *\\n     * @return void\\n     */\\n    public function register()\\n    {\\n        //\\n    }\\n}\\n\")), mdx(\"p\", null, \"This should be saved as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"app/Providers/AzureStorageServiceProvider.php\"), \". You also need to add this to the list of service providers in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"config/app.php\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-php\"\n  }, \"        App\\\\Providers\\\\AzureStorageServiceProvider::class,\\n\")), mdx(\"p\", null, \"And add this to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"config/filesystems.php\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-php\"\n  }, \"        'azure' => [\\n            'driver'    => 'azure',\\n            'name'      => env('STORAGE_NAME'),\\n            'key'       => env('STORAGE_KEY'),\\n            'container' => env('STORAGE_CONTAINER'),\\n        ],\\n\")), mdx(\"p\", null, \"I like to also set my storage backend using environment variables in this file, as in this example:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-php\"\n  }, \"    'default' => env('STORAGE_BACKEND', 'local'),\\n\")), mdx(\"p\", null, \"That way we can easily set a different backend for testing, development and production so we don't upload files when running PHPUnit. You can also keep your other config settings in your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".env\"), \" file, which is always a better idea than keeping it under version control. You also need to install the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"microsoft/windowsazure\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"league/flysystem-azure\"), \" packages via Composer for this to work.\"), mdx(\"p\", null, \"As I've since changed jobs it's unlikely I'll ever actually use this Azure integration in production - it's not a service I'd choose of my own accord to use. However, since it's so straightforward to implement an adapter like this I imagine I may be doing something similar - I'm currently working on a web app that uses MongoDB for some of its data and currently stores files locally, so it might make sense to create a GridFS integration along similar lines. It may also be useful for someone else, so feel free to use it if you wish.\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"UPDATE: This post has now been superseded by  this one  as I've released this integration as a package. About a year ago I was working on my first non-trivial Laravel applicationâ€¦","frontmatter":{"title":"Creating an Azure storage adapter for Laravel","date":"23rd October 2016 11:25 pm","isoDate":"2016-10-23T23:25:27+00:00","categories":["php","laravel"]},"fields":{"path":"/blog/2016/10/24/creating-an-azure-storage-adapter-for-laravel/"}}},"pageContext":{"previous":{"fields":{"path":"/blog/2016/10/16/building-a-phonegap-app-with-laravel-and-angular-part-3/"},"frontmatter":{"title":"Building a Phonegap app with Laravel and Angular - Part 3","date":"2016-10-16 18:10:13 +0100","layout":"post"}},"next":{"fields":{"path":"/blog/2016/11/13/building-a-phonegap-app-with-laravel-and-angular-part-4/"},"frontmatter":{"title":"Building a Phonegap App with Laravel and Angular - Part 4","date":"2016-11-13 16:15:00 +0000","layout":"post"}}}},
    "staticQueryHashes": ["290055352","2909664151"]}