{"componentChunkName":"component---src-templates-post-tsx","path":"/blog/2018/10/16/adding-react-to-a-legacy-project/","result":{"data":{"site":{"siteMetadata":{"title":"Matthew Daly","siteUrl":"https://matthewdaly.co.uk"}},"mdx":{"id":"6db12d91-062e-5578-ae67-092bddf0aa49","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Adding React to a legacy project\",\n  \"date\": \"2018-10-16 09:00:29 +0100\",\n  \"layout\": \"post\",\n  \"categories\": [\"react\", \"javascript\"],\n  \"comments\": true\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"The project I'm currently working on is a textbook example of what happens when a project uses jQuery when it really ought to use a proper Javascript framework, or it starts out just using jQuery and grows out of all proportion. It's also not helped by the fact that historically it's just been worked on when new functionality needs to be added, meaning that rather than refactoring the code base, it's been copied-and-pasted. As a result, there's lots of repetitive code in desperate need of refactoring, and huge reams of horrible jQuery spaghetti code.\"), mdx(\"p\", null, \"When I first took over responsibility for the project, I integrated Laravel Mix into it so that I had the means to refactor some of the common functionality into separate files and require them during the build process, as well as use ES6. However, this was only the first step, as it didn't sort out the fundamental problem of repetitive boilerplate code being copied and pasted. What I needed was a refactor to use something more opinionated. As it happened, I was asked to add a couple of modals to the admin, and since the modals were one of the worst parts of the admin in terms of repetitive code, they were a strong candidate for implementing using a more suitable library.\"), mdx(\"p\", null, \"I looked at a few options:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"I've used Angular 1 quite successfully in the past, but I didn't really want to use a framework that was being killed off, and it would be difficult to retrofit into a legacy application\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Angular 2+ is actively maintained, but it would again be difficult to retrofit it into a legacy application. In addition, the need for TypeScript would make it problematic.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Vue was a possibility, but it did a bit too much for this use case, and it wasn't all that clear how to retrofit it to an existing application\")), mdx(\"p\", null, \"Eventually, I settled on React.js, for the following reasons:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It has a preset in Laravel Mix, making it easy to get started with it.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It has a very limited target - React is closely focused on the view layer, dealing only with rendering and event handling, so it does just what I needed in this case.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It has a strong record of use with legacy applications - after all, it was created by Facebook and they added it incrementally.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It's easy to test - Jest's snapshot tests make it easy to verify the rendered content hasn't changed, and using Enzyme it's straightforward to test interactions with the component\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Higher order components provide a straightforward way to share functionality between components, which I needed to allow different modals to deal with another modal in the same way.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"By creating a series of components for common user interface elements, I could then re-use those components in future work, saving time and effort.\")), mdx(\"p\", null, \"However, it wasn't entirely clear how I might go about integrating React into a legacy application. In the end, I managed to figure out an approach which worked.\"), mdx(\"p\", null, \"Normally, I would create a single root for my application, something like this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"import React from 'react';\\nimport ReactDOM from 'react-dom';\\nimport App from './components/App';\\n\\nReactDOM.render(\\n    <App />,\\n    document.getElementById('root')\\n);\\n\")), mdx(\"p\", null, \"However, that wasn't an option here. The existing modals were using jQuery and Bootstrap, and the new modals had to work with them. I therefore needed to have only certain parts of the UI managed with React, and the rest wouldn't be touched. Here's an example of how I rendered the modal in the end:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"import React from 'react';\\nimport ReactDOM from 'react-dom';\\nimport higherOrderComponent from './components/higherOrderComponent';\\nimport modalComponent from './components/modalComponent';\\n\\nconst Modal = higherOrderComponent(modalComponent);\\nwindow.componentWrapper = ReactDOM.render(\\n  <Modal />,\\n  document.getElementById('modalTarget')\\n);\\n\\nwindow.componentWrapper.setState({\\n  foo: 'bar'\\n});\\n\")), mdx(\"p\", null, \"By extracting the duplicate functionality into a higher order component, I could easily wrap the new modals in that component and share that functionality between the modals. I could then render each component in a different target element, and assign it to a variable in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"window\"), \" namespace. The div with a ID of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"modalTarget\"), \" needed to be added in the appropriate place, but otherwise the HTML didn't need to be touched, since the required markup was in the React component instead.\"), mdx(\"p\", null, \"Then, when I needed to change a value int the state of the component, I could just call \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"window.componentWrapper.setState({})\"), \", passing through the values to set, and these would propagate down to the child components as usual. I could also render multiple different modal components on the page, and refer to each one separately in order to set the state.\"), mdx(\"p\", null, \"This isn't an approach I'd recommend on a greenfield project - state isn't really something you should be setting from outside a component like this, and normally I wouldn't do it. However, it seemed to be the easiest way for this particular use case. Over time I'll port more and more of the UI over to React, and eventually it won't be necessary as I'll be storing the application state in something like Redux.\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"The project I'm currently working on is a textbook example of what happens when a project uses jQuery when it really ought to use a proper Javascript framework, or it starts outâ€¦","frontmatter":{"title":"Adding React to a legacy project","date":"16th October 2018 8:00 am","isoDate":"2018-10-16T08:00:29+00:00","categories":["react","javascript"]},"fields":{"path":"/blog/2018/10/16/adding-react-to-a-legacy-project/"}}},"pageContext":{"previous":{"fields":{"path":"/blog/2018/10/11/do-you-still-need-jquery/"},"frontmatter":{"title":"Do you still need jQuery?","date":"2018-10-11 09:21:58 +0100","layout":"post"}},"next":{"fields":{"path":"/blog/2018/10/20/simplify-your-tests-with-anonymous-classes/"},"frontmatter":{"title":"Simplify your tests with anonymous classes","date":"2018-10-20 14:48:05 +0100","layout":"post"}}}},"staticQueryHashes":["290055352","3373576264"]}