{"componentChunkName":"component---src-templates-post-tsx","path":"/blog/2014/01/02/django-blog-tutorial-the-next-generation-part-2/","result":{"data":{"site":{"siteMetadata":{"title":"Matthew Daly","siteUrl":"https://matthewdaly.co.uk"}},"mdx":{"id":"2f4d5e74-bf3e-5109-9689-39ad57c995de","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"layout\": \"post\",\n  \"title\": \"Django blog tutorial - the next generation - part 2\",\n  \"date\": \"2014-01-02 11:28:48 +0000\",\n  \"comments\": true,\n  \"categories\": [\"python\", \"django\", \"tdd\", \"django-blog-tutorial\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Welcome back! In this lesson, we'll use Twitter Bootstrap to make our blog look nicer, and we'll implement individual pages for each post.\"), mdx(\"p\", null, \"Now, before we get started, don't forget to switch into your virtualenv. From within the directory for the project, run the following command:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ source venv/bin/activate\\n\")), mdx(\"p\", null, \"If you haven't used Bootstrap before, you're in for a treat. With Bootstrap, it's easy to make a good-looking website quickly that's responsive and mobile-friendly. We'll also use HTML5 Boilerplate to get a basic HTML template in place.\"), mdx(\"p\", null, \"Now, to install these easily, we'll use Bower, which requires \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://nodejs.org/\"\n  }, \"Node.js\"), \". Install Node.js first. On most Linux distros, you'll also need to set \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"NODE_PATH\"), \", which can be done by pasting the following into your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".bashrc\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"NODE_PATH=\\\"/usr/local/lib/node_modules\\\"\\n\")), mdx(\"p\", null, \"With that done, run the following command to install Bower:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ sudo npm install -g bower\\n\")), mdx(\"p\", null, \"Next we need to create a Bower config. First, create the folder \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"blogengine/static\"), \". Then create a new file called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".bowerrc\"), \" and paste in the following content:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-json\"\n  }, \"{\\n    \\\"directory\\\": \\\"blogengine/static/bower_components\\\"\\n}\\n\")), mdx(\"p\", null, \"This tells Bower where it should put downloaded libraries. Next, run the following command to generate the config for Bower:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ bower init\\n\")), mdx(\"p\", null, \"Answer all the questions it asks you - for those with defaults, these should be fine, and everything else should be easy enough. Next, run the following command to install Bootstrap and HTML5 Boilerplate:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ bower install bootstrap html5-boilerplate --save\\n\")), mdx(\"p\", null, \"Note that as jQuery is a dependency of Bootstrap, it will also be installed automatically. Now, we need to keep our Bower-installed files out of version control - the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"bower.json\"), \" file keeps track of them for us. So add the following to your .gitignore file:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"blogengine/static/bower_components/\\n\")), mdx(\"p\", null, \"All done? Let's commit our changes:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add .gitignore .bowerrc bower.json\\n$ git commit -m 'Added Bower config'\\n\")), mdx(\"p\", null, \"Now, let's make our template nicer. Django's templating system is very powerful and lets one template inherit from another. We're going to create a base template, using HTML5 Boilerplate as a starting point, that all of our web-facing pages will use. First, create a directory to hold the base template:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ mkdir templates/blogengine/includes\\n\")), mdx(\"p\", null, \"Then copy the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"index.html\"), \" file from HTML5 Boilerplate to this directory as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"base.html\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ cp blogengine/static/bower_components/html5-boilerplate/index.html templates/blogengine/includes/base.html\\n\")), mdx(\"p\", null, \"Now amend this file to look like this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-django\"\n  }, \"<!DOCTYPE html>\\n<!--[if lt IE 7]>      <html class=\\\"no-js lt-ie9 lt-ie8 lt-ie7\\\"> <![endif]-->\\n<!--[if IE 7]>         <html class=\\\"no-js lt-ie9 lt-ie8\\\"> <![endif]-->\\n<!--[if IE 8]>         <html class=\\\"no-js lt-ie9\\\"> <![endif]-->\\n<!--[if gt IE 8]><!--> <html class=\\\"no-js\\\"> <!--<![endif]-->\\n    <head>\\n        <meta charset=\\\"utf-8\\\">\\n        <meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=edge\\\">\\n        <title>{% block title %}My Django Blog{% endblock %}</title>\\n        <meta name=\\\"description\\\" content=\\\"\\\">\\n        <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1\\\">\\n\\n        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->\\n\\n        {% load staticfiles %}\\n        <link rel=\\\"stylesheet\\\" href=\\\"{% static 'bower_components/html5-boilerplate/css/normalize.css' %}\\\">\\n        <link rel=\\\"stylesheet\\\" href=\\\"{% static 'bower_components/html5-boilerplate/css/main.css' %}\\\">\\n        <link rel=\\\"stylesheet\\\" href=\\\"{% static 'bower_components/bootstrap/dist/css/bootstrap.min.css' %}\\\">\\n        <link rel=\\\"stylesheet\\\" href=\\\"{% static 'bower_components/bootstrap/dist/css/bootstrap-theme.min.css' %}\\\">\\n        <script src=\\\"{% static 'bower_components/html5-boilerplate/js/vendor/modernizr-2.6.2.min.js' %}\\\"></script>\\n    </head>\\n    <body>\\n        <!--[if lt IE 7]>\\n            <p class=\\\"browsehappy\\\">You are using an <strong>outdated</strong> browser. Please <a href=\\\"http://browsehappy.com/\\\">upgrade your browser</a> to improve your experience.</p>\\n        <![endif]-->\\n\\n        <!-- Add your site or application content here -->\\n        {% block content %}{% endblock %}\\n\\n        <script src=\\\"//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js\\\"></script>\\n        <script>window.jQuery || document.write('<script src=\\\"{% static 'bower_components/html5-boilerplate/js/vendor/jquery-1.10.2.min.js' %}\\\"><\\\\/script>')</script>\\n        <script src=\\\"{% static 'bower_components/html5-boilerplate/js/plugins.js' %}\\\"></script>\\n        <script src=\\\"{% static 'bower_components/bootstrap/dist/js/bootstrap.min.js' %}\\\"></script>\\n\\n        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->\\n        <script>\\n            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=\\n            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;\\n            e=o.createElement(i);r=o.getElementsByTagName(i)[0];\\n            e.src='//www.google-analytics.com/analytics.js';\\n            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));\\n            ga('create','UA-XXXXX-X');ga('send','pageview');\\n        </script>\\n    </body>\\n</html>\\n\")), mdx(\"p\", null, \"Note the following:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"We need to use \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"{% load staticfiles %}\"), \" to be able to load any static files.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"We use the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"{% static %}\"), \" template tag to load static files such as CSS and HTML\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"We define blocks called \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"title\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"content\"), \". Any template that extends this one can override whatever is inside this template.\")), mdx(\"p\", null, \"Please note that HTML5 Boilerplate may conceivable change in future, so bear in mind that all you really need to do is load the staticfiles app, use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"static\"), \" tag for any static files that need to be loaded, and define the blocks in the appropriate places.\"), mdx(\"p\", null, \"Next, let's amend our existing template to inherit from this one:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-django\"\n  }, \"{% extends \\\"blogengine/includes/base.html\\\" %}\\n\\n    {% block content %}\\n        {% for post in object_list %}\\n        <h1>{{ post.title }}</h1>\\n        <h3>{{ post.pub_date }}</h3>\\n        {{ post.text }}\\n        {% endfor %}\\n    {% endblock %}\\n\")), mdx(\"p\", null, \"Now fire up the server with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"python manage.py runserver\"), \" and check everything is working OK. You should see that your new base template is now in use and the CSS and JS files are being loaded correctly. Let's commit again:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add templates/\\n$ git commit -m 'Now use Bootstrap and HTML5 Boilerplate for templates'\\n\")), mdx(\"p\", null, \"Now, let's use Bootstrap to style our blog a little. First we'll add a navigation bar at the top of our blog. Edit the base template as follows:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-django\"\n  }, \"        <div class=\\\"navbar navbar-static-top navbar-inverse\\\">\\n            <div class=\\\"navbar-inner\\\">\\n                <div class=\\\"container\\\">\\n                    <a class=\\\"btn btn-navbar\\\" data-toggle=\\\"collapse\\\" data-target=\\\".nav-collapse\\\">\\n                        <span class=\\\"icon-bar\\\"></span>\\n                        <span class=\\\"icon-bar\\\"></span>\\n                        <span class=\\\"icon-bar\\\"></span>\\n                    </a>\\n                    <a class=\\\"brand\\\" href=\\\"/\\\">My Django Blog</a>\\n                    <div class=\\\"nav-collapse collapse\\\">\\n                    </div>\\n                </div>\\n            </div>\\n        </div>\\n\\n        <div class=\\\"container\\\">\\n            {% block header %}\\n                <div class=\\\"page-header\\\">\\n                    <h1>My Django Blog</h1>\\n                </div>\\n            {% endblock %}\\n\\n            <div class=\\\"row\\\">\\n                {% block content %}{% endblock %}\\n            </div>\\n        </div>\\n\\n        <div class=\\\"container footer\\\">\\n            <div class=\\\"row\\\">\\n                <div class=\\\"span12\\\">\\n                    <p>Copyright &copy; {% now \\\"Y\\\" %}</p>\\n                </div>\\n            </div>\\n        </div>\\n\")), mdx(\"p\", null, \"Note the footer copyright section. Here we output the current year using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"now\"), \". Also note the addition of the header block. This will let us override the page header if necessary.\"), mdx(\"p\", null, \"We'll also wrap the posts in a div:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-django\"\n  }, \"{% extends \\\"blogengine/includes/base.html\\\" %}\\n\\n    {% block content %}\\n        {% for post in object_list %}\\n        <div class=\\\"post\\\">\\n        <h1>{{ post.title }}</h1>\\n        <h3>{{ post.pub_date }}</h3>\\n        {{ post.text }}\\n        </div>\\n        {% endfor %}\\n    {% endblock %}\\n\")), mdx(\"p\", null, \"Let's commit our changes:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add templates/\\n$ git commit -m 'Amended templates'\\n\")), mdx(\"h2\", null, \"Formatting our content\"), mdx(\"p\", null, \"As it stands right now, we can't do much to format our posts. It is possible to include HTML in our posts with Django, but by default it will strip it out. Also, we don't want users to have to write HTML manually - we want to make our blog user friendly!\"), mdx(\"p\", null, \"There are two possible approaches. One is to embed a rich text editor like TinyMCE in the admin and use that for editing the files, but I've found things like that to be cumbersome. The alternative is to use some other form of lightweight markup, and that's the approach we'll take here. We're going to use Markdown for editing our posts.\"), mdx(\"p\", null, \"Django has actually dropped support for Markdown, but it's not hard to implement your own version. First, install Markdown and add it to your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"requirements.txt\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ pip install markdown\\n$ pip freeze > requirements.txt\\n\")), mdx(\"p\", null, \"Now, we shouldn't write any production code before writing a test, so let's amend our existing post test to check to see that Markdown is working as expected:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"class PostViewTest(LiveServerTestCase):\\n    def setUp(self):\\n        self.client = Client()\\n\\n    def test_index(self):\\n        # Create the post\\n        post = Post()\\n        post.title = 'My first post'\\n        post.text = 'This is [my first blog post](http://127.0.0.1:8000/)'\\n        post.pub_date = timezone.now()\\n        post.save()\\n\\n        # Check new post saved\\n        all_posts = Post.objects.all()\\n        self.assertEquals(len(all_posts), 1)\\n\\n        # Fetch the index\\n        response = self.client.get('/')\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Check the post title is in the response\\n        self.assertTrue(post.title in response.content)\\n\\n        # Check the post text is in the response\\n        self.assertTrue(markdown.markdown(post.text) in response.content)\\n\\n        # Check the post date is in the response\\n        self.assertTrue(str(post.pub_date.year) in response.content)\\n        self.assertTrue(post.pub_date.strftime('%b') in response.content)\\n        self.assertTrue(str(post.pub_date.day) in response.content)\\n\\n        # Check the link is marked up properly\\n        self.assertTrue('<a href=\\\"http://127.0.0.1:8000/\\\">my first blog post</a>' in response.content)\\n\")), mdx(\"p\", null, \"You'll also need to add the following at the top:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"import markdown\\n\")), mdx(\"p\", null, \"What we do here is we convert our post text to include a link using Markdown. We also need to render that post in markdown within the test so that what we have in the test matches what will be produced - otherwise our test will be broken. We also check that the link is marked up correctly.\"), mdx(\"p\", null, \"Save the file and run the tests - they should fail. Now, create the following directory and file:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ mkdir blogengine/templatetags\\n$ touch blogengine/templatetags/__init__.py\\n\")), mdx(\"p\", null, \"Note that the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"__init__.py\"), \" file is meant to be blank.\"), mdx(\"p\", null, \"Then create the following file and edit it to look like this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"import markdown\\n\\nfrom django import template\\nfrom django.template.defaultfilters import stringfilter\\nfrom django.utils.encoding import force_unicode\\nfrom django.utils.safestring import mark_safe\\n\\nregister = template.Library()\\n\\n@register.filter(is_safe=True)\\n@stringfilter\\ndef custom_markdown(value):\\n    extensions = [\\\"nl2br\\\", ]\\n\\n    return mark_safe(markdown.markdown(force_unicode(value),\\n                                       extensions,\\n                                       safe_mode=True,\\n                                       enable_attributes=False))\\n\")), mdx(\"p\", null, \"Then just amend the post list template to use it:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-django\"\n  }, \"{% extends \\\"blogengine/includes/base.html\\\" %}\\n\\n    {% load custom_markdown %}\\n\\n    {% block content %}\\n        {% for post in object_list %}\\n        <div class=\\\"post\\\">\\n        <h1>{{ post.title }}</h1>\\n        <h3>{{ post.pub_date }}</h3>\\n        {{ post.text|custom_markdown }}\\n        </div>\\n        {% endfor %}\\n    {% endblock %}\\n\")), mdx(\"p\", null, \"It's that easy to use a custom markup system with your blog!\"), mdx(\"p\", null, \"Let's commit the changes:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add requirements.txt templates/ blogengine/\\n$ git commit -m 'Added Markdown support'\\n\")), mdx(\"h2\", null, \"Pagination\"), mdx(\"p\", null, \"As at right now, all of our posts are displayed on the index page. We want to fix that by implementing pagination. Fortunately, that's very easy for us because we're using Django's generic views. Go into \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"blogengine/urls.py\"), \" and amend it as follows:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"from django.conf.urls import patterns, url\\nfrom django.views.generic import ListView\\nfrom blogengine.models import Post\\n\\nurlpatterns = patterns('',\\n    # Index\\n    url(r'^(?P<page>\\\\d+)?/?$', ListView.as_view(\\n        model=Post,\\n        paginate_by=5,\\n        )),\\n)\\n\")), mdx(\"p\", null, \"That will automatically paginate our posts by 5 - feel free to change the value of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"paginate_by\"), \" if you wish. However, we need to place the links in our template as well:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-django\"\n  }, \"{% extends \\\"blogengine/includes/base.html\\\" %}\\n\\n    {% load custom_markdown %}\\n\\n    {% block content %}\\n        {% for post in object_list %}\\n        <div class=\\\"post\\\">\\n        <h1>{{ post.title }}</h1>\\n        <h3>{{ post.pub_date }}</h3>\\n        {{ post.text|custom_markdown }}\\n        </div>\\n        {% endfor %}\\n\\n        {% if page_obj.has_previous %}\\n        <a href=\\\"/{{ page_obj.previous_page_number }}/\\\">Previous Page</a>\\n        {% endif %}\\n        {% if page_obj.has_next %}\\n        <a href=\\\"/{{ page_obj.next_page_number }}/\\\">Next Page</a>\\n        {% endif %}\\n\\n    {% endblock %}\\n\")), mdx(\"p\", null, \"Try adding a few more blog posts, and you'll see the pagination links. But give them a try, and they won't work. Why not? Well, as it turns out there was a bug in the project-wide \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"urls.py\"), \" file (my bad!). Let's fix that:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"from django.conf.urls import patterns, include, url\\n\\nfrom django.contrib import admin\\nadmin.autodiscover()\\n\\nurlpatterns = patterns('',\\n    # Examples:\\n    # url(r'^$', 'django_tutorial_blog_ng.views.home', name='home'),\\n    # url(r'^blog/', include('blog.urls')),\\n\\n    url(r'^admin/', include(admin.site.urls)),\\n\\n    # Blog URLs\\n    url(r'', include('blogengine.urls')),\\n)\\n\")), mdx(\"p\", null, \"If you try again, you'll see that the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"blogengine\"), \" app now happily deals with the paginated posts. Let's commit our changes:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add blogengine/ django_tutorial_blog_ng/ templates/\\n$ git commit -m 'Implemented pagination'\\n\")), mdx(\"h2\", null, \"Viewing individual posts\"), mdx(\"p\", null, \"As our last task for today, we'll implement individual pages for each post. We want each post to have a nice, friendly URL that is as human-readable as possible, and also includes the date the post was created.\"), mdx(\"p\", null, \"First of all, we'll implement our test for it, however:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"    def test_post_page(self):\\n        # Create the post\\n        post = Post()\\n        post.title = 'My first post'\\n        post.text = 'This is [my first blog post](http://127.0.0.1:8000/)'\\n        post.pub_date = timezone.now()\\n        post.save()\\n\\n        # Check new post saved\\n        all_posts = Post.objects.all()\\n        self.assertEquals(len(all_posts), 1)\\n        only_post = all_posts[0]\\n        self.assertEquals(only_post, post)\\n\\n        # Get the post URL\\n        post_url = only_post.get_absolute_url()\\n\\n        #\\xA0Fetch the post\\n        response = self.client.get(post_url)\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Check the post title is in the response\\n        self.assertTrue(post.title in response.content)\\n\\n        # Check the post text is in the response\\n        self.assertTrue(markdown.markdown(post.text) in response.content)\\n\\n        # Check the post date is in the response\\n        self.assertTrue(str(post.pub_date.year) in response.content)\\n        self.assertTrue(post.pub_date.strftime('%b') in response.content)\\n        self.assertTrue(str(post.pub_date.day) in response.content)\\n\\n        # Check the link is marked up properly\\n        self.assertTrue('<a href=\\\"http://127.0.0.1:8000/\\\">my first blog post</a>' in response.content)\\n\")), mdx(\"p\", null, \"Add this method to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PostViewTest\"), \" class, after \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"test_index\"), \". It's very similar to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"test_index\"), \", since it's testing much the same content. However, not that we fetch the post-specific URL using the method \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"get_absolute_url\"), \", and we then fetch that page.\"), mdx(\"p\", null, \"Now, if you run the test, it will fail because \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"get_absolute_url\"), \" isn't implemented. It's often a good idea to have a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"get_absolute_url\"), \" method for your models, which defines a single URL scheme for that type of object. So let's create one. However, to implement our URL scheme we need to make some changes. Right now we have the date, but we don't have a text string we can use, known in Django as a \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"slug\"), \". So we'll add a slug field, which will be prepopulated based on the post title. Edit your model as follows:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"from django.db import models\\n\\n# Create your models here.\\nclass Post(models.Model):\\n    title = models.CharField(max_length=200)\\n    pub_date = models.DateTimeField()\\n    text = models.TextField()\\n    slug = models.SlugField(max_length=40, unique=True)\\n\\n    def get_absolute_url(self):\\n        return \\\"/%s/%s/%s/\\\" % (self.pub_date.year, self.pub_date.month, self.slug)\\n\\n    def __unicode__(self):\\n        return self.title\\n\\n    class Meta:\\n        ordering = [\\\"-pub_date\\\"]\\n\")), mdx(\"p\", null, \"Here we've added a slug field to the model, as well as implementing our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"get_absolute_url\"), \" method. Note we've limited the date to year and month, but you can include days if you wish.\"), mdx(\"p\", null, \"While we're in here, we've also implemented the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"__unicode__\"), \" method. Essentially, this sets how Django describes the object in the admin - in this case, the post title is a logical way of describing that \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Post\"), \" object, so it returns the post title.\"), mdx(\"p\", null, \"We've also added the class Meta, with the ordering field. This tells Django that by default any list of posts should return them ordered by \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pub_date\"), \" in reverse - in other words, latest first.\"), mdx(\"p\", null, \"To have the slug filled in automatically, we need to customise the admin interface a little as well:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"import models\\nfrom django.contrib import admin\\n\\nclass PostAdmin(admin.ModelAdmin):\\n    prepopulated_fields = {\\\"slug\\\": (\\\"title\\\",)}\\n\\nadmin.site.register(models.Post, PostAdmin)\\n\")), mdx(\"p\", null, \"Now, I recommend at this stage going into the admin and deleting all of your posts, because otherwise you'll have problems in migrating them. The issue is that each slug is compulsory and must be unique, and it's not practical to use South to automatically generate new slugs from the title on the fly, so by deleting them at this stage you'll avoid problems. Once that's done, run this command:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py schemamigration --auto blogengine\\n\")), mdx(\"p\", null, \"You'll be prompted to specify a one-off default value - enter any string you like, such as \\\"blah\\\". Then run the migration:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py migrate\\n\")), mdx(\"p\", null, \"Let's run our tests now:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"(venv)Smith:django_tutorial_blog_ng matthewdaly$ python manage.py test\\nCreating test database for alias 'default'...\\n.F.F...F\\n======================================================================\\nFAIL: test_create_post (blogengine.tests.AdminTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 103, in test_create_post\\n    self.assertTrue('added successfully' in response.content)\\nAssertionError: False is not true\\n\\n======================================================================\\nFAIL: test_edit_post (blogengine.tests.AdminTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 132, in test_edit_post\\n    self.assertTrue('changed successfully' in response.content)\\nAssertionError: False is not true\\n\\n======================================================================\\nFAIL: test_post_page (blogengine.tests.PostViewTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 222, in test_post_page\\n    self.assertEquals(response.status_code, 200)\\nAssertionError: 404 != 200\\n\\n----------------------------------------------------------------------\\nRan 8 tests in 2.180s\\n\\nFAILED (failures=3)\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"Whoops! Our tests are broken, because the slug field isn't being filled in. If you take a look at the page for adding a post, you'll notice that the slug is filled in using JavaScript, so our test fails because the test client doesn't interpret JavaScript. So in the tests we have to fill in the slug field manually.\"), mdx(\"p\", null, \"Also, for the unit tests, the slug attribute isn't being created at all, so it can't be saved. Let's remedy that. First, edit the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"test_create_post\"), \" method of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PostTest\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"class PostTest(TestCase):\\n    def test_create_post(self):\\n        # Create the post\\n        post = Post()\\n\\n        # Set the attributes\\n        post.title = 'My first post'\\n        post.text = 'This is my first blog post'\\n        post.slug = 'my-first-post'\\n        post.pub_date = timezone.now()\\n\\n        # Save it\\n        post.save()\\n\\n        # Check we can find it\\n        all_posts = Post.objects.all()\\n        self.assertEquals(len(all_posts), 1)\\n        only_post = all_posts[0]\\n        self.assertEquals(only_post, post)\\n\\n        # Check attributes\\n        self.assertEquals(only_post.title, 'My first post')\\n        self.assertEquals(only_post.text, 'This is my first blog post')\\n        self.assertEquals(only_post.slug, 'my-first-post')\\n        self.assertEquals(only_post.pub_date.day, post.pub_date.day)\\n        self.assertEquals(only_post.pub_date.month, post.pub_date.month)\\n        self.assertEquals(only_post.pub_date.year, post.pub_date.year)\\n        self.assertEquals(only_post.pub_date.hour, post.pub_date.hour)\\n        self.assertEquals(only_post.pub_date.minute, post.pub_date.minute)\\n        self.assertEquals(only_post.pub_date.second, post.pub_date.second)\\n\")), mdx(\"p\", null, \"Next, let's amend \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AdminTest\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"class AdminTest(LiveServerTestCase):\\n    fixtures = ['users.json']\\n\\n    def setUp(self):\\n        self.client = Client()\\n\\n    def test_login(self):\\n        # Get login page\\n        response = self.client.get('/admin/')\\n\\n        # Check response code\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Check 'Log in' in response\\n        self.assertTrue('Log in' in response.content)\\n\\n        # Log the user in\\n        self.client.login(username='bobsmith', password=\\\"password\\\")\\n\\n        # Check response code\\n        response = self.client.get('/admin/')\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Check 'Log out' in response\\n        self.assertTrue('Log out' in response.content)\\n\\n    def test_logout(self):\\n        # Log in\\n        self.client.login(username='bobsmith', password=\\\"password\\\")\\n\\n        # Check response code\\n        response = self.client.get('/admin/')\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Check 'Log out' in response\\n        self.assertTrue('Log out' in response.content)\\n\\n        # Log out\\n        self.client.logout()\\n\\n        # Check response code\\n        response = self.client.get('/admin/')\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Check 'Log in' in response\\n        self.assertTrue('Log in' in response.content)\\n\\n    def test_create_post(self):\\n        # Log in\\n        self.client.login(username='bobsmith', password=\\\"password\\\")\\n\\n        # Check response code\\n        response = self.client.get('/admin/blogengine/post/add/')\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Create the new post\\n        response = self.client.post('/admin/blogengine/post/add/', {\\n            'title': 'My first post',\\n            'text': 'This is my first post',\\n            'pub_date_0': '2013-12-28',\\n            'pub_date_1': '22:00:04',\\n            'slug': 'my-first-post'\\n        },\\n        follow=True\\n        )\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Check added successfully\\n        self.assertTrue('added successfully' in response.content)\\n\\n        # Check new post now in database\\n        all_posts = Post.objects.all()\\n        self.assertEquals(len(all_posts), 1)\\n\\n    def test_edit_post(self):\\n        # Create the post\\n        post = Post()\\n        post.title = 'My first post'\\n        post.text = 'This is my first blog post'\\n        post.slug = 'my-first-post'\\n        post.pub_date = timezone.now()\\n        post.save()\\n\\n        # Log in\\n        self.client.login(username='bobsmith', password=\\\"password\\\")\\n\\n        # Edit the post\\n        response = self.client.post('/admin/blogengine/post/1/', {\\n            'title': 'My second post',\\n            'text': 'This is my second blog post',\\n            'pub_date_0': '2013-12-28',\\n            'pub_date_1': '22:00:04',\\n            'slug': 'my-second-post'\\n        },\\n        follow=True\\n        )\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Check changed successfully\\n        self.assertTrue('changed successfully' in response.content)\\n\\n        # Check post amended\\n        all_posts = Post.objects.all()\\n        self.assertEquals(len(all_posts), 1)\\n        only_post = all_posts[0]\\n        self.assertEquals(only_post.title, 'My second post')\\n        self.assertEquals(only_post.text, 'This is my second blog post')\\n\\n    def test_delete_post(self):\\n        # Create the post\\n        post = Post()\\n        post.title = 'My first post'\\n        post.text = 'This is my first blog post'\\n        post.slug = 'my-first-post'\\n        post.pub_date = timezone.now()\\n        post.save()\\n\\n        # Check new post saved\\n        all_posts = Post.objects.all()\\n        self.assertEquals(len(all_posts), 1)\\n\\n        # Log in\\n        self.client.login(username='bobsmith', password=\\\"password\\\")\\n\\n        # Delete the post\\n        response = self.client.post('/admin/blogengine/post/1/delete/', {\\n            'post': 'yes'\\n        }, follow=True)\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Check deleted successfully\\n        self.assertTrue('deleted successfully' in response.content)\\n\\n        # Check post amended\\n        all_posts = Post.objects.all()\\n        self.assertEquals(len(all_posts), 0)\\n\")), mdx(\"p\", null, \"And \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PostViewTest\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"class PostViewTest(LiveServerTestCase):\\n    def setUp(self):\\n        self.client = Client()\\n\\n    def test_index(self):\\n        # Create the post\\n        post = Post()\\n        post.title = 'My first post'\\n        post.text = 'This is [my first blog post](http://127.0.0.1:8000/)'\\n        post.slug = 'my-first-post'\\n        post.pub_date = timezone.now()\\n        post.save()\\n\\n        # Check new post saved\\n        all_posts = Post.objects.all()\\n        self.assertEquals(len(all_posts), 1)\\n\\n        # Fetch the index\\n        response = self.client.get('/')\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Check the post title is in the response\\n        self.assertTrue(post.title in response.content)\\n\\n        # Check the post text is in the response\\n        self.assertTrue(markdown.markdown(post.text) in response.content)\\n\\n        # Check the post date is in the response\\n        self.assertTrue(str(post.pub_date.year) in response.content)\\n        self.assertTrue(post.pub_date.strftime('%b') in response.content)\\n        self.assertTrue(str(post.pub_date.day) in response.content)\\n\\n        # Check the link is marked up properly\\n        self.assertTrue('<a href=\\\"http://127.0.0.1:8000/\\\">my first blog post</a>' in response.content)\\n\\n    def test_post_page(self):\\n        # Create the post\\n        post = Post()\\n        post.title = 'My first post'\\n        post.text = 'This is [my first blog post](http://127.0.0.1:8000/)'\\n        post.slug = 'my-first-post'\\n        post.pub_date = timezone.now()\\n        post.save()\\n\\n        # Check new post saved\\n        all_posts = Post.objects.all()\\n        self.assertEquals(len(all_posts), 1)\\n        only_post = all_posts[0]\\n        self.assertEquals(only_post, post)\\n\\n        # Get the post URL\\n        post_url = only_post.get_absolute_url()\\n\\n        # Fetch the post\\n        response = self.client.get(post_url)\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Check the post title is in the response\\n        self.assertTrue(post.title in response.content)\\n\\n        # Check the post text is in the response\\n        self.assertTrue(markdown.markdown(post.text) in response.content)\\n\\n        # Check the post date is in the response\\n        self.assertTrue(str(post.pub_date.year) in response.content)\\n        self.assertTrue(post.pub_date.strftime('%b') in response.content)\\n        self.assertTrue(str(post.pub_date.day) in response.content)\\n\\n        # Check the link is marked up properly\\n        self.assertTrue('<a href=\\\"http://127.0.0.1:8000/\\\">my first blog post</a>' in response.content)\\n\")), mdx(\"p\", null, \"What we're doing here is that every time we create a Post object programmatically, we add the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"post.slug\"), \" attribute to it. Also, when submitting a post via the admin, we pass the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"slug\"), \" parameter via HTTP POST, thus emulating how a form would submit this data.\"), mdx(\"p\", null, \"If you run the tests again, you'll see that \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"test_post_page\"), \" still fails. This is because we haven't yet up the URLs, templates and views to do so. Let's fix that. We'll use another generic view, called a DetailView, to display the posts. Amend \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"blogengine/urls.py\"), \" as follows:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"rom django.conf.urls import patterns, url\\nfrom django.views.generic import ListView, DetailView\\nfrom blogengine.models import Post\\n\\nurlpatterns = patterns('',\\n    # Index\\n    url(r'^(?P<page>\\\\d+)?/?$', ListView.as_view(\\n        model=Post,\\n        paginate_by=5,\\n        )),\\n\\n    # Individual posts\\n    url(r'^(?P<pub_date__year>\\\\d{4})/(?P<pub_date__month>\\\\d{1,2})/(?P<slug>[a-zA-Z0-9-]+)/?$', DetailView.as_view(\\n        model=Post,\\n        )),\\n)\\n\")), mdx(\"p\", null, \"Running our tests again will still fail, but now because the template \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"post_detail.html\"), \" has not been found. So let's create it:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-django\"\n  }, \"{% extends \\\"blogengine/includes/base.html\\\" %}\\n\\n    {% load custom_markdown %}\\n\\n    {% block content %}\\n        <div class=\\\"post\\\">\\n        <h1>{{ object.title }}</h1>\\n        <h3>{{ object.pub_date }}</h3>\\n        {{ object.text|custom_markdown }}\\n        </div>\\n\\n{% endblock %}\\n\")), mdx(\"p\", null, \"If you run your tests again, they should now pass. However, we still need to provide a hyperlink from each post in the index to the post page, so let's do that:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-django\"\n  }, \"{% extends \\\"blogengine/includes/base.html\\\" %}\\n\\n    {% load custom_markdown %}\\n\\n    {% block content %}\\n        {% for post in object_list %}\\n        <div class=\\\"post\\\">\\n        <h1><a href=\\\"{{ post.get_absolute_url }}\\\">{{ post.title }}</a></h1>\\n        <h3>{{ post.pub_date }}</h3>\\n        {{ post.text|custom_markdown }}\\n        </div>\\n        {% endfor %}\\n\\n        {% if page_obj.has_previous %}\\n        <a href=\\\"/{{ page_obj.previous_page_number }}/\\\">Previous Page</a>\\n        {% endif %}\\n        {% if page_obj.has_next %}\\n        <a href=\\\"/{{ page_obj.next_page_number }}/\\\">Next Page</a>\\n        {% endif %}\\n\\n    {% endblock %}\\n\")), mdx(\"p\", null, \"And that's all for today! We now have individual post pages, we've styled our blog a bit, and we've implemented Markdown support. All that remains is to commit our changes:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add blogengine/ templates/\\n$ git commit -m 'Implemented post pages'\\n\")), mdx(\"p\", null, \"As before, I've tagged the final commit with 'lesson-2', so if you're following along, you can switch to this point with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"git checkout lesson-2\"), \".\"), mdx(\"p\", null, \"Next time we'll add support for flat pages and multiple authors, as well as adding support for comments via a third-party commenting system.\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Welcome back! In this lesson, we'll use Twitter Bootstrap to make our blog look nicer, and we'll implement individual pages for each post. Now, before we get started, don't forget…","frontmatter":{"title":"Django blog tutorial - the next generation - part 2","date":"2nd January 2014 11:28 am","isoDate":"2014-01-02T11:28:48+00:00","categories":["python","django","tdd","django-blog-tutorial"]},"fields":{"path":"/blog/2014/01/02/django-blog-tutorial-the-next-generation-part-2/"}}},"pageContext":{"previous":{"fields":{"path":"/blog/2013/12/28/django-blog-tutorial-the-next-generation-part-1/"},"frontmatter":{"title":"Django blog tutorial - the next generation - part 1","date":"2013-12-28 15:00:32 +0000","layout":"post"}},"next":{"fields":{"path":"/blog/2014/01/03/django-blog-tutorial-the-next-generation-part-3/"},"frontmatter":{"title":"Django Blog Tutorial - the Next Generation - Part 3","date":"2014-01-03 12:57:30 +0000","layout":"post"}}}},"staticQueryHashes":["290055352","2909664151"]}