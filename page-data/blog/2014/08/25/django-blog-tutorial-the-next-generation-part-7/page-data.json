{"componentChunkName":"component---src-templates-post-tsx","path":"/blog/2014/08/25/django-blog-tutorial-the-next-generation-part-7/","result":{"data":{"site":{"siteMetadata":{"title":"Matthew Daly","siteUrl":"https://matthewdaly.co.uk"}},"mdx":{"id":"eb96c85c-6d6b-571c-85fc-69e8c9d43e8b","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"layout\": \"post\",\n  \"title\": \"Django Blog Tutorial - the Next Generation - Part 7\",\n  \"date\": \"2014-08-25 17:15:01 +0100\",\n  \"comments\": true,\n  \"categories\": [\"tdd\", \"python\", \"django\", \"django-blog-tutorial\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Hello once again! In this instalment we'll cover:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Caching your content with Memcached to improve your site's performance\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Refactoring and simplifying our tests\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Implementing additional feeds\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Creating a simple search engine\")), mdx(\"p\", null, \"Don't forget to activate your virtualenv:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ source venv/bin/activate\\n\")), mdx(\"p\", null, \"Now let's get started!\"), mdx(\"h1\", null, \"Memcached\"), mdx(\"p\", null, \"If you frequent (or used to frequent) social media sites like Reddit, Slashdot or Digg, you may be familiar with something called variously the Digg or Slashdot effect, whereby if a page gets submitted to a social media site, and subsequently becomes popular, it can be hit by a huge number of HTTP requests in a very short period of time, slowing it down or even taking the server down completely.\"), mdx(\"p\", null, \"Now, as a general rule of thumb, for most dynamic websites such as blogs, the bottleneck is not the web server or the programming language, but the database. If you have a lot of people hitting the same page over and over again in quick succession, then you're essentially running the same query over and over again and getting the same result each time, which is expensive in terms of processing power. What you need to be able to do is cache the results of the query in memory for a given period of time so that the number of queries is reduced.\"), mdx(\"p\", null, \"That's where Memcached comes in. It's a simple key-value store that allows you to store values in memory for a given period of time so that they can be retrieved without having to query the database. Memcached is a very common choice for caching, and is by far the fastest and most efficient type of cache available for Django. It's also available on Heroku's free tier.\"), mdx(\"p\", null, \"Django has a very powerful caching framework that supports numerous types of cache in addition to Memcached, such as:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Database caching\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Filesystem caching\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Local memory caching\")), mdx(\"p\", null, \"There are also third-party backends for using other caching systems such as Redis.\"), mdx(\"p\", null, \"Now, the cache can be used in a number of different ways. You can cache only certain parts of your site if you wish. However, because our site is heavily content-driven, we should be pretty safe to use the per-site cache, which is the simplest way to set up caching.\"), mdx(\"p\", null, \"In order to set up Memcached, there's a couple of Python libraries we'll need. If you want to install them locally, however, you'll need to install both memcached and libmemcached (on Ubuntu, the packages you need are called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"memcached\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"libmemcached-dev\"), \") on your development machine. If you don't want to do this, then just copy and paste these lines into \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"requirements.txt\"), \" instead:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"django-pylibmc-sasl==0.2.4\\npylibmc==1.3.0\\n\")), mdx(\"p\", null, \"If you are happy to install these dependencies locally, then run this command once memcached and libmemcached are installed:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ pip install pylibmc django-pylibmc-sasl\\n\")), mdx(\"p\", null, \"With that done let's configure Memcached. Open up the settings file and add the following at the bottom:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"def get_cache():\\n  import os\\n  try:\\n    os.environ['MEMCACHE_SERVERS'] = os.environ['MEMCACHIER_SERVERS'].replace(',', ';')\\n    os.environ['MEMCACHE_USERNAME'] = os.environ['MEMCACHIER_USERNAME']\\n    os.environ['MEMCACHE_PASSWORD'] = os.environ['MEMCACHIER_PASSWORD']\\n    return {\\n      'default': {\\n        'BACKEND': 'django_pylibmc.memcached.PyLibMCCache',\\n        'TIMEOUT': 300,\\n        'BINARY': True,\\n        'OPTIONS': { 'tcp_nodelay': True }\\n      }\\n    }\\n  except:\\n    return {\\n      'default': {\\n        'BACKEND': 'django.core.cache.backends.locmem.LocMemCache'\\n      }\\n    }\\n\\nCACHES = get_cache()\\nCACHE_MIDDLEWARE_ALIAS = 'default'\\nCACHE_MIDDLEWARE_SECONDS = 300\\nCACHE_MIDDLEWARE_KEY_PREFIX = ''\\n\")), mdx(\"p\", null, \"Then add the following to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MIDDLEWARE_CLASSES\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"    'django.middleware.cache.UpdateCacheMiddleware',\\n    'django.middleware.common.CommonMiddleware',\\n    'django.middleware.cache.FetchFromCacheMiddleware',\\n\")), mdx(\"p\", null, \"That's it! The first section configures the application to use Memcached to cache the content when running on Heroku, and sets some configuration parameters, while the second  section tells Django to use the per-site cache in order to cache all the site content.\"), mdx(\"p\", null, \"Now, Heroku doesn't include Memcached by default - instead it's available as an add-on called Memcachier. To use add-ons you need to set up a credit card for billing. We will set it up to use the free developer plan, but if you outgrow this you can easily switch to a paid plan. To add Memcachier, run this command:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ heroku addons:add memcachier:dev\\n\")), mdx(\"p\", null, \"Please note that Memcachier can take a few minutes to get set up, so you may want to leave it a little while between adding it and pushing up your changes. Now we'll commit our changes:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add requirements.txt django_tutorial_blog_ng/settings.py\\n$ git commit -m 'Implemented caching with Memcached'\\n\")), mdx(\"p\", null, \"Then we'll push them up to our remote repository and to Heroku:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git push origin master\\n$ git push heroku master\\n\")), mdx(\"p\", null, \"And that's all you need to do to set up Memcached. In addition to storing your query results in Memcached, enabling the caching framework in Django will also set various HTTP headers to enable web proxies and browsers to cache content for an appropriate length of time. If you open up your browser's developer tools and compare the response headers for your homepage on the latest version of the code with the previous version, you'll notice that a number of additional headers appear, including \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Cache-Control\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Expires\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Last-Modified\"), \". These tell web browsers and web proxies how often to request the latest version of the HTML document, in order to help you reduce the bandwidth used.\"), mdx(\"p\", null, \"As you can see, for a site like this where you are the only person adding content, it's really easy to implement caching with Django, and for a blog there's very little reason not to do it. If you're not using Heroku and are instead hosting your site on a VPS, then the configuration will be somewhat different - see \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.djangoproject.com/en/dev/topics/cache/#memcached\"\n  }, \"here\"), \" for details. You can also find information on using other cache backends on the same page.\"), mdx(\"p\", null, \"That isn't all you can do to speed up your site. Heroku doesn't seem to be very good for serving static files, and if your site is attracting a lot of traffic you might want to host your static files elsewhere, such as on Amazon's S3 service. Doing so is outside the scope of this tutorial, but for that use case, you should check out \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://django-storages.readthedocs.org/en/latest/index.html\"\n  }, \"django-storages\"), \".\"), mdx(\"h1\", null, \"Clearing the cache automatically\"), mdx(\"p\", null, \"There is one issue with this implementation. As it is right now, if you view the home page, add a post, then reload the page, you may not see the new post immediately because the cache will continue serving the old version until it has expired. That behaviour is less than ideal - we would like the cache to be cleared automatically when a new post gets added so that users will see the new version immediately. That response will still be cached afterwards, so it only means one extra query.\"), mdx(\"p\", null, \"This is the ideal place to introduce \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.djangoproject.com/en/dev/topics/signals/\"\n  }, \"signals\"), \". Signals are a way to carry out a given action when an event takes place. In our case, we plan to clear the cache when a post is saved (either created or updated).\"), mdx(\"p\", null, \"Note that as we'll be testing the behaviour of the cache at this point, you'll need to install Memcached on your local machine, and we'll need to change the settings to fall back to our local Memcached instance:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"def get_cache():\\n  import os\\n  try:\\n    os.environ['MEMCACHE_SERVERS'] = os.environ['MEMCACHIER_SERVERS'].replace(',', ';')\\n    os.environ['MEMCACHE_USERNAME'] = os.environ['MEMCACHIER_USERNAME']\\n    os.environ['MEMCACHE_PASSWORD'] = os.environ['MEMCACHIER_PASSWORD']\\n    return {\\n      'default': {\\n        'BACKEND': 'django_pylibmc.memcached.PyLibMCCache',\\n        'TIMEOUT': 300,\\n        'BINARY': True,\\n        'OPTIONS': { 'tcp_nodelay': True }\\n      }\\n    }\\n  except:\\n    return {\\n      'default': {\\n        'BACKEND': 'django.core.cache.backends.memcached.PyLibMCCache',\\n        'LOCATION': '127.0.0.1:11211'\\n      }\\n    }\\n\\nCACHES = get_cache()\\nCACHE_MIDDLEWARE_ALIAS = 'default'\\nCACHE_MIDDLEWARE_SECONDS = 300\\nCACHE_MIDDLEWARE_KEY_PREFIX = ''\\n\")), mdx(\"p\", null, \"If you don't want to install Memcached locally, you can skip this step, but be aware that the test we write for clearing the cache will always pass if you do skip it.\"), mdx(\"p\", null, \"Then we'll run our tests to make sure nothing has been broken:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py jenkins blogengine\\nCreating test database for alias 'default'...\\n.......................\\n----------------------------------------------------------------------\\nRan 23 tests in 6.164s\\n\\nOK\\n\")), mdx(\"p\", null, \"Let's commit:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add django_tutorial_blog_ng/settings.py\\n$ git commit -m 'Now use Memcached in development'\\n\")), mdx(\"p\", null, \"Now we'll add a test for clearing the cache to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PostViewTest\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"    def test_clear_cache(self):\\n        # Create the category\\n        category = Category()\\n        category.name = 'python'\\n        category.description = 'The Python programming language'\\n        category.save()\\n\\n        # Create the tag\\n        tag = Tag()\\n        tag.name = 'perl'\\n        tag.description = 'The Perl programming language'\\n        tag.save()\\n\\n        # Create the author\\n        author = User.objects.create_user('testuser', 'user@example.com', 'password')\\n        author.save()\\n\\n        # Create the site\\n        site = Site()\\n        site.name = 'example.com'\\n        site.domain = 'example.com'\\n        site.save()\\n\\n        # Create the first post\\n        post = Post()\\n        post.title = 'My first post'\\n        post.text = 'This is [my first blog post](http://127.0.0.1:8000/)'\\n        post.slug = 'my-first-post'\\n        post.pub_date = timezone.now()\\n        post.author = author\\n        post.site = site\\n        post.category = category\\n        post.save()\\n        post.tags.add(tag)\\n\\n        # Check new post saved\\n        all_posts = Post.objects.all()\\n        self.assertEquals(len(all_posts), 1)\\n\\n        # Fetch the index\\n        response = self.client.get('/')\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Create the second post\\n        post = Post()\\n        post.title = 'My second post'\\n        post.text = 'This is [my second blog post](http://127.0.0.1:8000/)'\\n        post.slug = 'my-second-post'\\n        post.pub_date = timezone.now()\\n        post.author = author\\n        post.site = site\\n        post.category = category\\n        post.save()\\n        post.tags.add(tag)\\n\\n        # Fetch the index again\\n        response = self.client.get('/')\\n\\n        # Check second post present\\n        self.assertTrue('my second blog post' in response.content)\\n\")), mdx(\"p\", null, \"This should be fairly self-explanatory. We create one post, and request the index page. We then add a second post, request the index page again, and check for the second post. The test should fail because the cached version is returned, rather than the version in the database.\"), mdx(\"p\", null, \"Now we have a test in place, we can implement a fix. First, add this to the top of your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"models.py\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"from django.db.models.signals import post_save\\nfrom django.core.cache import cache\\n\")), mdx(\"p\", null, \"Then add the following at the bottom of the file:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"\\n#\\xA0Define signals\\ndef new_post(sender, instance, created, **kwargs):\\n    cache.clear()\\n\\n#\\xA0Set up signals\\npost_save.connect(new_post, sender=Post)\\n\")), mdx(\"p\", null, \"This is fairly straightforward. What we're doing is first defining a function called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"new_post\"), \" that is called when a new post is created. We then connect it to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"post_save\"), \" signal. When a post is saved, it calls \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"new_post\"), \", which clears the cache, making sure users are seeing the latest and greatest version of your site immediately.\"), mdx(\"p\", null, \"Let's test it:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py jenkins blogengine\\nCreating test database for alias 'default'...\\n........................\\n----------------------------------------------------------------------\\nRan 24 tests in 8.473s\\n\\nOK\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"There are a number of signals available, and when you create one, you have access to the created object via the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"instance\"), \" parameter. Using signals you can implement all kinds of functionality. For instance, you could implement the functionality to send an email when a new post is published.\"), mdx(\"p\", null, \"If you're using Travis CI, you'll also need to update the config file:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"language: python\\npython:\\n- \\\"2.7\\\"\\nservices: memcached\\nbefore_install:\\n    - sudo apt-get install -y libmemcached-dev\\n# command to install dependencies\\ninstall: \\\"pip install -r requirements.txt\\\"\\n# command to run tests\\nscript: coverage run --include=\\\"blogengine/*\\\" --omit=\\\"blogengine/migrations/*\\\" manage.py test blogengine\\nafter_success:\\n    coveralls\\n\")), mdx(\"p\", null, \"Time to commit:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add blogengine/ .travis.yml\\n$ git commit -m 'Now clear cache when post added'\\n\")), mdx(\"h1\", null, \"Formatting for RSS feeds\"), mdx(\"p\", null, \"Now, we want to offer more than one option for RSS feeds. For instance, if your blog is aggregated on a site such as \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://planet.python.org/\"\n  }, \"Planet Python\"), \", but you also blog about JavaScript, you may want to be able to provide a feed for posts in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"python\"), \" category only.\"), mdx(\"p\", null, \"If you have written any posts that use any of Markdown's custom formatting, you may notice that if you load your RSS feed in a reader, it isn't formatted as Markdown. Let's fix that. First we'll amend our test:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"class FeedTest(BaseAcceptanceTest):\\n    def test_all_post_feed(self):\\n        # Create the category\\n        category = Category()\\n        category.name = 'python'\\n        category.description = 'The Python programming language'\\n        category.save()\\n\\n        # Create the tag\\n        tag = Tag()\\n        tag.name = 'python'\\n        tag.description = 'The Python programming language'\\n        tag.save()\\n\\n        # Create the author\\n        author = User.objects.create_user('testuser', 'user@example.com', 'password')\\n        author.save()\\n\\n        # Create the site\\n        site = Site()\\n        site.name = 'example.com'\\n        site.domain = 'example.com'\\n        site.save()\\n \\n        # Create a post\\n        post = Post()\\n        post.title = 'My first post'\\n        post.text = 'This is my *first* blog post'\\n        post.slug = 'my-first-post'\\n        post.pub_date = timezone.now()\\n        post.author = author\\n        post.site = site\\n        post.category = category\\n\\n        # Save it\\n        post.save()\\n\\n        # Add the tag\\n        post.tags.add(tag)\\n        post.save()\\n\\n        # Check we can find it\\n        all_posts = Post.objects.all()\\n        self.assertEquals(len(all_posts), 1)\\n        only_post = all_posts[0]\\n        self.assertEquals(only_post, post)\\n\\n        # Fetch the feed\\n        response = self.client.get('/feeds/posts/')\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Parse the feed\\n        feed = feedparser.parse(response.content)\\n\\n        # Check length\\n        self.assertEquals(len(feed.entries), 1)\\n\\n        # Check post retrieved is the correct one\\n        feed_post = feed.entries[0]\\n        self.assertEquals(feed_post.title, post.title)\\n        self.assertTrue('This is my <em>first</em> blog post' in feed_post.description)\\n\")), mdx(\"p\", null, \"Don't forget to run the tests to make sure they fail. Now, let's fix it:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"from django.shortcuts import render\\nfrom django.views.generic import ListView\\nfrom blogengine.models import Category, Post, Tag\\nfrom django.contrib.syndication.views import Feed\\nfrom django.utils.encoding import force_unicode\\nfrom django.utils.safestring import mark_safe\\nimport markdown2\\n\\n# Create your views here.\\nclass CategoryListView(ListView):\\n    def get_queryset(self):\\n        slug = self.kwargs['slug']\\n        try:\\n            category = Category.objects.get(slug=slug)\\n            return Post.objects.filter(category=category)\\n        except Category.DoesNotExist:\\n            return Post.objects.none()\\n\\n\\nclass TagListView(ListView):\\n    def get_queryset(self):\\n        slug = self.kwargs['slug']\\n        try:\\n            tag = Tag.objects.get(slug=slug)\\n            return tag.post_set.all()\\n        except Tag.DoesNotExist:\\n            return Post.objects.none()\\n\\n\\nclass PostsFeed(Feed):\\n    title = \\\"RSS feed - posts\\\"\\n    link = \\\"feeds/posts/\\\"\\n    description = \\\"RSS feed - blog posts\\\"\\n\\n    def items(self):\\n        return Post.objects.order_by('-pub_date')\\n\\n    def item_title(self, item):\\n        return item.title\\n\\n    def item_description(self, item):\\n        extras = [\\\"fenced-code-blocks\\\"]\\n        content = mark_safe(markdown2.markdown(force_unicode(item.text),\\n                                               extras = extras))\\n        return content\\n\")), mdx(\"p\", null, \"All we're doing here is amending the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"item_description\"), \" method of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PostsFeed\"), \" to render it as Markdown. Now let's run our tests again:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py jenkins\\nCreating test database for alias 'default'...\\n........................\\n----------------------------------------------------------------------\\nRan 24 tests in 9.370s\\n\\nOK\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"With that done, we'll commit our changes:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add blogengine/\\n$ git commit -m 'Fixed rendering for post feed'\\n\")), mdx(\"h1\", null, \"Refactoring our tests\"), mdx(\"p\", null, \"Now, before we get into implementing the feed, our tests are a bit verbose. We create a lot of items over and over again - let's sort that out. Factory Boy is a handy Python module that allows you to create easy-to-use factories for creating objects over and over again in tests. Let's install it:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ pip install factory_boy\\n$ pip freeze > requirements.txt\\n$ git add requirements.txt\\n$ git commit -m 'Installed Factory Boy'\\n\")), mdx(\"p\", null, \"Now let's set up a factory for creating posts. Add this at the top of the test file:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"import factory.django\\n\")), mdx(\"p\", null, \"Then, before your actual tests, insert the following:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"# Factories\\nclass SiteFactory(factory.django.DjangoModelFactory):\\n    class Meta:\\n        model = Site\\n        django_get_or_create = (\\n            'name',\\n            'domain'\\n        )\\n        \\n    name = 'example.com'\\n    domain = 'example.com'\\n\")), mdx(\"p\", null, \"Now, wherever you call \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Site()\"), \", add its attributes, and save it, replace those lines with the following:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"        site = SiteFactory()\\n\")), mdx(\"p\", null, \"Much simpler and more concise, I'm sure you'll agree! Now, let's run the tests to make sure they aren't broken:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py test blogengine\\nCreating test database for alias 'default'...\\n........................\\n----------------------------------------------------------------------\\nRan 24 tests in 7.482s\\n\\nOK\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"Let's commit again:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add blogengine/tests.py\\n$ git commit -m 'Now use Factory Boy for site objects'\\n\")), mdx(\"p\", null, \"Let's do the same thing with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Category\"), \" objects:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"class CategoryFactory(factory.django.DjangoModelFactory):\\n    class Meta:\\n        model = Category\\n        django_get_or_create = (\\n            'name',\\n            'description',\\n            'slug'\\n        )\\n\\n    name = 'python'\\n    description = 'The Python programming language'\\n    slug = 'python'\\n\")), mdx(\"p\", null, \"Again, just find every time we call \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Category()\"), \" and replace it with the following:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"        category = CategoryFactory()\\n\")), mdx(\"p\", null, \"Now if we run our tests, we'll notice a serious error:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py test blogengine\\nCreating test database for alias 'default'...\\nEE..EE.EE.EE...E.EEE..E.\\n======================================================================\\nERROR: test_create_category (blogengine.tests.PostTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 42, in test_create_category\\n    category = CategoryFactory()\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 82, in __call__\\n    return cls.create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 585, in create\\n    return cls._generate(True, attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 510, in _generate\\n    obj = cls._prepare(create, **attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 485, in _prepare\\n    return cls._create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 151, in _create\\n    return cls._get_or_create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 142, in _get_or_create\\n    obj, _created = manager.get_or_create(*args, **key_fields)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py\\\", line 154, in get_or_create\\n    return self.get_queryset().get_or_create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py\\\", line 383, in get_or_create\\n    obj.save(force_insert=True, using=self.db)\\nTypeError: save() got an unexpected keyword argument 'force_insert'\\n\\n======================================================================\\nERROR: test_create_post (blogengine.tests.PostTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 80, in test_create_post\\n    category = CategoryFactory()\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 82, in __call__\\n    return cls.create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 585, in create\\n    return cls._generate(True, attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 510, in _generate\\n    obj = cls._prepare(create, **attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 485, in _prepare\\n    return cls._create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 151, in _create\\n    return cls._get_or_create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 142, in _get_or_create\\n    obj, _created = manager.get_or_create(*args, **key_fields)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py\\\", line 154, in get_or_create\\n    return self.get_queryset().get_or_create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py\\\", line 383, in get_or_create\\n    obj.save(force_insert=True, using=self.db)\\nTypeError: save() got an unexpected keyword argument 'force_insert'\\n\\n======================================================================\\nERROR: test_create_post (blogengine.tests.AdminTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 339, in test_create_post\\n    category = CategoryFactory()\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 82, in __call__\\n    return cls.create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 585, in create\\n    return cls._generate(True, attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 510, in _generate\\n    obj = cls._prepare(create, **attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 485, in _prepare\\n    return cls._create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 151, in _create\\n    return cls._get_or_create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 142, in _get_or_create\\n    obj, _created = manager.get_or_create(*args, **key_fields)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py\\\", line 154, in get_or_create\\n    return self.get_queryset().get_or_create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py\\\", line 383, in get_or_create\\n    obj.save(force_insert=True, using=self.db)\\nTypeError: save() got an unexpected keyword argument 'force_insert'\\n\\n======================================================================\\nERROR: test_create_post_without_tag (blogengine.tests.AdminTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 378, in test_create_post_without_tag\\n    category = CategoryFactory()\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 82, in __call__\\n    return cls.create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 585, in create\\n    return cls._generate(True, attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 510, in _generate\\n    obj = cls._prepare(create, **attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 485, in _prepare\\n    return cls._create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 151, in _create\\n    return cls._get_or_create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 142, in _get_or_create\\n    obj, _created = manager.get_or_create(*args, **key_fields)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py\\\", line 154, in get_or_create\\n    return self.get_queryset().get_or_create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py\\\", line 383, in get_or_create\\n    obj.save(force_insert=True, using=self.db)\\nTypeError: save() got an unexpected keyword argument 'force_insert'\\n\\n======================================================================\\nERROR: test_delete_category (blogengine.tests.AdminTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 245, in test_delete_category\\n    category = CategoryFactory()\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 82, in __call__\\n    return cls.create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 585, in create\\n    return cls._generate(True, attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 510, in _generate\\n    obj = cls._prepare(create, **attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 485, in _prepare\\n    return cls._create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 151, in _create\\n    return cls._get_or_create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 142, in _get_or_create\\n    obj, _created = manager.get_or_create(*args, **key_fields)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py\\\", line 154, in get_or_create\\n    return self.get_queryset().get_or_create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py\\\", line 383, in get_or_create\\n    obj.save(force_insert=True, using=self.db)\\nTypeError: save() got an unexpected keyword argument 'force_insert'\\n\\n======================================================================\\nERROR: test_delete_post (blogengine.tests.AdminTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 467, in test_delete_post\\n    category = CategoryFactory()\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 82, in __call__\\n    return cls.create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 585, in create\\n    return cls._generate(True, attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 510, in _generate\\n    obj = cls._prepare(create, **attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 485, in _prepare\\n    return cls._create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 151, in _create\\n    return cls._get_or_create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 142, in _get_or_create\\n    obj, _created = manager.get_or_create(*args, **key_fields)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py\\\", line 154, in get_or_create\\n    return self.get_queryset().get_or_create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py\\\", line 383, in get_or_create\\n    obj.save(force_insert=True, using=self.db)\\nTypeError: save() got an unexpected keyword argument 'force_insert'\\n\\n======================================================================\\nERROR: test_edit_category (blogengine.tests.AdminTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 221, in test_edit_category\\n    category = CategoryFactory()\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 82, in __call__\\n    return cls.create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 585, in create\\n    return cls._generate(True, attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 510, in _generate\\n    obj = cls._prepare(create, **attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 485, in _prepare\\n    return cls._create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 151, in _create\\n    return cls._get_or_create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 142, in _get_or_create\\n    obj, _created = manager.get_or_create(*args, **key_fields)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py\\\", line 154, in get_or_create\\n    return self.get_queryset().get_or_create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py\\\", line 383, in get_or_create\\n    obj.save(force_insert=True, using=self.db)\\nTypeError: save() got an unexpected keyword argument 'force_insert'\\n\\n======================================================================\\nERROR: test_edit_post (blogengine.tests.AdminTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 410, in test_edit_post\\n    category = CategoryFactory()\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 82, in __call__\\n    return cls.create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 585, in create\\n    return cls._generate(True, attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 510, in _generate\\n    obj = cls._prepare(create, **attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 485, in _prepare\\n    return cls._create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 151, in _create\\n    return cls._get_or_create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 142, in _get_or_create\\n    obj, _created = manager.get_or_create(*args, **key_fields)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py\\\", line 154, in get_or_create\\n    return self.get_queryset().get_or_create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py\\\", line 383, in get_or_create\\n    obj.save(force_insert=True, using=self.db)\\nTypeError: save() got an unexpected keyword argument 'force_insert'\\n\\n======================================================================\\nERROR: test_all_post_feed (blogengine.tests.FeedTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 810, in test_all_post_feed\\n    category = CategoryFactory()\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 82, in __call__\\n    return cls.create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 585, in create\\n    return cls._generate(True, attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 510, in _generate\\n    obj = cls._prepare(create, **attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 485, in _prepare\\n    return cls._create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 151, in _create\\n    return cls._get_or_create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 142, in _get_or_create\\n    obj, _created = manager.get_or_create(*args, **key_fields)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py\\\", line 154, in get_or_create\\n    return self.get_queryset().get_or_create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py\\\", line 383, in get_or_create\\n    obj.save(force_insert=True, using=self.db)\\nTypeError: save() got an unexpected keyword argument 'force_insert'\\n\\n======================================================================\\nERROR: test_category_page (blogengine.tests.PostViewTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 640, in test_category_page\\n    category = CategoryFactory()\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 82, in __call__\\n    return cls.create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 585, in create\\n    return cls._generate(True, attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 510, in _generate\\n    obj = cls._prepare(create, **attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 485, in _prepare\\n    return cls._create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 151, in _create\\n    return cls._get_or_create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 142, in _get_or_create\\n    obj, _created = manager.get_or_create(*args, **key_fields)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py\\\", line 154, in get_or_create\\n    return self.get_queryset().get_or_create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py\\\", line 383, in get_or_create\\n    obj.save(force_insert=True, using=self.db)\\nTypeError: save() got an unexpected keyword argument 'force_insert'\\n\\n======================================================================\\nERROR: test_clear_cache (blogengine.tests.PostViewTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 753, in test_clear_cache\\n    category = CategoryFactory()\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 82, in __call__\\n    return cls.create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 585, in create\\n    return cls._generate(True, attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 510, in _generate\\n    obj = cls._prepare(create, **attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 485, in _prepare\\n    return cls._create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 151, in _create\\n    return cls._get_or_create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 142, in _get_or_create\\n    obj, _created = manager.get_or_create(*args, **key_fields)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py\\\", line 154, in get_or_create\\n    return self.get_queryset().get_or_create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py\\\", line 383, in get_or_create\\n    obj.save(force_insert=True, using=self.db)\\nTypeError: save() got an unexpected keyword argument 'force_insert'\\n\\n======================================================================\\nERROR: test_index (blogengine.tests.PostViewTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 518, in test_index\\n    category = CategoryFactory()\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 82, in __call__\\n    return cls.create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 585, in create\\n    return cls._generate(True, attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 510, in _generate\\n    obj = cls._prepare(create, **attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 485, in _prepare\\n    return cls._create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 151, in _create\\n    return cls._get_or_create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 142, in _get_or_create\\n\\n\\n    obj, _created = manager.get_or_create(*args, **key_fields)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py\\\", line 154, in get_or_create\\n    return self.get_queryset().get_or_create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py\\\", line 383, in get_or_create\\n    obj.save(force_insert=True, using=self.db)\\nTypeError: save() got an unexpected keyword argument 'force_insert'\\n\\n======================================================================\\nERROR: test_post_page (blogengine.tests.PostViewTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 576, in test_post_page\\n    category = CategoryFactory()\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 82, in __call__\\n    return cls.create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 585, in create\\n    return cls._generate(True, attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 510, in _generate\\n    obj = cls._prepare(create, **attrs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/base.py\\\", line 485, in _prepare\\n    return cls._create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 151, in _create\\n\\n\\n    return cls._get_or_create(model_class, *args, **kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/factory/django.py\\\", line 142, in _get_or_create\\n    obj, _created = manager.get_or_create(*args, **key_fields)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/manager.py\\\", line 154, in get_or_create\\n    return self.get_queryset().get_or_create(**kwargs)\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/venv/lib/python2.7/site-packages/django/db/models/query.py\\\", line 383, in get_or_create\\n    obj.save(force_insert=True, using=self.db)\\nTypeError: save() got an unexpected keyword argument 'force_insert'\\n\\n----------------------------------------------------------------------\\nRan 24 tests in 5.162s\\n\\nFAILED (errors=13)\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"Thankfully, this is easy to fix. We just need to amend the custom \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"save()\"), \" method of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Category\"), \" model:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"    def save(self, *args, **kwargs):\\n        if not self.slug:\\n            self.slug = slugify(unicode(self.name))\\n        super(Category, self).save(*args, **kwargs)\\n\")), mdx(\"p\", null, \"That should resolve the issue:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py jenkins\\nCreating test database for alias 'default'...\\n........................\\n----------------------------------------------------------------------\\nRan 24 tests in 7.749s\\n\\nOK\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"Let's commit again:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add blogengine/\\n$ git commit -m 'Category now uses Factory Boy'\\n\")), mdx(\"p\", null, \"Now let's do the same thing for tags:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"class TagFactory(factory.django.DjangoModelFactory):\\n    class Meta:\\n        model = Tag\\n        django_get_or_create = (\\n            'name',\\n            'description',\\n            'slug'\\n        )\\n\\n    name = 'python'\\n    description = 'The Python programming language'\\n    slug = 'python'\\n\")), mdx(\"p\", null, \"And replace the sections where we create new \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Tag\"), \" objects:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"        tag = TagFactory()\\n\")), mdx(\"p\", null, \"Note that some tags have different values. We can easily pass different values to our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"TagFactory()\"), \" to override the default values:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"        tag = TagFactory(name='perl', description='The Perl programming language')\\n\")), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Tag\"), \" model has the same issue as the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Category\"), \" one did, so let's fix that:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"    def save(self, *args, **kwargs):\\n        if not self.slug:\\n            self.slug = slugify(unicode(self.name))\\n        super(Tag, self).save(*args, **kwargs)\\n\")), mdx(\"p\", null, \"We run our tests again:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py test blogengine/\\nCreating test database for alias 'default'...\\n........................\\n----------------------------------------------------------------------\\nRan 24 tests in 7.153s\\n\\nOK\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"Time to commit again:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add blogengine/\\n$ git commit -m 'Now use Factory Boy for tags'\\n\")), mdx(\"p\", null, \"Next we'll create a factory for adding users. Note that the factory name doesn't have to match the object name, so you can create factories for different types of users. Here we create a factory for authors - you could, for instance, create a separate factory for subscribers if you wanted:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"class AuthorFactory(factory.django.DjangoModelFactory):\\n    class Meta:\\n        model = User\\n        django_get_or_create = ('username','email', 'password',)\\n\\n    username = 'testuser'\\n    email = 'user@example.com'\\n    password = 'password'\\n\")), mdx(\"p\", null, \"And as before, replace those sections where we create users with the following:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"        author = AuthorFactory()\\n\")), mdx(\"p\", null, \"Run the tests again:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py test blogengine\\nCreating test database for alias 'default'...\\n........................\\n----------------------------------------------------------------------\\nRan 24 tests in 5.808s\\n\\nOK\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"We commit our changes:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add blogengine/\\n$ git commit -m 'Now use Factory Boy for creating authors'\\n\")), mdx(\"p\", null, \"Now we'll create a flat page factory:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"\\n\\nclass FlatPageFactory(factory.django.DjangoModelFactory):\\n    class Meta:\\n        model = FlatPage\\n        django_get_or_create = (\\n            'url',\\n            'title',\\n            'content'\\n        )\\n\\n    url = '/about/'\\n    title = 'About me'\\n    content = 'All about me'\\n\")), mdx(\"p\", null, \"And use it for our flat page test:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"        page = FlatPageFactory()\\n\")), mdx(\"p\", null, \"Check the tests pass:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py test blogengine\\nCreating test database for alias 'default'...\\n........................\\n----------------------------------------------------------------------\\nRan 24 tests in 5.796s\\n\\nOK\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"And commit again:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add blogengine/\\n$ git commit -m 'Now use Factory Boy for flat page test'\\n\")), mdx(\"p\", null, \"Now we'll create a final factory for posts:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"class PostFactory(factory.django.DjangoModelFactory):\\n    class Meta:\\n        model = Post\\n        django_get_or_create = (\\n            'title',\\n            'text',\\n            'slug',\\n            'pub_date'\\n        )\\n\\n    title = 'My first post'\\n    text = 'This is my first blog post'\\n    slug = 'my-first-post'\\n    pub_date = timezone.now()\\n    author = factory.SubFactory(AuthorFactory)\\n    site = factory.SubFactory(SiteFactory)\\n    category = factory.SubFactory(CategoryFactory)\\n\")), mdx(\"p\", null, \"This factory is a little bit different. Because our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Post\"), \" model depends on several others, we need to be able to create those additional objects on demand. By designating them as subfactories, we can easily create the associated objects for our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Post\"), \" object.\"), mdx(\"p\", null, \"That means that not only can we get rid of our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Post()\"), \" calls, but we can also get rid of the factory calls to create the associated objects for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Post\"), \" models. Again, I'll leave actually doing this as an exercise for the reader, but you can always refer to the GitHub repository if you're not too sure.\"), mdx(\"p\", null, \"Make sure your tests still pass, then commit the changes:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add blogengine/\\n$ git commit -m 'Now use Factory Boy for testing posts'\\n\")), mdx(\"p\", null, \"Using Factory Boy made a big difference to the size of the test file - I was able to cut it down by over 200 lines of code. As your application gets bigger, it gets harder to maintain, so do what you can to keep the size down.\"), mdx(\"h1\", null, \"Additional RSS feeds\"), mdx(\"p\", null, \"Now, let's implement our additional RSS feeds. First, we'll write a test for the category feed. Add this to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"FeedTest\"), \" class:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"    def test_category_feed(self):\\n        # Create a post\\n        post = PostFactory(text='This is my *first* blog post')\\n\\n        # Create another post in a different category\\n        category = CategoryFactory(name='perl', description='The Perl programming language', slug='perl')\\n        post2 = PostFactory(text='This is my *second* blog post', title='My second post', slug='my-second-post', category=category)\\n\\n        # Fetch the feed\\n        response = self.client.get('/feeds/posts/category/python/')\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Parse the feed\\n        feed = feedparser.parse(response.content)\\n\\n        # Check length\\n        self.assertEquals(len(feed.entries), 1)\\n\\n        # Check post retrieved is the correct one\\n        feed_post = feed.entries[0]\\n        self.assertEquals(feed_post.title, post.title)\\n        self.assertTrue('This is my <em>first</em> blog post' in feed_post.description)\\n\\n        # Check other post is not in this feed\\n        self.assertTrue('This is my <em>second</em> blog post' not in response.content)\\n\")), mdx(\"p\", null, \"Here we create two posts in different categories (note that we create a new category and override the post category for it). We then fetch \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/feeds/posts/category/python/\"), \" and assert that it contains only one post, with the content of the first post and not the content of the second.\"), mdx(\"p\", null, \"Run the tests and they should fail:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py test blogengine\\nCreating test database for alias 'default'...\\n................F........\\n======================================================================\\nFAIL: test_category_feed (blogengine.tests.FeedTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 716, in test_category_feed\\n    self.assertEquals(response.status_code, 200)\\nAssertionError: 404 != 200\\n\\n----------------------------------------------------------------------\\nRan 25 tests in 5.804s\\n\\nFAILED (failures=1)\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"Because we haven't yet implemented that route, we get a 404 error. So let's create a route for this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"from django.conf.urls import patterns, url\\nfrom django.views.generic import ListView, DetailView\\nfrom blogengine.models import Post, Category, Tag\\nfrom blogengine.views import CategoryListView, TagListView, PostsFeed, CategoryPostsFeed\\n\\nurlpatterns = patterns('',\\n    # Index\\n    url(r'^(?P<page>\\\\d+)?/?$', ListView.as_view(\\n        model=Post,\\n        paginate_by=5,\\n        )),\\n\\n    # Individual posts\\n    url(r'^(?P<pub_date__year>\\\\d{4})/(?P<pub_date__month>\\\\d{1,2})/(?P<slug>[a-zA-Z0-9-]+)/?$', DetailView.as_view(\\n        model=Post,\\n        )),\\n\\n    # Categories\\n    url(r'^category/(?P<slug>[a-zA-Z0-9-]+)/?$', CategoryListView.as_view(\\n        paginate_by=5,\\n        model=Category,\\n        )),\\n\\n    # Tags\\n    url(r'^tag/(?P<slug>[a-zA-Z0-9-]+)/?$', TagListView.as_view(\\n        paginate_by=5,\\n        model=Tag,\\n        )),\\n\\n    # Post RSS feed\\n    url(r'^feeds/posts/$', PostsFeed()),\\n\\n    # Category RSS feed\\n    url(r'^feeds/posts/category/(?P<slug>[a-zA-Z0-9-]+)/?$', CategoryPostsFeed()),\\n)\\n\")), mdx(\"p\", null, \"Note that the category RSS feed route is similar to the post RSS feed route, but accepts a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"slug\"), \" parameter. We will use this to pass through the slug for the category in question. Also note we import the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"CategoryPostsFeed\"), \" view. Now, we need to create that view. Fortunately, because it's written as a Python class, we can extend the existing \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PostsFeed\"), \" class. Open up your views file and amend it to look like this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"from django.shortcuts import get_object_or_404\\nfrom django.views.generic import ListView\\nfrom blogengine.models import Category, Post, Tag\\nfrom django.contrib.syndication.views import Feed\\nfrom django.utils.encoding import force_unicode\\nfrom django.utils.safestring import mark_safe\\nimport markdown2\\n\\n# Create your views here.\\nclass CategoryListView(ListView):\\n    def get_queryset(self):\\n        slug = self.kwargs['slug']\\n        try:\\n            category = Category.objects.get(slug=slug)\\n            return Post.objects.filter(category=category)\\n        except Category.DoesNotExist:\\n            return Post.objects.none()\\n\\n\\nclass TagListView(ListView):\\n    def get_queryset(self):\\n        slug = self.kwargs['slug']\\n        try:\\n            tag = Tag.objects.get(slug=slug)\\n            return tag.post_set.all()\\n        except Tag.DoesNotExist:\\n            return Post.objects.none()\\n\\n\\nclass PostsFeed(Feed):\\n    title = \\\"RSS feed - posts\\\"\\n    description = \\\"RSS feed - blog posts\\\"\\n    link = '/'\\n\\n    def items(self):\\n        return Post.objects.order_by('-pub_date')\\n\\n    def item_title(self, item):\\n        return item.title\\n\\n    def item_description(self, item):\\n        extras = [\\\"fenced-code-blocks\\\"]\\n        content = mark_safe(markdown2.markdown(force_unicode(item.text),\\n                                               extras = extras))\\n        return content\\n\\n\\nclass CategoryPostsFeed(PostsFeed):\\n    def get_object(self, request, slug):\\n        return get_object_or_404(Category, slug=slug)\\n\\n    def title(self, obj):\\n        return \\\"RSS feed - blog posts in category %s\\\" % obj.name\\n\\n    def link(self, obj):\\n        return obj.get_absolute_url()\\n\\n    def description(self, obj):\\n        return \\\"RSS feed - blog posts in category %s\\\" % obj.name\\n\\n    def items(self, obj):\\n        return Post.objects.filter(category=obj).order_by('-pub_date')\\n\")), mdx(\"p\", null, \"Note that many of our fields don't have to be explicitly defined as they are inherited from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PostsFeed\"), \". We can't hard-code the title, link or description because they depend on the category, so we instead define methods to return the appropriate text.\"), mdx(\"p\", null, \"Also note \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"get_object()\"), \" - we define this so that we can ensure the category exists. If it doesn't exist, then it returns a 404 error rather than showing an empty feed.\"), mdx(\"p\", null, \"We also override \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"items()\"), \" to filter it to just those posts that are in the given category.\"), mdx(\"p\", null, \"If you run the tests again, they should now pass:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py test blogengine\\nCreating test database for alias 'default'...\\n.........................\\n----------------------------------------------------------------------\\nRan 25 tests in 5.867s\\n\\nOK\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"Let's commit our changes:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add blogengine/\\n$ git commit -m 'Implemented category RSS feed'\\n\")), mdx(\"p\", null, \"Now, we can get our category RSS feed, but how do we navigate to it? Let's add a link to each category page that directs a user to its RSS feed. To do so, we'll need to create a new template for category pages. First, let's add some code to our tests to ensure that the right template is used at all times. Add the following to the end of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"test_index\"), \" method of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PostViewTest\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"        # Check the correct template was used\\n        self.assertTemplateUsed(response, 'blogengine/post_list.html')\\n\")), mdx(\"p\", null, \"Then, add this to the end of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"test_post_page\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"\\n        # Check the correct template was used\\n        self.assertTemplateUsed(response, 'blogengine/post_detail.html')\\n\")), mdx(\"p\", null, \"Finally, add this to the end of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"test_category_page\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"        # Check the correct template was used\\n        self.assertTemplateUsed(response, 'blogengine/category_post_list.html')\\n\")), mdx(\"p\", null, \"These assertions confirm which template was used to generate which request.\"), mdx(\"p\", null, \"Next, we head into our views file:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"class CategoryListView(ListView):\\n    template_name = 'blogengine/category_post_list.html'\\n\\n    def get_queryset(self):\\n        slug = self.kwargs['slug']\\n        try:\\n            category = Category.objects.get(slug=slug)\\n            return Post.objects.filter(category=category)\\n        except Category.DoesNotExist:\\n            return Post.objects.none()\\n\\n    def get_context_data(self, **kwargs):\\n        context = super(CategoryListView, self).get_context_data(**kwargs)\\n        slug = self.kwargs['slug']\\n        try:\\n            context['category'] = Category.objects.get(slug=slug)\\n        except Category.DoesNotExist:\\n            context['category'] = None\\n        return context\\n\")), mdx(\"p\", null, \"Note that we first of all change the template used by this view. Then, we override \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"get_context_data\"), \" to add in additional data. What we're doing is getting the slug that was passed through, looking up any category for which it is the slug, and returning it as additional context data. Using this method, you can easily add additional data that you may wish to render in your Django templates.\"), mdx(\"p\", null, \"Finally, we create our new template:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-django\"\n  }, \"{% extends \\\"blogengine/includes/base.html\\\" %}\\n\\n    {% load custom_markdown %}\\n\\n    {% block content %}\\n        {% if object_list %}\\n            {% for post in object_list %}\\n            <div class=\\\"post col-md-12\\\">\\n            <h1><a href=\\\"{{ post.get_absolute_url }}\\\">{{ post.title }}</a></h1>\\n            <h3>{{ post.pub_date }}</h3>\\n            {{ post.text|custom_markdown }}\\n            </div>\\n            {% if post.category %}\\n            <div class=\\\"col-md-12\\\">\\n            <a href=\\\"{{ post.category.get_absolute_url }}\\\"><span class=\\\"label label-primary\\\">{{ post.category.name }}</span></a>\\n            </div>\\n            {% endif %}\\n            {% if post.tags %}\\n            <div class=\\\"col-md-12\\\">\\n            {% for tag in post.tags.all %}\\n            <a href=\\\"{{ tag.get_absolute_url }}\\\"><span class=\\\"label label-success\\\">{{ tag.name }}</span></a>\\n            {% endfor %}\\n            </div>\\n            {% endif %}\\n            {% endfor %}\\n        {% else %}\\n            <p>No posts found</p>\\n        {% endif %}\\n\\n        <ul class=\\\"pager\\\">\\n        {% if page_obj.has_previous %}\\n        <li class=\\\"previous\\\"><a href=\\\"/{{ page_obj.previous_page_number }}/\\\">Previous Page</a></li>\\n        {% endif %}\\n        {% if page_obj.has_next %}\\n        <li class=\\\"next\\\"><a href=\\\"/{{ page_obj.next_page_number }}/\\\">Next Page</a></li>\\n        {% endif %}\\n        </ul>\\n\\n        <a href=\\\"/feeds/posts/category/{{ category.slug }}/\\\">RSS feed for category {{ category.name }}</a>\\n\\n    {% endblock %}\\n\")), mdx(\"p\", null, \"Note that the category has been passed through to the template and is now accessible. If you run the tests, they should now pass:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py jenkins\\nCreating test database for alias 'default'...\\n.........................\\n----------------------------------------------------------------------\\nRan 25 tests in 7.232s\\n\\nOK\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"With that done. we can commit our changes:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add templates/ blogengine/\\n$ git commit -m 'Added link to RSS feed from category page'\\n\")), mdx(\"p\", null, \"Next up, let's implement another RSS feed for tags. First, we'll implement our test:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"      def test_tag_feed(self):\\n          #\\xA0Create a post\\n          post = PostFactory(text='This is my *first* blog post')\\n          tag = TagFactory()\\n          post.tags.add(tag)\\n          post.save()\\n\\n          #\\xA0Create another post with a different tag\\n          tag2 = TagFactory(name='perl', description='The Perl programming language', slug='perl')\\n          post2 = PostFactory(text='This is my *second* blog post', title='My second post', slug='my-second-post')\\n          post2.tags.add(tag2)\\n          post2.save()\\n\\n          #\\xA0Fetch the feed\\n          response = self.client.get('/feeds/posts/tag/python/')\\n          self.assertEquals(response.status_code, 200)\\n\\n          #\\xA0Parse the feed\\n          feed = feedparser.parse(response.content)\\n\\n          #\\xA0Check length\\n          self.assertEquals(len(feed.entries), 1)\\n\\n          # Check post retrieved is the correct one\\n          feed_post = feed.entries[0]\\n          self.assertEquals(feed_post.title, post.title)\\n          self.assertTrue('This is my <em>first</em> blog post' in feed_post.description)\\n\\n          #\\xA0Check other post is not in this feed\\n          self.assertTrue('This is my <em>second</em> blog post' not in response.content)\\n\")), mdx(\"p\", null, \"This is virtually identical to the test for the category feed, but we adjust it to work with the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Tag\"), \" attribute and change the URL. Let's check that our test fails:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py test blogengine\\nCreating test database for alias 'default'...\\n.................F........\\n======================================================================\\nFAIL: test_tag_feed (blogengine.tests.FeedTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 757, in test_tag_feed\\n    self.assertEquals(response.status_code, 200)\\nAssertionError: 404 != 200\\n\\n----------------------------------------------------------------------\\nRan 26 tests in 5.760s\\n\\nFAILED (failures=1)\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"As before, we create a route for this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"from django.conf.urls import patterns, url\\nfrom django.views.generic import ListView, DetailView\\nfrom blogengine.models import Post, Category, Tag\\nfrom blogengine.views import CategoryListView, TagListView, PostsFeed, CategoryPostsFeed, TagPostsFeed\\n\\nurlpatterns = patterns('',\\n    # Index\\n    url(r'^(?P<page>\\\\d+)?/?$', ListView.as_view(\\n        model=Post,\\n        paginate_by=5,\\n        )),\\n\\n    # Individual posts\\n    url(r'^(?P<pub_date__year>\\\\d{4})/(?P<pub_date__month>\\\\d{1,2})/(?P<slug>[a-zA-Z0-9-]+)/?$', DetailView.as_view(\\n        model=Post,\\n        )),\\n\\n    # Categories\\n    url(r'^category/(?P<slug>[a-zA-Z0-9-]+)/?$', CategoryListView.as_view(\\n        paginate_by=5,\\n        model=Category,\\n        )),\\n\\n    # Tags\\n    url(r'^tag/(?P<slug>[a-zA-Z0-9-]+)/?$', TagListView.as_view(\\n        paginate_by=5,\\n        model=Tag,\\n        )),\\n\\n    # Post RSS feed\\n    url(r'^feeds/posts/$', PostsFeed()),\\n\\n    # Category RSS feed\\n    url(r'^feeds/posts/category/(?P<slug>[a-zA-Z0-9-]+)/?$', CategoryPostsFeed()),\\n\\n    # Tag RSS feed\\n    url(r'^feeds/posts/tag/(?P<slug>[a-zA-Z0-9-]+)/?$', TagPostsFeed()),\\n)\\n\")), mdx(\"p\", null, \"Next, we create our view:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"class TagPostsFeed(PostsFeed):\\n    def get_object(self, request, slug):\\n        return get_object_or_404(Tag, slug=slug)\\n\\n    def title(self, obj):\\n        return \\\"RSS feed - blog posts tagged  %s\\\" % obj.name\\n\\n    def link(self, obj):\\n        return obj.get_absolute_url()\\n\\n    def description(self, obj):\\n        return \\\"RSS feed - blog posts tagged %s\\\" % obj.name\\n\\n    def items(self, obj):\\n        try:\\n            tag = Tag.objects.get(slug=obj.slug)\\n            return tag.post_set.all()\\n        except Tag.DoesNotExist:\\n            return Post.objects.none()\\n\")), mdx(\"p\", null, \"Again, this inherits from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"PostsFeed\"), \", but the syntax for getting posts matching a tag is slightly different because they use a many-to-many relationship.\"), mdx(\"p\", null, \"We also need a template for the tag pages. Add this to the end of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"test_tag_page\"), \" method:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"\\n        # Check the correct template was used\\n        self.assertTemplateUsed(response, 'blogengine/tag_post_list.html')\\n\")), mdx(\"p\", null, \"Let's create that template:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-django\"\n  }, \"{% extends \\\"blogengine/includes/base.html\\\" %}\\n\\n    {% load custom_markdown %}\\n\\n    {% block content %}\\n        {% if object_list %}\\n            {% for post in object_list %}\\n            <div class=\\\"post col-md-12\\\">\\n            <h1><a href=\\\"{{ post.get_absolute_url }}\\\">{{ post.title }}</a></h1>\\n            <h3>{{ post.pub_date }}</h3>\\n            {{ post.text|custom_markdown }}\\n            </div>\\n            {% if post.category %}\\n            <div class=\\\"col-md-12\\\">\\n            <a href=\\\"{{ post.category.get_absolute_url }}\\\"><span class=\\\"label label-primary\\\">{{ post.category.name }}</span></a>\\n            </div>\\n            {% endif %}\\n            {% if post.tags %}\\n            <div class=\\\"col-md-12\\\">\\n            {% for tag in post.tags.all %}\\n            <a href=\\\"{{ tag.get_absolute_url }}\\\"><span class=\\\"label label-success\\\">{{ tag.name }}</span></a>\\n            {% endfor %}\\n            </div>\\n            {% endif %}\\n            {% endfor %}\\n        {% else %}\\n            <p>No posts found</p>\\n        {% endif %}\\n\\n        <ul class=\\\"pager\\\">\\n        {% if page_obj.has_previous %}\\n        <li class=\\\"previous\\\"><a href=\\\"/{{ page_obj.previous_page_number }}/\\\">Previous Page</a></li>\\n        {% endif %}\\n        {% if page_obj.has_next %}\\n        <li class=\\\"next\\\"><a href=\\\"/{{ page_obj.next_page_number }}/\\\">Next Page</a></li>\\n        {% endif %}\\n        </ul>\\n\\n        <a href=\\\"/feeds/posts/tag/{{ tag.slug }}/\\\">RSS feed for tag {{ tag.name }}</a>\\n\\n    {% endblock %}\\n\")), mdx(\"p\", null, \"This is virtually identical to the category template. You'll also need to apply this template in the view for the tag list, and pass the tag name through as context data:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"class TagListView(ListView):\\n    template_name = 'blogengine/tag_post_list.html'\\n\\n    def get_queryset(self):\\n        slug = self.kwargs['slug']\\n        try:\\n            tag = Tag.objects.get(slug=slug)\\n            return tag.post_set.all()\\n        except Tag.DoesNotExist:\\n            return Post.objects.none()\\n\\n    def get_context_data(self, **kwargs):\\n        context = super(TagListView, self).get_context_data(**kwargs)\\n        slug = self.kwargs['slug']\\n        try:\\n            context['tag'] = Tag.objects.get(slug=slug)\\n        except Tag.DoesNotExist:\\n            context['tag'] = None\\n        return context\\n\")), mdx(\"p\", null, \"Let's run our tests:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py test blogengine\\nCreating test database for alias 'default'...\\n..........................\\n----------------------------------------------------------------------\\nRan 26 tests in 5.770s\\n\\nOK\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"You may want to do a quick check to ensure your tag feed link works as expected. Time to commit:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add blogengine templates\\n$ git commit -m 'Implemented tag feeds'\\n\")), mdx(\"h1\", null, \"Moving our templates\"), mdx(\"p\", null, \"Before we crack on with implementing search, there's one more piece of housekeeping. In Django, templates can be applied at project level or at app level. So far, we've been storing them in the project, but we would like our app to be as self-contained as possible so it can just be dropped into future projects where we need a blog. That way, it can be easily overridden for specific projects. You can move the folders and update the Git repository at the same time with this command:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git mv templates/ blogengine/\\n\")), mdx(\"p\", null, \"We run the tests to make sure nothing untoward has happened:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py test\\nCreating test database for alias 'default'...\\n..........................\\n----------------------------------------------------------------------\\nRan 26 tests in 5.847s\\n\\nOK\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"And we commit:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git commit -m 'Moved templates'\\n\")), mdx(\"p\", null, \"Note that \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"git mv\"), \" updates Git and moves the files, so you don't need to call \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"git add\"), \".\"), mdx(\"h1\", null, \"Implementing search\"), mdx(\"p\", null, \"For our final task today, we will be implementing a very simple search engine. Our requirements are:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It should be in the header, to allow for easy access from anywhere in the front end.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It should search the title and text of posts.\")), mdx(\"p\", null, \"First, we'll write our tests:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"class SearchViewTest(BaseAcceptanceTest):\\n    def test_search(self):\\n        # Create a post\\n        post = PostFactory()\\n\\n        # Create another post\\n        post2 = PostFactory(text='This is my *second* blog post', title='My second post', slug='my-second-post')\\n\\n        # Search for first post\\n        response = self.client.get('/search?q=first')\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Check the first post is contained in the results\\n        self.assertTrue('My first post' in response.content)\\n\\n        # Check the second post is not contained in the results\\n        self.assertTrue('My second post' not in response.content)\\n\\n        # Search for second post\\n        response = self.client.get('/search?q=second')\\n        self.assertEquals(response.status_code, 200)\\n\\n        # Check the first post is not contained in the results\\n        self.assertTrue('My first post' not in response.content)\\n\\n        # Check the second post is contained in the results\\n        self.assertTrue('My second post' in response.content)\\n\")), mdx(\"p\", null, \"Don't forget to run the tests to make sure they fail:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py test\\nCreating test database for alias 'default'...\\n..........................F\\n======================================================================\\nFAIL: test_search (blogengine.tests.SearchViewTest)\\n----------------------------------------------------------------------\\nTraceback (most recent call last):\\n  File \\\"/Users/matthewdaly/Projects/django_tutorial_blog_ng/blogengine/tests.py\\\", line 819, in test_search\\n    self.assertEquals(response.status_code, 200)\\nAssertionError: 404 != 200\\n\\n----------------------------------------------------------------------\\nRan 27 tests in 6.919s\\n\\nFAILED (failures=1)\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"With that done, we can add the search form to the header:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-django\"\n  }, \"<!DOCTYPE html>\\n<!--[if lt IE 7]>      <html class=\\\"no-js lt-ie9 lt-ie8 lt-ie7\\\"> <![endif]-->\\n<!--[if IE 7]>         <html class=\\\"no-js lt-ie9 lt-ie8\\\"> <![endif]-->\\n<!--[if IE 8]>         <html class=\\\"no-js lt-ie9\\\"> <![endif]-->\\n<!--[if gt IE 8]><!--> <html class=\\\"no-js\\\"> <!--<![endif]-->\\n    <head>\\n        <meta charset=\\\"utf-8\\\">\\n        <meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=edge\\\">\\n        <title>{% block title %}My Django Blog{% endblock %}</title>\\n        <meta name=\\\"description\\\" content=\\\"\\\">\\n        <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1\\\">\\n        <link rel=\\\"alternate\\\" type=\\\"application/rss+xml\\\" title=\\\"Blog posts\\\" href=\\\"/feeds/posts/\\\" >\\n\\n        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->\\n\\n        {% load staticfiles %}\\n        <link rel=\\\"stylesheet\\\" href=\\\"{% static 'bower_components/html5-boilerplate/css/normalize.css' %}\\\">\\n        <link rel=\\\"stylesheet\\\" href=\\\"{% static 'bower_components/html5-boilerplate/css/main.css' %}\\\">\\n        <link rel=\\\"stylesheet\\\" href=\\\"{% static 'bower_components/bootstrap/dist/css/bootstrap.min.css' %}\\\">\\n        <link rel=\\\"stylesheet\\\" href=\\\"{% static 'bower_components/bootstrap/dist/css/bootstrap-theme.min.css' %}\\\">\\n        <link rel=\\\"stylesheet\\\" href=\\\"{% static 'css/main.css' %}\\\">\\n        <link rel=\\\"stylesheet\\\" href=\\\"{% static 'css/code.css' %}\\\">\\n        <script src=\\\"{% static 'bower_components/html5-boilerplate/js/vendor/modernizr-2.6.2.min.js' %}\\\"></script>\\n    </head>\\n    <body>\\n        <!--[if lt IE 7]>\\n            <p class=\\\"browsehappy\\\">You are using an <strong>outdated</strong> browser. Please <a href=\\\"http://browsehappy.com/\\\">upgrade your browser</a> to improve your experience.</p>\\n        <![endif]-->\\n\\n        <!-- Add your site or application content here -->\\n\\n        <div id=\\\"fb-root\\\"></div>\\n        <script>(function(d, s, id) {\\n            var js, fjs = d.getElementsByTagName(s)[0];\\n            if (d.getElementById(id)) return;\\n                js = d.createElement(s); js.id = id;\\n                js.src = \\\"//connect.facebook.net/en_GB/all.js#xfbml=1\\\";\\n                fjs.parentNode.insertBefore(js, fjs);\\n            }(document, 'script', 'facebook-jssdk'));</script>\\n\\n        <div class=\\\"navbar navbar-static-top navbar-inverse\\\">\\n            <div class=\\\"container-fluid\\\">\\n                <div class=\\\"navbar-header\\\">\\n                    <button type=\\\"button\\\" class=\\\"navbar-toggle\\\" data-toggle=\\\"collapse\\\" data-target=\\\"#header-nav\\\">\\n                        <span class=\\\"icon-bar\\\"></span>\\n                        <span class=\\\"icon-bar\\\"></span>\\n                        <span class=\\\"icon-bar\\\"></span>\\n                    </button>\\n                    <a class=\\\"navbar-brand\\\" href=\\\"/\\\">My Django Blog</a>\\n                </div>\\n                <div class=\\\"collapse navbar-collapse\\\" id=\\\"header-nav\\\">\\n                    <ul class=\\\"nav navbar-nav\\\">\\n                        {% load flatpages %}\\n                        {% get_flatpages as flatpages %}\\n                        {% for flatpage in flatpages %}\\n                        <li><a href=\\\"{{ flatpage.url }}\\\">{{ flatpage.title }}</a></li>\\n                        {% endfor %}\\n                        <li><a href=\\\"/feeds/posts/\\\">RSS feed</a></li>\\n\\n                        <form action=\\\"/search\\\" method=\\\"GET\\\" class=\\\"navbar-form navbar-left\\\">\\n                            <div class=\\\"form-group\\\">\\n                                <input type=\\\"text\\\" name=\\\"q\\\" placeholder=\\\"Search...\\\" class=\\\"form-control\\\"></input>\\n                            </div>\\n                            <button type=\\\"submit\\\" class=\\\"btn btn-default\\\">Search</button>\\n                        </form>\\n                    </ul>\\n                </div>\\n            </div>\\n        </div>\\n\\n        <div class=\\\"container\\\">\\n            {% block header %}\\n                <div class=\\\"page-header\\\">\\n                    <h1>My Django Blog</h1>\\n                </div>\\n            {% endblock %}\\n\\n            <div class=\\\"row\\\">\\n                {% block content %}{% endblock %}\\n            </div>\\n        </div>\\n\\n        <div class=\\\"container footer\\\">\\n            <div class=\\\"row\\\">\\n                <div class=\\\"span12\\\">\\n                    <p>Copyright &copy; {% now \\\"Y\\\" %}</p>\\n                </div>\\n            </div>\\n        </div>\\n\\n        <script src=\\\"//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js\\\"></script>\\n        <script>window.jQuery || document.write('<script src=\\\"{% static 'bower_components/html5-boilerplate/js/vendor/jquery-1.10.2.min.js' %}\\\"><\\\\/script>')</script>\\n        <script src=\\\"{% static 'bower_components/html5-boilerplate/js/plugins.js' %}\\\"></script>\\n        <script src=\\\"{% static 'bower_components/bootstrap/dist/js/bootstrap.min.js' %}\\\"></script>\\n\\n        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->\\n        <script>\\n            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=\\n            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;\\n            e=o.createElement(i);r=o.getElementsByTagName(i)[0];\\n            e.src='//www.google-analytics.com/analytics.js';\\n            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));\\n            ga('create','UA-XXXXX-X');ga('send','pageview');\\n        </script>\\n    </body>\\n</html>\\n\")), mdx(\"p\", null, \"Now we'll actually implement our search. Implementing search using Django's generic views can be fiddly, so we'll write our search view as a function instead. First, amend the imports at the top of your view file to look like this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"from django.shortcuts import get_object_or_404, render_to_response\\nfrom django.core.paginator import Paginator, EmptyPage\\nfrom django.db.models import Q\\nfrom django.views.generic import ListView\\nfrom blogengine.models import Category, Post, Tag\\nfrom django.contrib.syndication.views import Feed\\nfrom django.utils.encoding import force_unicode\\nfrom django.utils.safestring import mark_safe\\nimport markdown2\\n\")), mdx(\"p\", null, \"Next, add the following code to the end of the file:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"def getSearchResults(request):\\n    \\\"\\\"\\\"\\n    Search for a post by title or text\\n    \\\"\\\"\\\"\\n    # Get the query data\\n    query = request.GET.get('q', '')\\n    page = request.GET.get('page', 1)\\n\\n    # Query the database\\n    if query:\\n        results = Post.objects.filter(Q(text__icontains=query) | Q(title__icontains=query))\\n    else:\\n        results = None\\n\\n    # Add pagination\\n    pages = Paginator(results, 5)\\n\\n    # Get specified page\\n    try:\\n        returned_page = pages.page(page)\\n    except EmptyPage:\\n        returned_page = pages.page(pages.num_pages)\\n\\n    # Display the search results\\n    return render_to_response('blogengine/search_post_list.html',\\n                              {'page_obj': returned_page,\\n                               'object_list': returned_page.object_list,\\n                               'search': query})\\n\")), mdx(\"p\", null, \"As this is the first time we've written a view without using generic views, a little explanation is called for. First we get the values of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"q\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"page\"), \" parameters passed to the view. \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"q\"), \" contains the query text and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"page\"), \" contains the page number. Note also that our page defaults to 1 if not set.\"), mdx(\"p\", null, \"We then use the Q object to perform a query. The Django ORM will \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AND\"), \" together keyword argument queries, but that's not the behaviour we want here. Instead we want to be able to search for content in the title or text, so we need to use a query with an \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"OR\"), \" statement, which necessitates using the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.djangoproject.com/en/dev/topics/db/queries/#complex-lookups-with-q-objects\"\n  }, \"Q\"), \" object.\"), mdx(\"p\", null, \"Next, we use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Paginator\"), \" object to manually paginate the results, and if it raises an \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"EmptyPage\"), \" exception, to just show the last page instead. Finally we render the template \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"blogengine/search_post_list.html\"), \", and pass through the parameters \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"page_obj\"), \" for the returned page, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"object_list\"), \" for the objects, and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"search\"), \" for the query.\"), mdx(\"p\", null, \"We also need to add a route for our new view:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"\\n    # Search posts\\n    url(r'^search', 'blogengine.views.getSearchResults'),\\n\")), mdx(\"p\", null, \"Finally, let's create a new template to show our results:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-django\"\n  }, \"{% extends \\\"blogengine/includes/base.html\\\" %}\\n\\n    {% load custom_markdown %}\\n\\n    {% block content %}\\n        {% if object_list %}\\n            {% for post in object_list %}\\n            <div class=\\\"post col-md-12\\\">\\n            <h1><a href=\\\"{{ post.get_absolute_url }}\\\">{{ post.title }}</a></h1>\\n            <h3>{{ post.pub_date }}</h3>\\n            {{ post.text|custom_markdown }}\\n            </div>\\n            {% if post.category %}\\n            <div class=\\\"col-md-12\\\">\\n            <a href=\\\"{{ post.category.get_absolute_url }}\\\"><span class=\\\"label label-primary\\\">{{ post.category.name }}</span></a>\\n            </div>\\n            {% endif %}\\n            {% if post.tags %}\\n            <div class=\\\"col-md-12\\\">\\n            {% for tag in post.tags.all %}\\n            <a href=\\\"{{ tag.get_absolute_url }}\\\"><span class=\\\"label label-success\\\">{{ tag.name }}</span></a>\\n            {% endfor %}\\n            </div>\\n            {% endif %}\\n            {% endfor %}\\n        {% else %}\\n            <p>No posts found</p>\\n        {% endif %}\\n\\n        <ul class=\\\"pager\\\">\\n        {% if page_obj.has_previous %}\\n        <li class=\\\"previous\\\"><a href=\\\"/search?page={{ page_obj.previous_page_number }}&q={{ search }}\\\">Previous Page</a></li>\\n        {% endif %}\\n        {% if page_obj.has_next %}\\n        <li class=\\\"next\\\"><a href=\\\"/search?page={{ page_obj.next_page_number }}&q={{ search }}\\\">Next Page</a></li>\\n        {% endif %}\\n        </ul>\\n\\n    {% endblock %}\\n\")), mdx(\"p\", null, \"Let's run our tests:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ python manage.py test\\nCreating test database for alias 'default'...\\n...........................\\n----------------------------------------------------------------------\\nRan 27 tests in 6.421s\\n\\nOK\\nDestroying test database for alias 'default'...\\n\")), mdx(\"p\", null, \"Don't forget to do a quick sense check to make sure it's all working as expected. Then it's time to commit:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git add blogengine/\\n$ git commit -m 'Implemented search'\\n\")), mdx(\"p\", null, \"And push up your changes:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ git push origin master\\n$ git push heroku master\\n\")), mdx(\"p\", null, \"And that's the end of this instalment. Please note this particular search solution is quite basic, and if you want something more powerful, you may want to look at \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://haystacksearch.org/\"\n  }, \"Haystack\"), \".\"), mdx(\"p\", null, \"As usual, you can get this lesson with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"git checkout lesson-7\"), \" - if you have any problems, the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/matthewbdaly/django_tutorial_blog_ng\"\n  }, \"repository\"), \" should be the first place you look for answers as this is the working code base for the application, and with judicious use of a tool like \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"diff\"), \", it's generally pretty easy to track down most issues.\"), mdx(\"p\", null, \"In our next, and final instalment, we'll cover:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Tidying everything up\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Implementing an XML sitemap for search engines\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Optimising our site\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Using Fabric to make deployment easier\")), mdx(\"p\", null, \"Hope to see you then!\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Hello once again! In this instalment we'll cover: Caching your content with Memcached to improve your site's performance Refactoring and simplifying our tests Implementing","frontmatter":{"title":"Django Blog Tutorial - the Next Generation - Part 7","date":"25 August 2014","categories":["tdd","python","django","django-blog-tutorial"]},"fields":{"path":"/blog/2014/08/25/django-blog-tutorial-the-next-generation-part-7/"}}},"pageContext":{"previous":{"fields":{"path":"/blog/2014/05/25/django-blog-tutorial-the-next-generation-part-6/"},"frontmatter":{"title":"Django Blog Tutorial - the Next Generation - Part 6","date":"2014-05-25 17:23:28 +0100","layout":"post"}},"next":{"fields":{"path":"/blog/2014/08/31/django-blog-tutorial-the-next-generation-part-8/"},"frontmatter":{"title":"Django Blog Tutorial - the Next Generation - Part 8","date":"2014-08-31 22:00:00 +0100","layout":"post"}}}},"staticQueryHashes":["2909664151"]}