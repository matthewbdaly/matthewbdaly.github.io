{"componentChunkName":"component---src-templates-post-tsx","path":"/blog/2019/09/22/storing-wordpress-configuration-in-environment-variables/","result":{"data":{"site":{"siteMetadata":{"title":"Matthew Daly","siteUrl":"https://matthewdaly.co.uk"}},"mdx":{"id":"7d3969dc-bd0b-5ed4-a805-59141040c965","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Storing Wordpress configuration in environment variables\",\n  \"date\": \"2019-09-22 19:00:34 +0100\",\n  \"layout\": \"post\",\n  \"categories\": [\"php\", \"wordpress\"],\n  \"comments\": true\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Wordpress configuration can be a serious pain in the proverbial. Hard-coding configuration details in a PHP file is not a terribly safe way of storing the details for your database, as if the server is misconfigured they can be exposed. In addition, it can be a chore to copy and populate the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"wp-config.php\"), \" file to a new deploy.\"), mdx(\"p\", null, \"A fundamental principle of \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://12factor.net/\"\n  }, \"The Twelve-Factor App\"), \" is that config should be stored in the environment. While Wordpress does predate this, there's no reason why we can't abide by this. Storing Wordpress configuration in environment variables rather than the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"wp-config.php\"), \" file has the following advantages:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It's more secure since the config is not stored in a file in the web root, but in the web server config\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It makes managing the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"wp-config.php\"), \" file less of a chore - it can be safely committed to version control, and you won't need to change it to match your local configuration, running the risk of accidentally committing and pushing to production with broken config\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Deployment to new servers is simpler because there's no need to update the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"wp-config.php\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The risk of neglecting to change the database details and accidentally messing up the production database when working locally is virtually eliminated\")), mdx(\"p\", null, \"I've seen solutions for this that use DotEnv, but you don't actually need to install that to be able to use environment variables with Wordpress. In fact, in some way it's better if you don't as too many developers use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".env\"), \" files in production. PHP natively has the ability to get data from environment variables using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"getenv()\"), \" function, so it's easier to use that than to pull in a third-party library.\"), mdx(\"p\", null, \"Here's an abbreviated example of a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"wp-config.php\"), \" file that's been updated to pull the settings from environment variables:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-php\"\n  }, \"<?php\\n// ** MySQL settings - You can get this info from your web host ** //\\n/** The name of the database for WordPress */\\ndefine( 'DB_NAME', getenv('DB_NAME') );\\n\\n/** MySQL database username */\\ndefine( 'DB_USER', getenv('DB_USER') );\\n\\n/** MySQL database password */\\ndefine( 'DB_PASSWORD', getenv('DB_PASSWORD') );\\n\\n/** MySQL hostname */\\ndefine( 'DB_HOST', getenv('DB_HOST') );\\n\\n/** Database Charset to use in creating database tables. */\\ndefine( 'DB_CHARSET', 'utf8' );\\n\\n/** The Database Collate type. Don't change this if in doubt. */\\ndefine( 'DB_COLLATE', '' );\\n\\ndefine( 'AUTH_KEY',         getenv('AUTH_KEY') );\\ndefine( 'SECURE_AUTH_KEY',  getenv('SECURE_AUTH_KEY') );\\ndefine( 'LOGGED_IN_KEY',    getenv('LOGGED_IN_KEY') );\\ndefine( 'NONCE_KEY',        getenv('NONCE_KEY') );\\ndefine( 'AUTH_SALT',        getenv('AUTH_SALT') );\\ndefine( 'SECURE_AUTH_SALT', getenv('SECURE_AUTH_SALT') );\\ndefine( 'LOGGED_IN_SALT',   getenv('LOGGED_IN_SALT') );\\ndefine( 'NONCE_SALT',       getenv('NONCE_SALT') );\\n\\n$table_prefix = 'wp_';\\n\\ndefine( 'WP_DEBUG', getenv('WP_DEBUG') );\\n\\n/* That's all, stop editing! Happy publishing. */\\n\\n/** Absolute path to the WordPress directory. */\\nif ( ! defined( 'ABSPATH' ) ) {\\n    define( 'ABSPATH', dirname( __FILE__ ) . '/' );\\n}\\n\\n/** Sets up WordPress vars and included files. */\\nrequire_once( ABSPATH . 'wp-settings.php' );\\n\")), mdx(\"p\", null, \"If you're using Lando for local development, you will need to specify a file to include that contains the environment variables you wish to set, as in this example:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"name: wordpress\\nrecipe: wordpress\\nconfig:\\n  webroot: .\\nenv_file:\\n  - .env\\n\")), mdx(\"p\", null, \"This filename can be any arbitrarily chosen name. Then, you define the values for those variables in the same way you normally would in a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".env\"), \" file. Here's an abbreviated example that excludes the crypto settings (though those should be placed here too):\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-env\"\n  }, \"DB_NAME=wordpress\\nDB_USER=wordpress\\nDB_PASSWORD=wordpress\\nDB_HOST=database\\nWP_DEBUG=true\\n...\\n\")), mdx(\"p\", null, \"This will work fine during local development, but in production, or if you're using something like Vagrant for local development, you'll want to set the environment variables in the server configuration. For Apache, this is best set in the Virtualhost configuration, although you should be able to set it in an \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".htaccess\"), \" file if all else fails. You need to use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SetEnv\"), \" directive, as in this example:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-apache\"\n  }, \"SetEnv DB_NAME wordpress\\nSetEnv DB_USER wordpress\\nSetEnv DB_PASSWORD wordpress\\nSetEnv DB_HOST database\\nSetEnv WP_DEBUG true\\n\")), mdx(\"p\", null, \"For Nginx, assuming you're using FastCGI, you need to set it in the server configuration for that site using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"fastcgi_param\"), \" directive, as shown below:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-nginx\"\n  }, \"fastcgi_param DB_NAME wordpress;\\nfastcgi_param DB_USER wordpress;\\nfastcgi_param DB_PASSWORD wordpress;\\nfastcgi_param DB_HOST database;\\nfastcgi_param WP_DEBUG true;\\n\")), mdx(\"p\", null, \"Since Wordpress doesn't ship with any kind of command-line task runner, this should be sufficient for most installs. However, if you're using WP CLI, that will break it as it won't have access to environment variables set by Apache or Nginx, so you'll also need to set them for the user that runs WP CLI by adding them to their Bash config in the usual way.\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Wordpress configuration can be a serious pain in the proverbial. Hard-coding configuration details in a PHP file is not a terribly safe way of storing the details for your databaseâ€¦","frontmatter":{"title":"Storing Wordpress configuration in environment variables","date":"22nd September 2019 6:00 pm","isoDate":"2019-09-22T18:00:34+00:00","categories":["php","wordpress"]},"fields":{"path":"/blog/2019/09/22/storing-wordpress-configuration-in-environment-variables/"}}},"pageContext":{"previous":{"fields":{"path":"/blog/2019/09/21/using-mix-versioning-outside-laravel/"},"frontmatter":{"title":"Using Mix versioning outside Laravel","date":"2019-09-21 11:30:50 +0100","layout":"post"}},"next":{"fields":{"path":"/blog/2019/10/13/flexible-data-types-with-the-json-field/"},"frontmatter":{"title":"Flexible data types with the JSON field","date":"2019-10-13 23:10:43 +0100","layout":"post"}}}},"staticQueryHashes":["290055352","2909664151"]}