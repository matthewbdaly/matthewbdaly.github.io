<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta http-equiv="Content-Security-Policy" content="base-uri &#x27;self&#x27;; default-src &#x27;self&#x27; *.google-analytics.com disqus.com *.disqus.com *.disquscdn.com getform.io; script-src &#x27;self&#x27; localhost:* *.addthis.com *.google-analytics.com *.googletagmanager.com *.disquscdn.com *.disqus.com disqus.com *.addthisedge.com graph.facebook.com &#x27;unsafe-inline&#x27; &#x27;unsafe-eval&#x27;; style-src &#x27;self&#x27; fonts.googleapis.com *.addthis.com google-analytics.com *.disquscdn.com *.disqus.com &#x27;unsafe-inline&#x27;; object-src &#x27;none&#x27;; form-action &#x27;self&#x27; getform.io; font-src &#x27;self&#x27; data: fonts.google-apis.com fonts.gstatic.com; connect-src &#x27;self&#x27; ws://localhost:* *.google-analytics.com stats.g.doubleclick.net; img-src &#x27;self&#x27; *.google-analytics.com *.disquscdn.com *.disqus.com stats.g.doubleclick.net; child-src &#x27;self&#x27;; frame-src disqus.com *.addthis.com;"/><meta name="generator" content="Gatsby 4.25.9"/><meta data-react-helmet="true" name="description" content="As mentioned previously , when building any nontrivial Laravel application, it&#x27;s prudent to decouple our controllers from the Eloquent ORM (or any other ORM or data source we may…"/><meta data-react-helmet="true" property="og:title" content="Decorating Laravel repositories"/><meta data-react-helmet="true" property="og:description" content="As mentioned previously , when building any nontrivial Laravel application, it&#x27;s prudent to decouple our controllers from the Eloquent ORM (or any other ORM or data source we may…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta name="theme-color" content="#374151"/><style data-href="/styles.bbe6b9a56ec85678e6a0.css" data-identity="gatsby-global-css">/* ! tailwindcss v3.4.3 | MIT License | https://tailwindcss.com */*,:after,:before{border:0 solid #e5e7eb;box-sizing:border-box}:after,:before{--tw-content:""}:host,html{-webkit-text-size-adjust:100%;font-feature-settings:normal;-webkit-tap-highlight-color:transparent;font-family:ui-sans-serif,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-variation-settings:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{line-height:inherit;margin:0}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-feature-settings:normal;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em;font-variation-settings:normal}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{font-feature-settings:inherit;color:inherit;font-family:inherit;font-size:100%;font-variation-settings:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]{display:none}*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }.float-right{float:right}.float-left{float:left}.float-none{float:none}.clear-both{clear:both}.m-0{margin:0}.mx-0{margin-left:0;margin-right:0}.mx-auto{margin-left:auto;margin-right:auto}.my-2{margin-bottom:.5rem;margin-top:.5rem}.my-4{margin-bottom:1rem;margin-top:1rem}.-mb-4{margin-bottom:-1rem}.-mb-8{margin-bottom:-2rem}.mr-2{margin-right:.5rem}.mr-8{margin-right:2rem}.mt-16{margin-top:4rem}.mt-2{margin-top:.5rem}.box-border{box-sizing:border-box}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.hidden{display:none}.h-2{height:.5rem}.h-4{height:1rem}.min-h-screen{min-height:100vh}.w-1\/2{width:50%}.w-1\/3{width:33.333333%}.w-1\/4{width:25%}.w-3\/4{width:75%}.w-full{width:100%}.flex-grow{flex-grow:1}.list-disc{list-style-type:disc}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.justify-center{justify-content:center}.space-y-16>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(4rem*var(--tw-space-y-reverse));margin-top:calc(4rem*(1 - var(--tw-space-y-reverse)))}.space-y-32>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(8rem*var(--tw-space-y-reverse));margin-top:calc(8rem*(1 - var(--tw-space-y-reverse)))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(2rem*var(--tw-space-y-reverse));margin-top:calc(2rem*(1 - var(--tw-space-y-reverse)))}.divide-y>:not([hidden])~:not([hidden]){--tw-divide-y-reverse:0;border-bottom-width:calc(1px*var(--tw-divide-y-reverse));border-top-width:calc(1px*(1 - var(--tw-divide-y-reverse)))}.divide-gray-800>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgb(31 41 55/var(--tw-divide-opacity))}.overflow-x-auto{overflow-x:auto}.overflow-x-scroll{overflow-x:scroll}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-t-lg{border-top-left-radius:.5rem;border-top-right-radius:.5rem}.border-2{border-width:2px}.border-b-2{border-bottom-width:2px}.border-b-4{border-bottom-width:4px}.border-l-8{border-left-width:8px}.border-gray-100{--tw-border-opacity:1;border-color:rgb(243 244 246/var(--tw-border-opacity))}.border-gray-500{--tw-border-opacity:1;border-color:rgb(107 114 128/var(--tw-border-opacity))}.border-gray-800{--tw-border-opacity:1;border-color:rgb(31 41 55/var(--tw-border-opacity))}.border-green-400{--tw-border-opacity:1;border-color:rgb(74 222 128/var(--tw-border-opacity))}.border-transparent{border-color:transparent}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246/var(--tw-bg-opacity))}.bg-gray-300{--tw-bg-opacity:1;background-color:rgb(209 213 219/var(--tw-bg-opacity))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251/var(--tw-bg-opacity))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}.bg-purple-200{--tw-bg-opacity:1;background-color:rgb(233 213 255/var(--tw-bg-opacity))}.bg-red-200{--tw-bg-opacity:1;background-color:rgb(254 202 202/var(--tw-bg-opacity))}.bg-gradient-to-b{background-image:linear-gradient(to bottom,var(--tw-gradient-stops))}.bg-gradient-to-r{background-image:linear-gradient(to right,var(--tw-gradient-stops))}.from-gray-200{--tw-gradient-from:#e5e7eb var(--tw-gradient-from-position);--tw-gradient-to:rgba(229,231,235,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-green-400{--tw-gradient-from:#4ade80 var(--tw-gradient-from-position);--tw-gradient-to:rgba(74,222,128,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.via-blue-500{--tw-gradient-to:rgba(59,130,246,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),#3b82f6 var(--tw-gradient-via-position),var(--tw-gradient-to)}.to-gray-300{--tw-gradient-to:#d1d5db var(--tw-gradient-to-position)}.to-purple-500{--tw-gradient-to:#a855f7 var(--tw-gradient-to-position)}.p-2{padding:.5rem}.p-4{padding:1rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-4{padding-left:1rem;padding-right:1rem}.px-8{padding-left:2rem;padding-right:2rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.py-4{padding-bottom:1rem;padding-top:1rem}.pb-16{padding-bottom:4rem}.pl-4{padding-left:1rem}.pl-6{padding-left:1.5rem}.pt-4{padding-top:1rem}.text-center{text-align:center}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.font-sans{font-family:ui-sans-serif,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}.text-2xl{font-size:1.5rem;line-height:2rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.font-semibold{font-weight:600}.lowercase{text-transform:lowercase}.italic{font-style:italic}.leading-6{line-height:1.5rem}.text-gray-100{--tw-text-opacity:1;color:rgb(243 244 246/var(--tw-text-opacity))}.text-gray-200{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55/var(--tw-text-opacity))}.text-gray-900{--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity))}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.shadow-lg,.shadow-sm{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgba(0,0,0,.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition{transition-duration:.15s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-colors{transition-duration:.15s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-300{transition-duration:.3s}.duration-500{transition-duration:.5s}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}code[class*=language-],pre[class*=language-]{display:block}.hover\:border-green-400:hover{--tw-border-opacity:1;border-color:rgb(74 222 128/var(--tw-border-opacity))}.hover\:bg-gray-200:hover{--tw-bg-opacity:1;background-color:rgb(229 231 235/var(--tw-bg-opacity))}.hover\:bg-purple-800:hover{--tw-bg-opacity:1;background-color:rgb(107 33 168/var(--tw-bg-opacity))}.hover\:text-gray-200:hover{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.focus\:border-blue-300:focus{--tw-border-opacity:1;border-color:rgb(147 197 253/var(--tw-border-opacity))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(3px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}@media (min-width:768px){.md\:float-none{float:none}.md\:block{display:block}.md\:w-1\/6{width:16.666667%}.md\:w-2\/3{width:66.666667%}}@media (min-width:1024px){.lg\:float-right{float:right}.lg\:float-left{float:left}.lg\:mt-4{margin-top:1rem}.lg\:text-left{text-align:left}}@media (prefers-color-scheme:dark){.dark\:divide-gray-200>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgb(229 231 235/var(--tw-divide-opacity))}.dark\:bg-gray-700{--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity))}.dark\:bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}.dark\:bg-gray-900{--tw-bg-opacity:1;background-color:rgb(17 24 39/var(--tw-bg-opacity))}.dark\:text-gray-100{--tw-text-opacity:1;color:rgb(243 244 246/var(--tw-text-opacity))}.dark\:text-gray-200{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.dark\:text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219/var(--tw-text-opacity))}.dark\:text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55/var(--tw-text-opacity))}.dark\:hover\:bg-gray-800:hover{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}}.prism-code{-webkit-overflow-scrolling:touch;background-color:transparent;border-radius:.2em;float:left;font-size:1rem;margin-bottom:1rem;margin-top:1rem;overflow:initial;padding-bottom:1rem;padding-top:1rem;position:relative}.prism-code.title{border-radius:0 0 .2em .2em}pre.prism-code{float:left;min-width:100%;overflow:initial;padding:20px}.token{display:inline-block}li>code,p>code{word-wrap:break-word;color:#ab79d6;white-space:pre-wrap}.gatsby-highlight{-webkit-overflow-scrolling:touch;font-size:1rem;overflow:auto;position:relative}.gatsby-highlight::-webkit-scrollbar{display:none}.gatsby-highlight>code[class*=language-],.gatsby>pre[class*=language-]{-webkit-hyphens:none;hyphens:none;line-height:1.5;overflow-wrap:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-break:normal;word-spacing:normal}.gatsby-highlight .token-line{border-left:4px solid transparent;margin-left:-20px;margin-right:-20px}.line-number-style{display:inline-block;opacity:.3;padding-left:1em;padding-right:2em;position:relative;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:1.2em}.gatsby-highlight .token-line.highlight-line{background-color:#023751;border-left:4px solid #029bce}.gatsby-highlight .token-line.highlight-line .line-number-style{left:0;opacity:.5;width:calc(1.2em - 4px)}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="search" type="application/opensearchdescription+xml" title="Matthew Daly" href="/opensearch.xml"/><script data-gatsby="web-vitals-polyfill">
              !function(){var e,t,n,i,r={passive:!0,capture:!0},a=new Date,o=function(){i=[],t=-1,e=null,f(addEventListener)},c=function(i,r){e||(e=r,t=i,n=new Date,f(removeEventListener),u())},u=function(){if(t>=0&&t<n-a){var r={entryType:"first-input",name:e.type,target:e.target,cancelable:e.cancelable,startTime:e.timeStamp,processingStart:e.timeStamp+t};i.forEach((function(e){e(r)})),i=[]}},s=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var n=function(){c(e,t),a()},i=function(){a()},a=function(){removeEventListener("pointerup",n,r),removeEventListener("pointercancel",i,r)};addEventListener("pointerup",n,r),addEventListener("pointercancel",i,r)}(t,e):c(t,e)}},f=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,s,r)}))},p="hidden"===document.visibilityState?0:1/0;addEventListener("visibilitychange",(function e(t){"hidden"===document.visibilityState&&(p=t.timeStamp,removeEventListener("visibilitychange",e,!0))}),!0);o(),self.webVitals={firstInputPolyfill:function(e){i.push(e),u()},resetFirstInputPolyfill:o,get firstHiddenTime(){return p}}}();
            </script><script>window.dataLayer = window.dataLayer || [];window.dataLayer.push({"platform":"gatsby"}); (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl+'';f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer', 'G-68VZX216JS');</script><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><title data-react-helmet="true">Decorating Laravel repositories | Matthew Daly</title><link data-react-helmet="true" href="https://matthewdaly.co.uk/blog/2017/03/01/decorating-laravel-repositories/" rel="canonical"/><link data-react-helmet="true" href="https://github.com/matthewbdaly" rel="me"/><link data-react-helmet="true" href="https://mstdn.social/@matthewbdaly" rel="me"/><link data-react-helmet="true" href="mailto:matthew@matthewdaly.co.uk" rel="me"/><link data-react-helmet="true" href="/key.pub" rel="pgpkey"/><link data-react-helmet="true" href="https://webmention.io/matthewdaly.co.uk/xmlrpc" rel="pingback"/><link data-react-helmet="true" href="https://webmention.io/matthewdaly.co.uk/webmention" rel="webmention"/><link data-react-helmet="true" rel="authorization_endpoint" href="https://indieauth.com/auth"/><link data-react-helmet="true" rel="token_endpoint" href="https://tokens.indieauth.com/token"/><link data-react-helmet="true" rel="openid.delegate" href="https://matthewdaly.co.uk"/><link data-react-helmet="true" rel="openid.server" href="https://openid.indieauth.com/openid"/><link data-react-helmet="true" rel="alternate" type="application/rss+xml" title="Matthew Daly - feed" href="/rss.xml"/><link data-react-helmet="true" rel="alternate" type="application/atom+xml" title="Matthew Daly - feed" href="/atom.xml"/><link data-react-helmet="true" rel="alternate" type="application/feed+json" title="Matthew Daly - feed" href="/feed.json"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link rel="icon" href="/favicon-32x32.png?v=53aa06cf17e4239d0dba6ffd09854e02" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=53aa06cf17e4239d0dba6ffd09854e02"/></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=G-68VZX216JS" height="0" width="0" style="display: none; visibility: hidden" aria-hidden="true"></iframe></noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="flex flex-col min-h-screen pb-16 font-sans text-lg antialiased text-gray-800 bg-gray-50 dark:text-gray-100 dark:bg-gray-700 leading-6"><div class="w-full h-2 bg-gradient-to-r from-green-400 via-blue-500 to-purple-500"></div><nav class="w-full p-4 mx-auto lowercase md:w-2/3"><h1 class="block float-none py-4 text-4xl text-center lg:float-left lg:text-left"><a href="/">Matthew Daly</a></h1><ul class="py-2 text-center lg:float-right md:block lg:text-left"><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/blog/archives">Archives</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/about">About</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/uses">Uses</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/posts/1">Blog</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/blog/categories">Categories</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/search">Search</a></li></ul></nav><div class="w-full h-4 clear"></div><main class="flex-grow w-full p-4 mx-auto md:w-2/3"><article class="h-entry"><header><h2 class="py-4 text-2xl font-bold e-content p-name"><a class="u-url" href="https://matthewdaly.co.uk/blog/2017/03/01/decorating-laravel-repositories/">Decorating Laravel repositories</a></h2><p class="my-4 text-lg font-semibold">Published by <a href="/" rel="author">Matthew Daly</a> at <!-- -->1st March 2017 11:16 pm</p><time class="hidden dt-published">2017-03-01T23:16:57+00:00</time></header><section><p class="py-2"><a href="/blog/2016/11/13/building-a-phonegap-app-with-laravel-and-angular-part-4/" class="border-b-2 border-green-400">As mentioned previously</a>, when building any nontrivial Laravel application, it&#x27;s prudent to decouple our controllers from the Eloquent ORM (or any other ORM or data source we may be using) by creating an interface, and then writing a repository that implements that interface. We can then resolve the interface to our repository, and use the repository to interact with our data source. Should we need to switch to a different implementation, we then need only create the new repository and amend how Laravel resolves that interface.</p><p class="py-2">The same principle applies when it comes to caching. Database queries are typically a major bottleneck in a web application, and so it&#x27;s prudent to implement some form of caching for your queries. However, it&#x27;s a bad idea to do so in your controllers, because just as with Eloquent models, you&#x27;re tying yourself to one particular implementation and won&#x27;t be able to switch without rewriting a good chunk of your controllers, as well as possibly having to maintain large amounts of duplicate code for when a query is made in several places.</p><p class="py-2">Alternatively, you could implement caching within the methods of your repository, which might make sense for smaller projects. However, it means that your repository is now dependent on both the ORM and cache you chose. If you decide you want to change your ORM but retain the same caching system, or vice versa, you&#x27;re stuck with writing a new repository to handle both, duplicating work you&#x27;ve already done.</p><p class="py-2">Fortunately, there&#x27;s a more elegant solution. Using the <a href="http://designpatternsphp.readthedocs.io/en/latest/Structural/Decorator/README.html" class="border-b-2 border-green-400">decorator pattern</a>, we can create a second repository that implements the same interface and &quot;wraps&quot; the original repository. Each of its methods will call its counterpart in the original, and if appropriate cache the response. That way, our caching is implemented separately from our database interactions, and we can easily create a repository for a new data source without affecting the caching in the slightest.</p><p class="py-2">Say we have the following interface for our <code>User</code> model:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">namespace</span><span class="token php language-php"> </span><span class="token php language-php package">App</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Repositories</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Interfaces</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">interface</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name" style="color:#FAC863">UserRepositoryInterface</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">all</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">findOrFail</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$id</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">create</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$input</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">And the following repository implements that interface:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">namespace</span><span class="token php language-php"> </span><span class="token php language-php package">App</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Repositories</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php"> </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">App</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">User</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">App</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Repositories</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Interfaces</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">UserRepositoryInterface</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Hash</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php"> </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name" style="color:#FAC863">EloquentUserRepository</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">implements</span><span class="token php language-php"> </span><span class="token php language-php class-name" style="color:#FAC863">UserRepositoryInterface</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php"> </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">private</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$model</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">__construct</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php class-name type-declaration" style="color:#FAC863">User</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$model</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">model</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$model</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">all</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:#c5a5c5">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">model</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">all</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token php language-php"> </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">findOrFail</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$id</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:#c5a5c5">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">model</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">findOrFail</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$id</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token php language-php"> </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">create</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$input</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$user</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">new</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">model</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$user</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">email</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$input</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$user</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">name</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$input</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$user</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">password</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context" style="color:#FAC863">Hash</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">make</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$input</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;password&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$user</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">save</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:#c5a5c5">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$user</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">We might implement the following repository class to handle caching:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">namespace</span><span class="token php language-php"> </span><span class="token php language-php package">App</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Repositories</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Decorators</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php"> </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">App</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Repositories</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Interfaces</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">UserRepositoryInterface</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Illuminate</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Contracts</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Cache</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Repository</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">as</span><span class="token php language-php"> Cache</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php"> </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name" style="color:#FAC863">CachingUserRepository</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">implements</span><span class="token php language-php"> </span><span class="token php language-php class-name" style="color:#FAC863">UserRepositoryInterface</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php"> </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">protected</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$repository</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">protected</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">__construct</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php class-name type-declaration" style="color:#FAC863">UserRepositoryInterface</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$repository</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php class-name type-declaration" style="color:#FAC863">Cache</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">repository</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$repository</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">cache</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">all</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:#c5a5c5">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">cache</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">tags</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;users&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">remember</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;all&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php number" style="color:#5a9bcf">60</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:#c5a5c5">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">repository</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">all</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token php language-php"> </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">findOrFail</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$id</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:#c5a5c5">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">cache</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">tags</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;users&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">remember</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$id</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php number" style="color:#5a9bcf">60</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$id</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:#c5a5c5">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">repository</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">findOrFail</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$id</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token php language-php"> </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">create</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$input</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">cache</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">tags</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;users&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">flush</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:#c5a5c5">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">repository</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">create</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$input</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">Note how each method doesn&#x27;t actually do any querying. Instead, the constructor accepts an implementation of the same interface and the cache, and we defer all interactions with the database to that implementation. Each call that queries the database is wrapped in a callback so that it&#x27;s stored in Laravel&#x27;s cache when it&#x27;s returned, without touching the original implementation. When a user is created, the users tag is flushed from the cache so that stale results don&#x27;t get served.</p><p class="py-2">To actually use this implementation, we need to update our service provider so that it resolves the interface to an implementation of our decorator:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">namespace</span><span class="token php language-php"> </span><span class="token php language-php package">App</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Providers</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Illuminate</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Support</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">ServiceProvider</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name" style="color:#FAC863">AppServiceProvider</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">extends</span><span class="token php language-php"> </span><span class="token php language-php class-name" style="color:#FAC863">ServiceProvider</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php comment" style="color:#999999">     * Bootstrap any application services.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token php language-php comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">boot</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">//</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token php language-php comment" style="color:#999999">     * Register any application services.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token php language-php comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">register</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">app</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">singleton</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;App\Repositories\Interfaces\UserRepositoryInterface&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token php language-php">            </span><span class="token php language-php variable" style="color:#d7deea">$baseRepo</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">new</span><span class="token php language-php"> </span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified" style="color:#FAC863">App</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified" style="color:#FAC863">Repositories</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified" style="color:#FAC863">EloquentUserRepository</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php keyword" style="color:#c5a5c5">new</span><span class="token php language-php"> </span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified" style="color:#FAC863">App</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified" style="color:#FAC863">User</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token php language-php">            </span><span class="token php language-php variable" style="color:#d7deea">$cachingRepo</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">new</span><span class="token php language-php"> </span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified" style="color:#FAC863">App</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified" style="color:#FAC863">Repositories</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified" style="color:#FAC863">Decorators</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified" style="color:#FAC863">CachingUserRepository</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$baseRepo</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">app</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;cache.store&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:#c5a5c5">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$cachingRepo</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">We instantiate the base repository, passing it the appropriate model. Then we instantiate the decorator, passing it the base repository and the cache, and return it. Now our controllers will start using the new decorator.</p><h2 class="py-4 text-2xl font-bold">Testing the decorator</h2><p class="py-2">Now that we have a working decorator, how do we test it? Just as with the decorator itself, we want our tests to be completely decoupled from any particular implementation of the dependencies. If in future we&#x27;re asked to migrate the database to MongoDB, say, we&#x27;ll have plenty of work writing our new database repositories, so we don&#x27;t want to have to rewrite the tests for our decorator as well. Fortunately, using Mockery we can just mock the interface for the repository, and pass that mock into the constructor of the decorator in our test. That way we can have the mock return a known response and not involve either the database repository or the underlying models in any way.</p><p class="py-2">We will also want to mock the cache itself, as this is a unit test and so as far as possible it should not be testing anything outside of the repository class. Here&#x27;s an example of how we might test the above decorator.</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">namespace</span><span class="token php language-php"> </span><span class="token php language-php package">Tests</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Repositories</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Decorators</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Tests</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">TestCase</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">App</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Repositories</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Decorators</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">CachingUserRepository</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Mockery</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">as</span><span class="token php language-php"> m</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name" style="color:#FAC863">UserTest</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">extends</span><span class="token php language-php"> </span><span class="token php language-php class-name" style="color:#FAC863">TestCase</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token php language-php comment" style="color:#999999">     * Test fetching all items</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token php language-php comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">testFetchingAll</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Create mock of decorated repository</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$repo</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context" style="color:#FAC863">m</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">mock</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;App\Repositories\Interfaces\UserRepositoryInterface&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$repo</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">shouldReceive</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;all&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">andReturn</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Create mock of cache</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context" style="color:#FAC863">m</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">mock</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Illuminate\Contracts\Cache\Repository&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">shouldReceive</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;tags&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">with</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;users&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">andReturn</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">shouldReceive</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;remember&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">andReturn</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token php language-php">            </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Instantiate the repository</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$repository</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">new</span><span class="token php language-php"> </span><span class="token php language-php class-name" style="color:#FAC863">CachingUserRepository</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$repo</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Get all</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$items</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$repository</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">all</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">assertCount</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php number" style="color:#5a9bcf">0</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$items</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token php language-php comment" style="color:#999999">     * Test fetching a single item</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token php language-php comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">testFindOrFail</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Create mock of decorated repository</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$repo</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context" style="color:#FAC863">m</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">mock</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;App\Repositories\Interfaces\UserRepositoryInterface&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$repo</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">shouldReceive</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;findOrFail&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">with</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php number" style="color:#5a9bcf">1</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">andReturn</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php constant" style="color:#5a9bcf">null</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Create mock of cache</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">47</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context" style="color:#FAC863">m</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">mock</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Illuminate\Contracts\Cache\Repository&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">48</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">shouldReceive</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;tags&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">with</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;users&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">andReturn</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">49</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">shouldReceive</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;remember&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">andReturn</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php constant" style="color:#5a9bcf">null</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">50</span><span class="token php language-php">        </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">51</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Instantiate the repository</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">52</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$repository</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">new</span><span class="token php language-php"> </span><span class="token php language-php class-name" style="color:#FAC863">CachingUserRepository</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$repo</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">53</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">54</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Get all</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">55</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$item</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$repository</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">findOrFail</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php number" style="color:#5a9bcf">1</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">56</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">assertNull</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$item</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">57</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">58</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">59</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">60</span><span class="token php language-php comment" style="color:#999999">     * Test creating a single item</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">61</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">62</span><span class="token php language-php comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">63</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">64</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">testCreate</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">65</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">66</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Create mock of decorated repository</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">67</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$repo</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context" style="color:#FAC863">m</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">mock</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;App\Repositories\Interfaces\UserRepositoryInterface&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">68</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$repo</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">shouldReceive</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;create&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">with</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;bob@example.com&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">andReturn</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php constant boolean" style="color:#ff8b50">true</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">69</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">70</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Create mock of cache</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">71</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context" style="color:#FAC863">m</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">mock</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Illuminate\Contracts\Cache\Repository&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">72</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">shouldReceive</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;tags&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">with</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;usersUser&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">andReturn</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">73</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">shouldReceive</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;flush&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">andReturn</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php constant boolean" style="color:#ff8b50">true</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">74</span><span class="token php language-php">        </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">75</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Instantiate the repository</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">76</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$repository</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">new</span><span class="token php language-php"> </span><span class="token php language-php class-name" style="color:#FAC863">CachingUserRepository</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$repo</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$cache</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">77</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">78</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Get all</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">79</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$item</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$repository</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">create</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;bob@example.com&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">80</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">assertTrue</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$item</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">81</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">82</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">83</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">tearDown</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">84</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">85</span><span class="token php language-php">        </span><span class="token php language-php class-name static-context" style="color:#FAC863">m</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">close</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">86</span><span class="token php language-php">        </span><span class="token php language-php keyword static-context" style="color:#c5a5c5">parent</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">tearDown</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">87</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">88</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">As you can see, all we care about is that the underlying repository interface receives the correct method calls and arguments, nothing more. That way our test is fast and repository-agnostic.</p><h2 class="py-4 text-2xl font-bold">Other applications</h2><p class="py-2">Here I&#x27;ve used this technique to cache the queries, but that&#x27;s not the only use case for decorating a repository. For instance, you could decorate a repository to fire events when certain methods are called, and write different decorators when reusing these repositories for different applications. You could create one to log interactions with the repository, or you could use an external library to cache your queries, all without touching your existing repository. Should we need to switch back to our base repository, it&#x27;s just a matter of amending the service provider accordingly as both the decorator and the repository implement the same interface.</p><p class="py-2">Creating decorators does mean you have to implement all of the interface&#x27;s methods again, but if you have a base repository that your other ones inherit from, you can easily create a base decorator in a similar fashion that wraps methods common to all the repositories, and then just implement the additional methods for each decorator as required. Also, each method is likely to be fairly limited in scope so it&#x27;s not generally too onerous.</p></section><hr/><div class="py-4"><a class="p-category" href="/blog/categories/php/"><span class="inline-block px-4 py-2 my-2 mr-2 text-sm font-bold text-gray-900 bg-purple-200 rounded-full hover:bg-purple-800 hover:text-gray-200 transition-colors duration-500">php</span></a><a class="p-category" href="/blog/categories/laravel/"><span class="inline-block px-4 py-2 my-2 mr-2 text-sm font-bold text-gray-900 bg-purple-200 rounded-full hover:bg-purple-800 hover:text-gray-200 transition-colors duration-500">laravel</span></a></div><nav class="pt-4 clear-both box-border"><a rel="prev" class="float-left w-1/2 p-2 shadow-sm hover:bg-gray-200 dark:hover:bg-gray-800 transition duration-300 ease-in-out" href="/blog/2017/02/19/my-first-laravel-package/"><p><strong class="font-bold clear-both">← Previous page</strong></p><p class="pl-6">My first Laravel package</p></a><a rel="next" class="float-right w-1/2 p-2 shadow-sm hover:bg-gray-200 dark:hover:bg-gray-800 transition duration-300 ease-in-out" href="/blog/2017/03/15/enforcing-a-coding-standard-with-php-codesniffer/"><p><strong>→ Next page</strong></p><p class="pl-6">Enforcing a coding standard with PHP CodeSniffer</p></a></nav><div id="disqus_thread"></div></article></main></div><footer class="w-full p-4 text-gray-100 bg-gray-800"><ul class="flex flex-row flex-wrap justify-center w-full p-2 mx-auto text-center md:w-2/3 box-border"><li class="w-1/3 my-2 md:w-1/6"><a href="/posts/1">Blog</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="/about">About</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="/contact">Contact</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="https://github.com/matthewbdaly">Github</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="/rss.xml">Feed</a></li></ul><div class="w-full p-4 mx-auto text-center md:w-2/3"><p>© Matthew Daly <!-- -->2025</p></div></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-17043630-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2017/03/01/decorating-laravel-repositories/";window.___webpackCompilationHash="88765966d316b9b709a4";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-e73936eead92de554461.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-f9985f07495542a76eff.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-4979e174e2fb0f2974e6.js"],"component---src-pages-search-tsx":["/component---src-pages-search-tsx-b99acf90d4edb32782cc.js"],"component---src-templates-404-tsx":["/component---src-templates-404-tsx-58cee2c5cafcdef4f352.js"],"component---src-templates-archives-tsx":["/component---src-templates-archives-tsx-eb683d429b41ff760650.js"],"component---src-templates-categories-tsx":["/component---src-templates-categories-tsx-0ebf077cdddbd027dee1.js"],"component---src-templates-category-tsx":["/component---src-templates-category-tsx-85c7819e0a67df13f83c.js"],"component---src-templates-chunk-tsx":["/component---src-templates-chunk-tsx-cb62dcaac71b0fa8e5fc.js"],"component---src-templates-page-tsx":["/component---src-templates-page-tsx-c6d2695b7ceb05c9b33e.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-7224755a5f178c503b89.js"]};/*]]>*/</script><script src="/app-e73936eead92de554461.js" async=""></script><script src="/framework-1ac0b2f1f7100fab8832.js" async=""></script><script src="/webpack-runtime-4c2c7c28de054671fb6f.js" async=""></script></body></html>