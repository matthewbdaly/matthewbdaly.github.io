<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta http-equiv="Content-Security-Policy" content="base-uri &#x27;self&#x27;; default-src &#x27;self&#x27; *.google-analytics.com disqus.com *.disqus.com *.disquscdn.com getform.io; script-src &#x27;self&#x27; localhost:* *.addthis.com *.google-analytics.com *.disquscdn.com *.disqus.com disqus.com *.addthisedge.com graph.facebook.com &#x27;unsafe-inline&#x27; &#x27;unsafe-eval&#x27;; style-src &#x27;self&#x27; fonts.googleapis.com *.addthis.com google-analytics.com *.disquscdn.com *.disqus.com &#x27;unsafe-inline&#x27;; object-src &#x27;none&#x27;; form-action &#x27;self&#x27; getform.io; font-src &#x27;self&#x27; data: fonts.google-apis.com fonts.gstatic.com; connect-src &#x27;self&#x27; ws://localhost:* *.google-analytics.com stats.g.doubleclick.net; img-src &#x27;self&#x27; *.google-analytics.com *.disquscdn.com *.disqus.com stats.g.doubleclick.net; child-src &#x27;self&#x27;; frame-src disqus.com *.addthis.com;"/><meta name="theme-color" content="#3b82f6"/><meta data-react-helmet="true" name="twitter:description" content="A lot of my work over the last few years has been on Phonegap apps. Phonegap isn&#x27;t terribly hard to use, but the difference in context between that and a more conventional web app…"/><meta data-react-helmet="true" name="twitter:title" content="Building a Phonegap app with Laravel and Angular - Part 1"/><meta data-react-helmet="true" name="twitter:creator" content="mattbd"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:description" content="A lot of my work over the last few years has been on Phonegap apps. Phonegap isn&#x27;t terribly hard to use, but the difference in context between that and a more conventional web app…"/><meta data-react-helmet="true" property="og:title" content="Building a Phonegap app with Laravel and Angular - Part 1"/><meta data-react-helmet="true" name="description" content="A lot of my work over the last few years has been on Phonegap apps. Phonegap isn&#x27;t terribly hard to use, but the difference in context between that and a more conventional web app…"/><meta name="generator" content="Gatsby 4.15.2"/><style data-href="/styles.2c84e2444e0a46017e4b.css" data-identity="gatsby-global-css">/* ! tailwindcss v3.0.24 | MIT License | https://tailwindcss.com */*,:after,:before{border:0 solid #e5e7eb;box-sizing:border-box}:after,:before{--tw-content:""}html{-webkit-text-size-adjust:100%;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{line-height:inherit;margin:0}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{color:inherit;font-family:inherit;font-size:100%;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]{display:none}*,:after,:before{--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }.float-right{float:right}.float-left{float:left}.float-none{float:none}.clear-both{clear:both}.m-0{margin:0}.mx-auto{margin-left:auto;margin-right:auto}.my-8{margin-bottom:2rem;margin-top:2rem}.my-4{margin-bottom:1rem;margin-top:1rem}.my-2{margin-bottom:.5rem;margin-top:.5rem}.mx-0{margin-left:0;margin-right:0}.mt-2{margin-top:.5rem}.-mb-8{margin-bottom:-2rem}.-mb-4{margin-bottom:-1rem}.mt-8{margin-top:2rem}.mr-8{margin-right:2rem}.mt-16{margin-top:4rem}.mr-2{margin-right:.5rem}.box-border{box-sizing:border-box}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.hidden{display:none}.h-2{height:.5rem}.h-4{height:1rem}.min-h-screen{min-height:100vh}.w-full{width:100%}.w-1\/3{width:33.333333%}.w-2\/3{width:66.666667%}.w-1\/2{width:50%}.w-3\/4{width:75%}.w-1\/4{width:25%}.flex-grow{flex-grow:1}.resize-none{resize:none}.list-disc{list-style-type:disc}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.justify-center{justify-content:center}.space-y-32>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(8rem*var(--tw-space-y-reverse));margin-top:calc(8rem*(1 - var(--tw-space-y-reverse)))}.space-y-16>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(4rem*var(--tw-space-y-reverse));margin-top:calc(4rem*(1 - var(--tw-space-y-reverse)))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(2rem*var(--tw-space-y-reverse));margin-top:calc(2rem*(1 - var(--tw-space-y-reverse)))}.divide-y>:not([hidden])~:not([hidden]){--tw-divide-y-reverse:0;border-bottom-width:calc(1px*var(--tw-divide-y-reverse));border-top-width:calc(1px*(1 - var(--tw-divide-y-reverse)))}.divide-gray-800>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgb(31 41 55/var(--tw-divide-opacity))}.overflow-x-auto{overflow-x:auto}.overflow-x-scroll{overflow-x:scroll}.rounded-lg{border-radius:.5rem}.rounded-full{border-radius:9999px}.rounded-t-lg{border-top-left-radius:.5rem;border-top-right-radius:.5rem}.border-2{border-width:2px}.border-b-2{border-bottom-width:2px}.border-l-8{border-left-width:8px}.border-b-4{border-bottom-width:4px}.border-green-400{--tw-border-opacity:1;border-color:rgb(74 222 128/var(--tw-border-opacity))}.border-gray-500{--tw-border-opacity:1;border-color:rgb(107 114 128/var(--tw-border-opacity))}.border-gray-800{--tw-border-opacity:1;border-color:rgb(31 41 55/var(--tw-border-opacity))}.border-white{--tw-border-opacity:1;border-color:rgb(255 255 255/var(--tw-border-opacity))}.border-transparent{border-color:transparent}.border-gray-100{--tw-border-opacity:1;border-color:rgb(243 244 246/var(--tw-border-opacity))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246/var(--tw-bg-opacity))}.bg-gray-300{--tw-bg-opacity:1;background-color:rgb(209 213 219/var(--tw-bg-opacity))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235/var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251/var(--tw-bg-opacity))}.bg-red-200{--tw-bg-opacity:1;background-color:rgb(254 202 202/var(--tw-bg-opacity))}.bg-purple-200{--tw-bg-opacity:1;background-color:rgb(233 213 255/var(--tw-bg-opacity))}.bg-gradient-to-b{background-image:linear-gradient(to bottom,var(--tw-gradient-stops))}.bg-gradient-to-r{background-image:linear-gradient(to right,var(--tw-gradient-stops))}.from-gray-200{--tw-gradient-from:#e5e7eb;--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to,rgba(229,231,235,0))}.from-green-400{--tw-gradient-from:#4ade80;--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to,rgba(74,222,128,0))}.via-blue-500{--tw-gradient-stops:var(--tw-gradient-from),#3b82f6,var(--tw-gradient-to,rgba(59,130,246,0))}.to-gray-300{--tw-gradient-to:#d1d5db}.to-purple-500{--tw-gradient-to:#a855f7}.p-4{padding:1rem}.p-2{padding:.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-4{padding-bottom:1rem;padding-top:1rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-4{padding-right:1rem}.pl-4,.px-4{padding-left:1rem}.pb-16{padding-bottom:4rem}.pt-4{padding-top:1rem}.pl-6{padding-left:1.5rem}.text-center{text-align:center}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.font-sans{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}.text-sm{font-size:.875rem;line-height:1.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-xl{font-size:1.25rem}.text-lg,.text-xl{line-height:1.75rem}.text-lg{font-size:1.125rem}.font-bold{font-weight:700}.font-semibold{font-weight:600}.lowercase{text-transform:lowercase}.italic{font-style:italic}.leading-6{line-height:1.5rem}.text-gray-200{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.text-gray-900{--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55/var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.text-black{--tw-text-opacity:1;color:rgb(0 0 0/var(--tw-text-opacity))}.text-gray-100{--tw-text-opacity:1;color:rgb(243 244 246/var(--tw-text-opacity))}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.shadow-lg,.shadow-sm{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgba(0,0,0,.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition-colors{transition-duration:.15s;transition-property:color,background-color,border-color,fill,stroke,-webkit-text-decoration-color;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,-webkit-text-decoration-color;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition{transition-duration:.15s;transition-property:color,background-color,border-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-text-decoration-color,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-text-decoration-color,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-500{transition-duration:.5s}.duration-300{transition-duration:.3s}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}code[class*=language-],pre[class*=language-]{display:block}.hover\:border-green-400:hover{--tw-border-opacity:1;border-color:rgb(74 222 128/var(--tw-border-opacity))}.hover\:bg-gray-200:hover{--tw-bg-opacity:1;background-color:rgb(229 231 235/var(--tw-bg-opacity))}.hover\:bg-purple-800:hover{--tw-bg-opacity:1;background-color:rgb(107 33 168/var(--tw-bg-opacity))}.hover\:text-gray-200:hover{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.focus\:border-blue-300:focus{--tw-border-opacity:1;border-color:rgb(147 197 253/var(--tw-border-opacity))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(3px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}@media (prefers-color-scheme:dark){.dark\:divide-gray-200>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgb(229 231 235/var(--tw-divide-opacity))}.dark\:border-black{--tw-border-opacity:1;border-color:rgb(0 0 0/var(--tw-border-opacity))}.dark\:bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}.dark\:bg-gray-900{--tw-bg-opacity:1;background-color:rgb(17 24 39/var(--tw-bg-opacity))}.dark\:bg-gray-700{--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity))}.dark\:text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219/var(--tw-text-opacity))}.dark\:text-gray-100{--tw-text-opacity:1;color:rgb(243 244 246/var(--tw-text-opacity))}.dark\:text-gray-200{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.dark\:hover\:bg-gray-800:hover{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}}@media (min-width:768px){.md\:float-none{float:none}.md\:block{display:block}.md\:w-40{width:10rem}.md\:w-2\/3{width:66.666667%}.md\:w-1\/6{width:16.666667%}}@media (min-width:1024px){.lg\:float-right{float:right}.lg\:float-left{float:left}.lg\:mt-4{margin-top:1rem}.lg\:text-left{text-align:left}}.prism-code{-webkit-overflow-scrolling:touch;background-color:transparent;border-radius:.2em;float:left;font-size:1rem;margin-bottom:1rem;margin-top:1rem;overflow:initial;padding-bottom:1rem;padding-top:1rem;position:relative}.prism-code.title{border-radius:0 0 .2em .2em}pre.prism-code{float:left;min-width:100%;overflow:initial;padding:20px}.token{display:inline-block}li>code,p>code{word-wrap:break-word;background:#011627;border-radius:.2em;color:#d6deeb;padding:.2em;white-space:pre-wrap}.gatsby-highlight{-webkit-overflow-scrolling:touch;font-size:1rem;overflow:auto;position:relative}.gatsby-highlight::-webkit-scrollbar{display:none}.gatsby-highlight>code[class*=language-],.gatsby>pre[class*=language-]{-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;overflow-wrap:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-break:normal;word-spacing:normal}.gatsby-highlight .token-line{border-left:4px solid transparent;margin-left:-20px;margin-right:-20px}.line-number-style{display:inline-block;opacity:.3;padding-left:1em;padding-right:2em;position:relative;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1.2em}.gatsby-highlight .token-line.highlight-line{background-color:#023751;border-left:4px solid #029bce}.gatsby-highlight .token-line.highlight-line .line-number-style{left:0;opacity:.5;width:calc(1.2em - 4px)}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="search" type="application/opensearchdescription+xml" title="Matthew Daly" href="/opensearch.xml"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><title data-react-helmet="true">Building a Phonegap app with Laravel and Angular - Part 1 | Matthew Daly</title><link data-react-helmet="true" href="https://matthewdaly.co.uk/blog/2016/09/11/building-a-phonegap-app-with-laravel-and-angular-part-1/" rel="canonical"/><link data-react-helmet="true" href="https://twitter.com/mattbd" rel="me"/><link data-react-helmet="true" href="https://github.com/matthewbdaly" rel="me"/><link data-react-helmet="true" href="mailto:matthew@matthewdaly.co.uk" rel="me"/><link data-react-helmet="true" href="/key.pub" rel="pgpkey"/><link data-react-helmet="true" href="https://webmention.io/matthewdaly.co.uk/xmlrpc" rel="pingback"/><link data-react-helmet="true" href="https://webmention.io/matthewdaly.co.uk/webmention" rel="webmention"/><link data-react-helmet="true" rel="authorization_endpoint" href="https://indieauth.com/auth"/><link data-react-helmet="true" rel="token_endpoint" href="https://tokens.indieauth.com/token"/><link data-react-helmet="true" rel="openid.delegate" href="https://matthewdaly.co.uk"/><link data-react-helmet="true" rel="openid.server" href="https://openid.indieauth.com/openid"/><link data-react-helmet="true" rel="alternate" type="application/rss+xml" title="Matthew Daly - feed" href="/rss.xml"/><link data-react-helmet="true" rel="alternate" type="application/atom+xml" title="Matthew Daly - feed" href="/atom.xml"/><link data-react-helmet="true" rel="alternate" type="application/feed+json" title="Matthew Daly - feed" href="/feed.json"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link rel="icon" href="/favicon-32x32.png?v=53aa06cf17e4239d0dba6ffd09854e02" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=53aa06cf17e4239d0dba6ffd09854e02"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="flex flex-col min-h-screen pb-16 font-sans text-lg antialiased text-gray-800 bg-gray-50 dark:text-gray-100 dark:bg-gray-700 leading-6"><div class="w-full h-2 bg-gradient-to-r from-green-400 via-blue-500 to-purple-500"></div><nav class="w-full p-4 mx-auto lowercase md:w-2/3"><h1 class="block float-none py-4 text-4xl text-center lg:float-left lg:text-left"><a href="/">Matthew Daly</a></h1><ul class="py-2 text-center lg:float-right md:block lg:text-left"><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/blog/archives">Archives</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/about">About</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/uses">Uses</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/posts/1">Blog</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/blog/categories">Categories</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/search">Search</a></li></ul></nav><div class="w-full h-4 clear"></div><main class="flex-grow w-full p-4 mx-auto md:w-2/3"><article class="h-entry"><header><h2 class="py-4 text-2xl font-bold e-content p-name"><a class="u-url" href="https://matthewdaly.co.uk/blog/2016/09/11/building-a-phonegap-app-with-laravel-and-angular-part-1/">Building a Phonegap app with Laravel and Angular - Part 1</a></h2><p class="my-4 text-lg font-semibold">Published by <a href="/" rel="author">Matthew Daly</a> at <!-- -->11th September 2016 6:33 pm</p><time class="hidden dt-published">2016-09-11T18:33:41+00:00</time></header><section><p class="py-2">A lot of my work over the last few years has been on Phonegap apps. Phonegap isn&#x27;t terribly hard to use, but the difference in context between that and a more conventional web app means that you have to move a lot of functionality to the client side, and unless you&#x27;ve used client-side Javascript frameworks before it can be a struggle.</p><p class="py-2">In this series of tutorials I&#x27;ll show you how I might build a Phonegap app. The work involved will include:</p><ul class="py-2 pl-4"><li class="list-disc">Building a REST API using Laravel to expose the data</li><li class="list-disc">Building an admin interface to manage the data</li><li class="list-disc">Building a Phonegap app using Angular.js</li><li class="list-disc">Testing and deploying it</li></ul><p class="py-2">In the process we&#x27;ll cover issues like authentication, authorisation, real-time notifications and working with REST APIs. Note that we won&#x27;t cover the app submission process - you can find plenty of resources on that. We will, however, be using Phonegap Build to build the app.</p><h2 class="py-4 text-2xl font-bold">The brief</h2><p class="py-2">Let&#x27;s say our new client is an animal shelter. The brief for the app is as follows:</p><blockquote class="pl-4 italic text-gray-200 text-gray-900 bg-gray-100 border-l-8 border-gray-500 dark:text-gray-300 dark:bg-gray-800"><p class="py-2">My New Animal Friend will be an app for finding a new pet. Once a user signs in, they&#x27;ll be able to choose what type of pet they&#x27;re looking for, then look through a list of pets available to adopt. They can reject them by swiping left or save them by swiping right. They can see more about the ones they swipe right on, and arrange to meet them, from within the app. Users can also message the staff to ask questions about a pet.</p></blockquote><p class="py-2">Nice idea, but there&#x27;s a lot of work involved! Our very first task is to build the REST API, since everything else relies on that. Before starting, make sure you have the following installed:</p><ul class="py-2 pl-4"><li class="list-disc">PHP (I&#x27;m using PHP 7, but 5.6 should be fine)</li><li class="list-disc">Composer</li><li class="list-disc">Git</li><li class="list-disc">A compatible relational database (I use PostgreSQL)</li><li class="list-disc">Redis</li><li class="list-disc">Your usual text editor</li><li class="list-disc">Node.js</li></ul><p class="py-2">As long as you have this, you should be ready to go. Using <a href="https://laravel.com/docs/5.3/homestead" class="border-b-2 border-green-400">Homestead</a> is the simplest way to get started if you don&#x27;t have all this stuff already.</p><h2 class="py-4 text-2xl font-bold">Starting the API</h2><p class="py-2">To start building our REST API, run the following command from the shell:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">composer</span><span class="token plain"> create-project --prefer-dist laravel/laravel mynewanimalfriend-backend</span></div></pre></div></pre><p class="py-2">We also have some other dependencies we need to install, so switch into the new directory and run the following command:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">composer</span><span class="token plain"> require barryvdh/laravel-cors tymon/jwt-auth predis/predis</span></div></pre></div></pre><p class="py-2">Next, we need to add the new packages to the Laravel config. Open up <code>config/app.php</code> and add the following to the <code>providers</code> array:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">   </span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">Tymon</span><span class="token class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">JWTAuth</span><span class="token class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">Providers</span><span class="token class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">JWTAuthServiceProvider</span><span class="token operator" style="color:#d7deea">::</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain">                                                                                                                                              </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">   </span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">Barryvdh</span><span class="token class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">Cors</span><span class="token class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">ServiceProvider</span><span class="token operator" style="color:#d7deea">::</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain">   </span></div></pre></div></pre><p class="py-2">And the following to the <code>aliases</code> array:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">   </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;JWTAuth&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">Tymon</span><span class="token class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">JWTAuth</span><span class="token class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">Facades</span><span class="token class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">JWTAuth</span><span class="token operator" style="color:#d7deea">::</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">We also need to ensure that the CORS middleware is applied to all API routes. Open up <code>app/Http/Kernel.php</code> and under the <code>api</code> array in <code>protected $middlewareGroups</code> paste the following:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">   </span><span class="token class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">Barryvdh</span><span class="token class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">Cors</span><span class="token class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">HandleCors</span><span class="token operator" style="color:#d7deea">::</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Now that the packages are included, we can publish the files for them:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ php artisan vendor:publish</span></div></pre></div></pre><p class="py-2">Next, we need to set a key for our API authentication:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ php artisan jwt:generate</span></div></pre></div></pre><p class="py-2">And set a custom namespace:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ php artisan app:name AnimalFriend</span></div></pre></div></pre><p class="py-2">You&#x27;ll also want to set up the <code>.env</code> file with the configuration settings for your application. There&#x27;s one at <code>.env.example</code> by default that you can copy and customise. Then run the following command to generate the application key:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ php artisan key:generate</span></div></pre></div></pre><p class="py-2">I had to change the namespace for the user model in <code>config/jwt.php</code> as well:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">    </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;user&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;AnimalFriend\User&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">I also tend to amend the settings in <code>phpunit.xml</code> as follows so that it uses an in-memory SQLite database for tests:</p><pre><div class="gatsby-highlight" data-language="xml"><pre class="prism-code language-xml" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">env</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">APP_ENV</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">value</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">testing</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">env</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">SESSION_DRIVER</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">value</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">array</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">env</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">QUEUE_DRIVER</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">value</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">sync</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">env</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">CACHE_DRIVER</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">value</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">redis</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">env</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">DB_CONNECTION</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">value</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">sqlite</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">env</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">DB_DATABASE</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">value</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">:memory:</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">/&gt;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Also, delete <code>tests/ExampleTest.php</code> and amend <code>tests/TestCase.php</code> as follows in order to use database migrations in tests:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Illuminate</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Foundation</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Testing</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">DatabaseMigrations</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">abstract</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name" style="color:#FAC863">TestCase</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">extends</span><span class="token php language-php"> </span><span class="token php language-php class-name class-name-fully-qualified" style="color:#FAC863">Illuminate</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified" style="color:#FAC863">Foundation</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified" style="color:#FAC863">Testing</span><span class="token php language-php class-name class-name-fully-qualified punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified" style="color:#FAC863">TestCase</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">DatabaseMigrations</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php comment" style="color:#999999">     * The base URL to use while testing the application.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token php language-php comment" style="color:#999999">     * @var string</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">protected</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$baseUrl</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;http://localhost&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token php language-php comment" style="color:#999999">     * Creates the application.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token php language-php comment" style="color:#999999">     * @return \Illuminate\Foundation\Application</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">createApplication</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$app</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">require</span><span class="token php language-php"> </span><span class="token php language-php constant" style="color:#5a9bcf">__DIR__</span><span class="token php language-php operator" style="color:#d7deea">.</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;/../bootstrap/app.php&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$app</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">make</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php class-name class-name-fully-qualified static-context" style="color:#FAC863">Illuminate</span><span class="token php language-php class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified static-context" style="color:#FAC863">Contracts</span><span class="token php language-php class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified static-context" style="color:#FAC863">Console</span><span class="token php language-php class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified static-context" style="color:#FAC863">Kernel</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">bootstrap</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:#c5a5c5">return</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$app</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">With that in place, we can start work on our API proper.</p><h2 class="py-4 text-2xl font-bold">Authenticating our API</h2><p class="py-2">We&#x27;re going to start out with a very limited subset of our API. First, we&#x27;ll implement the authentication for our app, then we&#x27;ll add the facility to view a list of pets or an individual pet. Other functionality will come later. This will be sufficient to get the app working.</p><p class="py-2">First, we need to create our user model. As we&#x27;ll be practising TDD throughout, we write a test for the user model first. Save the following as <code>tests/UserModelTest.php</code>:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">AnimalFriend</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">User</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name" style="color:#FAC863">UserModelTest</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">extends</span><span class="token php language-php"> </span><span class="token php language-php class-name" style="color:#FAC863">TestCase</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php comment" style="color:#999999">     * Test creating a user</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">testCreatingAUser</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Create a User</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$user</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:#79b6f2">factory</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php class-name class-name-fully-qualified static-context" style="color:#FAC863">AnimalFriend</span><span class="token php language-php class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified static-context" style="color:#FAC863">User</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">create</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;bobsmith&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;bob@example.com&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">seeInDatabase</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;users&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;bob@example.com&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Verify it works</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$saved</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context" style="color:#FAC863">User</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">where</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;bob@example.com&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">first</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">assertEquals</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$saved</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">id</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php number" style="color:#5a9bcf">1</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">assertEquals</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$saved</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">name</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;bobsmith&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">If we run the tests:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ vendor/bin/phpunit</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">PHPUnit </span><span class="token number" style="color:#5a9bcf">5.5</span><span class="token plain">.4 by Sebastian Bergmann and contributors.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token builtin class-name" style="color:#FAC863">.</span><span class="token plain">                                                                   </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> / </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">%</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Time: </span><span class="token number" style="color:#5a9bcf">169</span><span class="token plain"> ms, Memory: </span><span class="token number" style="color:#5a9bcf">12</span><span class="token plain">.00MB</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">OK </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> test, </span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain"> assertions</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">We already have a perfectly good <code>User</code> model and the appropriate migrations, so our test already passes.</p><p class="py-2">Next, we need to implement the authentication system. Save this as <code>tests/AuthTest.php</code>:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Illuminate</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Foundation</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Testing</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">DatabaseMigrations</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name" style="color:#FAC863">AuthTest</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">extends</span><span class="token php language-php"> </span><span class="token php language-php class-name" style="color:#FAC863">TestCase</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">DatabaseMigrations</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php comment" style="color:#999999">     * Test the auth</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token php language-php comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">testAuth</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Create a User</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$user</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:#79b6f2">factory</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php class-name class-name-fully-qualified static-context" style="color:#FAC863">AnimalFriend</span><span class="token php language-php class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified static-context" style="color:#FAC863">User</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">create</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;bobsmith&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;bob@example.com&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;password&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:#79b6f2">bcrypt</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;password&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Create request</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$data</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">array</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$user</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">email</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;password&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;password&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$response</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">call</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;POST&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;api/authenticate&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$data</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">assertResponseStatus</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php number" style="color:#5a9bcf">200</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$content</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:#79b6f2">json_decode</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$response</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">getContent</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">assertTrue</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php function" style="color:#79b6f2">array_key_exists</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;token&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$content</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token php language-php comment" style="color:#999999">     * Test the auth when user does not exist</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token php language-php comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">testAuthFailure</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Create data for request</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$data</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">array</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;user@example.com&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;password&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;password&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$response</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">call</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;POST&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;api/authenticate&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$data</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">47</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">48</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Check the status code</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">49</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">assertResponseStatus</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php number" style="color:#5a9bcf">401</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">50</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">51</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">The first test creates a user and sends an authentication request, then confirms that it returns the JSON Web Token. The second checks that a user that doesn&#x27;t exist cannot log in.</p><p class="py-2">Let&#x27;s run the tests:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ vendor/bin/phpunit</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">PHPUnit </span><span class="token number" style="color:#5a9bcf">5.5</span><span class="token plain">.4 by Sebastian Bergmann and contributors.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">FF.                                                                 </span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain"> / </span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">%</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Time: </span><span class="token number" style="color:#5a9bcf">328</span><span class="token plain"> ms, Memory: </span><span class="token number" style="color:#5a9bcf">14</span><span class="token plain">.00MB</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">There were </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> failures:</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain"></span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> AuthTest::testAuth</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">Expected status code </span><span class="token number" style="color:#5a9bcf">200</span><span class="token plain">, got </span><span class="token number" style="color:#5a9bcf">404</span><span class="token plain">.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">Failed asserting that </span><span class="token number" style="color:#5a9bcf">404</span><span class="token plain"> matches expected </span><span class="token number" style="color:#5a9bcf">200</span><span class="token plain">.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php:648</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/tests/AuthTest.php:29</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> AuthTest::testAuthFailure</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">Expected status code </span><span class="token number" style="color:#5a9bcf">401</span><span class="token plain">, got </span><span class="token number" style="color:#5a9bcf">404</span><span class="token plain">.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">Failed asserting that </span><span class="token number" style="color:#5a9bcf">404</span><span class="token plain"> matches expected </span><span class="token number" style="color:#5a9bcf">401</span><span class="token plain">.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php:648</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/tests/AuthTest.php:49</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">FAILURES</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">Tests: </span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain">, Assertions: </span><span class="token number" style="color:#5a9bcf">5</span><span class="token plain">, Failures: </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain">.</span></div></pre></div></pre><p class="py-2">With a failing test in place, we can implement login. First let&#x27;s create our controller at <code>app/Http/Controllers/AuthenticateController.php</code>:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">namespace</span><span class="token php language-php"> </span><span class="token php language-php package">AnimalFriend</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Http</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Controllers</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Illuminate</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Http</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Request</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">AnimalFriend</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Http</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Requests</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">AnimalFriend</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Http</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Controllers</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Controller</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">JWTAuth</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Tymon</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">JWTAuth</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Exceptions</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">JWTException</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">AnimalFriend</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">User</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Hash</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name" style="color:#FAC863">AuthenticateController</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">extends</span><span class="token php language-php"> </span><span class="token php language-php class-name" style="color:#FAC863">Controller</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">private</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$user</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">__construct</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php class-name type-declaration" style="color:#FAC863">User</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$user</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">user</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$user</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">authenticate</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php class-name type-declaration" style="color:#FAC863">Request</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$request</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Get credentials</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$credentials</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$request</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">only</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;password&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Get user</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$user</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">user</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">where</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$credentials</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">first</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:#c5a5c5">try</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token php language-php">            </span><span class="token php language-php comment" style="color:#999999">// attempt to verify the credentials and create a token for the user</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:#c5a5c5">if</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php operator" style="color:#d7deea">!</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$token</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context" style="color:#FAC863">JWTAuth</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">attempt</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$credentials</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token php language-php">                </span><span class="token php language-php keyword" style="color:#c5a5c5">return</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:#79b6f2">response</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">json</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;error&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;invalid_credentials&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php number" style="color:#5a9bcf">401</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token php language-php">            </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">catch</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php class-name" style="color:#FAC863">JWTException</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$e</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token php language-php">            </span><span class="token php language-php comment" style="color:#999999">// something went wrong whilst attempting to encode the token</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token php language-php">            </span><span class="token php language-php keyword" style="color:#c5a5c5">return</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:#79b6f2">response</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">json</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;error&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;could_not_create_token&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php number" style="color:#5a9bcf">500</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// all good so return the token</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:#c5a5c5">return</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:#79b6f2">response</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">json</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php function" style="color:#79b6f2">compact</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;token&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">And we need to set up the route in <code>routes/api.php</code>:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Illuminate</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Http</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Request</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999999">/*</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php comment" style="color:#999999">|--------------------------------------------------------------------------</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php comment" style="color:#999999">| API Routes</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php comment" style="color:#999999">|--------------------------------------------------------------------------</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php comment" style="color:#999999">|</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php comment" style="color:#999999">| Here is where you can register API routes for your application. These</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php comment" style="color:#999999">| routes are loaded by the RouteServiceProvider within a group which</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token php language-php comment" style="color:#999999">| is assigned the &quot;api&quot; middleware group. Enjoy building your API!</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token php language-php comment" style="color:#999999">|</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token php language-php comment" style="color:#999999">*/</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token php language-php"></span><span class="token php language-php class-name static-context" style="color:#FAC863">Route</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">post</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;authenticate&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;AuthenticateController@authenticate&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">Note that because it&#x27;s an API route, it&#x27;s automatically prefixed with <code>api/</code> without us having to do anything.</p><p class="py-2">Now if we run our tests, they should pass:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ vendor/bin/phpunit</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">PHPUnit </span><span class="token number" style="color:#5a9bcf">5.5</span><span class="token plain">.4 by Sebastian Bergmann and contributors.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.                                                                 </span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain"> / </span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">%</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Time: </span><span class="token number" style="color:#5a9bcf">402</span><span class="token plain"> ms, Memory: </span><span class="token number" style="color:#5a9bcf">14</span><span class="token plain">.00MB</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">OK </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain"> tests, </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain"> assertions</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Now we can obtain a JSON Web Token to authenticate users with. To start with we&#x27;ll only support existing users, but later we&#x27;ll add a method to sign up. However, we need at least one user to test with, so we&#x27;ll create a seeder for that at <code>database/seeds/UserTableSeeder.php</code>:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Illuminate</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Database</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Seeder</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Carbon</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Carbon</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name" style="color:#FAC863">UserTableSeeder</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">extends</span><span class="token php language-php"> </span><span class="token php language-php class-name" style="color:#FAC863">Seeder</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php comment" style="color:#999999">     * Run the database seeds.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">run</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Add user</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token php language-php">        </span><span class="token php language-php class-name static-context" style="color:#FAC863">DB</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">table</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;users&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">insert</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;bobsmith&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;bob@example.com&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;created_at&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context" style="color:#FAC863">Carbon</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">now</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;updated_at&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context" style="color:#FAC863">Carbon</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">now</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;password&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context" style="color:#FAC863">Hash</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">make</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string double-quoted-string" style="color:#8dc891">&quot;password&quot;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">You can run <code>php artisan make:seeder UserTableSeeder</code> to generate the file, or just paste it in. You also need to amend <code>database/seeds/DatabaseSeeder.php</code> as follows:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Illuminate</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Database</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Seeder</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name" style="color:#FAC863">DatabaseSeeder</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">extends</span><span class="token php language-php"> </span><span class="token php language-php class-name" style="color:#FAC863">Seeder</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php comment" style="color:#999999">     * Run the database seeds.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">run</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">call</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php class-name static-context" style="color:#FAC863">UserTableSeeder</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">This ensures the seeder will actually be called. Then, run the following commands:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ php artisan migrate</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">$ php artisan db:seed</span></div></pre></div></pre><p class="py-2">That sets up our user in the database.</p><h2 class="py-4 text-2xl font-bold">Adding the Pets endpoint</h2><p class="py-2">Our next step is to add the pets model and endpoint. Our <code>Pet</code> model should have the following fields:</p><ul class="py-2 pl-4"><li class="list-disc">ID</li><li class="list-disc">Timestamps (<code>created_at</code> and <code>updated_at</code>)</li><li class="list-disc">Name</li><li class="list-disc">Path to photo</li><li class="list-disc">Availability</li><li class="list-disc">Type (eg cat, dog)</li></ul><p class="py-2">Let&#x27;s create a test for that model:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">AnimalFriend</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Pet</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name" style="color:#FAC863">PetModelTest</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">extends</span><span class="token php language-php"> </span><span class="token php language-php class-name" style="color:#FAC863">TestCase</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php comment" style="color:#999999">     * Test creating a pet</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">testCreatingAPet</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Create a Pet</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$pet</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:#79b6f2">factory</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php class-name class-name-fully-qualified static-context" style="color:#FAC863">AnimalFriend</span><span class="token php language-php class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified static-context" style="color:#FAC863">Pet</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">create</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Freddie&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Cat&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">seeInDatabase</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;pets&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Cat&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Verify it works</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$saved</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context" style="color:#FAC863">Pet</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">where</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Freddie&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">first</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">assertEquals</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$saved</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">id</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php number" style="color:#5a9bcf">1</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">assertEquals</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$saved</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">name</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Freddie&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">assertEquals</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$saved</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">type</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Cat&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">assertEquals</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$saved</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">available</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php number" style="color:#5a9bcf">1</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">assertEquals</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$saved</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">picture</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;1.jpg&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">Save this as <code>tests/PetModelTest.php</code>. Then run the tests:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ vendor/bin/phpunit</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">PHPUnit </span><span class="token number" style="color:#5a9bcf">5.5</span><span class="token plain">.4 by Sebastian Bergmann and contributors.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">E.                                                                </span><span class="token number" style="color:#5a9bcf">4</span><span class="token plain"> / </span><span class="token number" style="color:#5a9bcf">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">%</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Time: </span><span class="token number" style="color:#5a9bcf">414</span><span class="token plain"> ms, Memory: </span><span class="token number" style="color:#5a9bcf">16</span><span class="token plain">.00MB</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">There was </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> error:</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain"></span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> PetModelTest::testCreatingAUser</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">InvalidArgumentException: Unable to </span><span class="token function" style="color:#79b6f2">locate</span><span class="token plain"> factory with name </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">default</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">AnimalFriend</span><span class="token punctuation" style="color:#8dc891">\</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Database/Eloquent/FactoryBuilder.php:126</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php:2280</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Database/Eloquent/FactoryBuilder.php:139</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Database/Eloquent/FactoryBuilder.php:106</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Database/Eloquent/FactoryBuilder.php:84</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/tests/PetModelTest.php:16</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">ERRORS</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">Tests: </span><span class="token number" style="color:#5a9bcf">4</span><span class="token plain">, Assertions: </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain">, Errors: </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain">.</span></div></pre></div></pre><p class="py-2">First we need to create a factory for creating a pet in <code>database/factories/ModelFactory.php</code>:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token variable" style="color:#d7deea">$factory</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">define</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">AnimalFriend</span><span class="token class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">Pet</span><span class="token operator" style="color:#d7deea">::</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name class-name-fully-qualified type-declaration" style="color:#FAC863">Faker</span><span class="token class-name class-name-fully-qualified type-declaration punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified type-declaration" style="color:#FAC863">Generator</span><span class="token plain"> </span><span class="token variable" style="color:#d7deea">$faker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token variable" style="color:#d7deea">$faker</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token property" style="color:#5a9bcf">firstNameMale</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">        </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;type&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;Cat&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">        </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;available&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">        </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;picture&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;1.jpg&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Then, we create the model:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ php artisan make:model Pet</span></div></pre></div></pre><p class="py-2">Next, we create a migration for the <code>Pet</code> model:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ php artisan make:migration create_pets_table</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">Created Migration: 2016_09_11_145010_create_pets_table</span></div></pre></div></pre><p class="py-2">And paste in the following code:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Illuminate</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Support</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Facades</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Schema</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Illuminate</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Database</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Schema</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Blueprint</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Illuminate</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Database</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Migrations</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Migration</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name" style="color:#FAC863">CreatePetsTable</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">extends</span><span class="token php language-php"> </span><span class="token php language-php class-name" style="color:#FAC863">Migration</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php comment" style="color:#999999">     * Run the migrations.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token php language-php comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">up</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token php language-php">        </span><span class="token php language-php class-name static-context" style="color:#FAC863">Schema</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">create</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;pets&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php class-name type-declaration" style="color:#FAC863">Blueprint</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$table</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token php language-php">            </span><span class="token php language-php variable" style="color:#d7deea">$table</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">increments</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;id&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token php language-php">            </span><span class="token php language-php variable" style="color:#d7deea">$table</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php keyword type-declaration" style="color:#c5a5c5">string</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token php language-php">            </span><span class="token php language-php variable" style="color:#d7deea">$table</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php keyword type-declaration" style="color:#c5a5c5">string</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;type&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token php language-php">            </span><span class="token php language-php variable" style="color:#d7deea">$table</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php keyword type-declaration" style="color:#c5a5c5">string</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;available&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token php language-php">            </span><span class="token php language-php variable" style="color:#d7deea">$table</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php keyword type-declaration" style="color:#c5a5c5">string</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;picture&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">nullable</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token php language-php">            </span><span class="token php language-php variable" style="color:#d7deea">$table</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">timestamps</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token php language-php comment" style="color:#999999">     * Reverse the migrations.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token php language-php comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">down</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token php language-php">        </span><span class="token php language-php class-name static-context" style="color:#FAC863">Schema</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">drop</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;pets&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">Time to run the tests again:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ vendor/bin/phpunit</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">PHPUnit </span><span class="token number" style="color:#5a9bcf">5.5</span><span class="token plain">.4 by Sebastian Bergmann and contributors.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">..</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">                                                                </span><span class="token number" style="color:#5a9bcf">4</span><span class="token plain"> / </span><span class="token number" style="color:#5a9bcf">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">%</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Time: </span><span class="token number" style="color:#5a9bcf">412</span><span class="token plain"> ms, Memory: </span><span class="token number" style="color:#5a9bcf">16</span><span class="token plain">.00MB</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">OK </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">4</span><span class="token plain"> tests, </span><span class="token number" style="color:#5a9bcf">12</span><span class="token plain"> assertions</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">With that done, we can start work on implementing the endpoint. We need to check that unauthorised users cannot retrieve the data, and that authorised users can. First, let&#x27;s create <code>tests/PetControllerTest.php</code>:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Illuminate</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Foundation</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Testing</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">DatabaseMigrations</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name" style="color:#FAC863">PetControllerTest</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">extends</span><span class="token php language-php"> </span><span class="token php language-php class-name" style="color:#FAC863">TestCase</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">DatabaseMigrations</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php comment" style="color:#999999">     * Test fetching pets when unauthorised</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token php language-php comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">testFetchingPetsWhenUnauthorised</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Create a Pet</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$pet</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:#79b6f2">factory</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php class-name class-name-fully-qualified static-context" style="color:#FAC863">AnimalFriend</span><span class="token php language-php class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified static-context" style="color:#FAC863">Pet</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">create</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Freddie&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Cat&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">seeInDatabase</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;pets&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Cat&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Create request</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$response</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">call</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;GET&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;/api/pets&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">assertResponseStatus</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php number" style="color:#5a9bcf">400</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token php language-php comment" style="color:#999999">     * Test fetching pets when authorised</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token php language-php comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">testFetchingPets</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Create a Pet</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$pet</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:#79b6f2">factory</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php class-name class-name-fully-qualified static-context" style="color:#FAC863">AnimalFriend</span><span class="token php language-php class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified static-context" style="color:#FAC863">Pet</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">create</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Freddie&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Cat&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">seeInDatabase</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;pets&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;type&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Cat&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Create a User</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$user</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:#79b6f2">factory</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php class-name class-name-fully-qualified static-context" style="color:#FAC863">AnimalFriend</span><span class="token php language-php class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token php language-php class-name class-name-fully-qualified static-context" style="color:#FAC863">User</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">create</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;bobsmith&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;bob@example.com&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">47</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">seeInDatabase</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;users&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;bob@example.com&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">48</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">49</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Create request</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">50</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$token</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php class-name static-context" style="color:#FAC863">JWTAuth</span><span class="token php language-php operator" style="color:#d7deea">::</span><span class="token php language-php function" style="color:#79b6f2">fromUser</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$user</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">51</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$headers</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">array</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">52</span><span class="token php language-php">            </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Authorization&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Bearer &#x27;</span><span class="token php language-php operator" style="color:#d7deea">.</span><span class="token php language-php variable" style="color:#d7deea">$token</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">53</span><span class="token php language-php">        </span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">54</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">55</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Send it</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">56</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">json</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;GET&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;/api/pets&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$headers</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">57</span><span class="token php language-php">            </span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">seeJsonStructure</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">58</span><span class="token php language-php">                </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;*&#x27;</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=&gt;</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">59</span><span class="token php language-php">                    </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;id&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">60</span><span class="token php language-php">                    </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">61</span><span class="token php language-php">                    </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;type&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">62</span><span class="token php language-php">                    </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;available&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">63</span><span class="token php language-php">                    </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;picture&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">64</span><span class="token php language-php">                    </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;created_at&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">65</span><span class="token php language-php">                    </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;updated_at&#x27;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">66</span><span class="token php language-php">                </span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">67</span><span class="token php language-php">            </span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">68</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">assertResponseStatus</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php number" style="color:#5a9bcf">200</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">69</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">70</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">First, we create a pet, make an HTTP request to <code>/api/pets</code>, and check we are not authorised. Next, we do the same, but also create a user and a JSON Web Token, and pass the token through in the request. Then we verify the response data and that it was successful.</p><p class="py-2">Let&#x27;s run the tests:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ vendor/bin/phpunit </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">PHPUnit </span><span class="token number" style="color:#5a9bcf">5.5</span><span class="token plain">.4 by Sebastian Bergmann and contributors.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">FF</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">                                                              </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain"> / </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">%</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Time: </span><span class="token number" style="color:#5a9bcf">509</span><span class="token plain"> ms, Memory: </span><span class="token number" style="color:#5a9bcf">16</span><span class="token plain">.00MB</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">There were </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> failures:</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain"></span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> PetControllerTest::testFetchingPetsWhenUnauthorised</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">Expected status code </span><span class="token number" style="color:#5a9bcf">400</span><span class="token plain">, got </span><span class="token number" style="color:#5a9bcf">404</span><span class="token plain">.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">Failed asserting that </span><span class="token number" style="color:#5a9bcf">404</span><span class="token plain"> matches expected </span><span class="token number" style="color:#5a9bcf">400</span><span class="token plain">.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php:648</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/tests/PetControllerTest.php:25</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> PetControllerTest::testFetchingPets</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">Failed asserting that null is of </span><span class="token builtin class-name" style="color:#FAC863">type</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;array&quot;</span><span class="token builtin class-name" style="color:#FAC863">.</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php:295</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/tests/PetControllerTest.php:67</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">FAILURES</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">Tests: </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain">, Assertions: </span><span class="token number" style="color:#5a9bcf">17</span><span class="token plain">, Failures: </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain">.</span></div></pre></div></pre><p class="py-2">That looks correct, so we can start building our endpoint. We can generate a boilerplate for it as follows:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ $ php artisan make:controller PetController --resource</span></div></pre></div></pre><p class="py-2">Note the <code>--resource</code> flag - this tells Laravel to set it up to be a RESTful controller with certain predefined functions. Next, let&#x27;s amend the new file at <code>app\Http\Controllers/PetController.php</code> as follows:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">namespace</span><span class="token php language-php"> </span><span class="token php language-php package">AnimalFriend</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Http</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Controllers</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">Illuminate</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Http</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Request</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">AnimalFriend</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Http</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Requests</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">use</span><span class="token php language-php"> </span><span class="token php language-php package">AnimalFriend</span><span class="token php language-php package punctuation" style="color:#8dc891">\</span><span class="token php language-php package">Pet</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">class</span><span class="token php language-php"> </span><span class="token php language-php class-name-definition class-name" style="color:#FAC863">PetController</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">extends</span><span class="token php language-php"> </span><span class="token php language-php class-name" style="color:#FAC863">Controller</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">private</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$pet</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">__construct</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php class-name type-declaration" style="color:#FAC863">Pet</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$pet</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">pet</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$pet</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token php language-php comment" style="color:#999999">     * Display a listing of the resource.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token php language-php comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token php language-php comment" style="color:#999999">     * @return \Illuminate\Http\Response</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token php language-php comment" style="color:#999999">     */</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token php language-php">    </span><span class="token php language-php keyword" style="color:#c5a5c5">public</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php function-definition function" style="color:#79b6f2">index</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Get all pets</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token php language-php">        </span><span class="token php language-php variable" style="color:#d7deea">$pets</span><span class="token php language-php"> </span><span class="token php language-php operator" style="color:#d7deea">=</span><span class="token php language-php"> </span><span class="token php language-php variable" style="color:#d7deea">$this</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php property" style="color:#5a9bcf">pet</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">get</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token php language-php">        </span><span class="token php language-php comment" style="color:#999999">// Send response</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token php language-php">        </span><span class="token php language-php keyword" style="color:#c5a5c5">return</span><span class="token php language-php"> </span><span class="token php language-php function" style="color:#79b6f2">response</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">json</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php variable" style="color:#d7deea">$pets</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php number" style="color:#5a9bcf">200</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token php language-php">    </span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">This implements an index route that shows all pets. Next, we hook up the route in <code>routes/api.php</code>:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">// Auth routes</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain"></span><span class="token class-name static-context" style="color:#FAC863">Route</span><span class="token operator" style="color:#d7deea">::</span><span class="token function" style="color:#79b6f2">group</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;middleware&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;jwt.auth&#x27;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token class-name static-context" style="color:#FAC863">Route</span><span class="token operator" style="color:#d7deea">::</span><span class="token function" style="color:#79b6f2">resource</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;pets&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;PetController&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Note that we wrap this resource in the <code>jwt.auth</code> middleware to prevent access by unauthorised users. Implementing this as middleware makes it very easy to reuse. Also note that we can specify it as a resource, meaning we don&#x27;t have to explicitly hook up each route to a controller method.</p><p class="py-2">Let&#x27;s run the tests again:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ vendor/bin/phpunit </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">PHPUnit </span><span class="token number" style="color:#5a9bcf">5.5</span><span class="token plain">.4 by Sebastian Bergmann and contributors.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">EE</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">                                                              </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain"> / </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">%</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Time: </span><span class="token number" style="color:#5a9bcf">511</span><span class="token plain"> ms, Memory: </span><span class="token number" style="color:#5a9bcf">16</span><span class="token plain">.00MB</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">There were </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> errors:</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain"></span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> PetControllerTest::testFetchingPetsWhenUnauthorised</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">ReflectionException: Class jwt.auth does not exist</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Container/Container.php:734</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Container/Container.php:629</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Foundation/Application.php:709</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php:173</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php:517</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/tests/PetControllerTest.php:24</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> PetControllerTest::testFetchingPets</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">ReflectionException: Class jwt.auth does not exist</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Container/Container.php:734</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Container/Container.php:629</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Foundation/Application.php:709</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php:173</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php:517</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php:72</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/tests/PetControllerTest.php:56</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">ERRORS</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">Tests: </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain">, Assertions: </span><span class="token number" style="color:#5a9bcf">15</span><span class="token plain">, Errors: </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain">.</span></div></pre></div></pre><p class="py-2">Looks like JWT isn&#x27;t configured correctly. We can fix that in <code>app/Http/Kernel.php</code> by adding it to <code>$routeMiddleware</code>:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">        </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;jwt.auth&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;Tymon\JWTAuth\Middleware\GetUserFromToken&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">        </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;jwt.refresh&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;Tymon\JWTAuth\Middleware\RefreshToken&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">And run the tests again:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ vendor/bin/phpunit</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">PHPUnit </span><span class="token number" style="color:#5a9bcf">5.5</span><span class="token plain">.4 by Sebastian Bergmann and contributors.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">..</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">                                                              </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain"> / </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">%</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Time: </span><span class="token number" style="color:#5a9bcf">514</span><span class="token plain"> ms, Memory: </span><span class="token number" style="color:#5a9bcf">16</span><span class="token plain">.00MB</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">OK </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain"> tests, </span><span class="token number" style="color:#5a9bcf">25</span><span class="token plain"> assertions</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Our final task for today on the API is building a route for fetching a single pet. Our tests need to handle three situations:</p><ul class="py-2 pl-4"><li class="list-disc">An unauthorised request</li><li class="list-disc">A request for a pet that does not exist</li><li class="list-disc">A request for a pet that does exist</li></ul><p class="py-2">Add these methods to <code>tests/PetControllerTest.php</code>:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token comment" style="color:#999999">     * Test fetching pet when unauthorised</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token function-definition function" style="color:#79b6f2">testFetchingPetWhenUnauthorised</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Create a Pet</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$pet</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">factory</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">AnimalFriend</span><span class="token class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">Pet</span><span class="token operator" style="color:#d7deea">::</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">create</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">            </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;Freddie&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">            </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;type&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;Cat&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$this</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">seeInDatabase</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;pets&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;type&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;Cat&#x27;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Send request</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$response</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token variable" style="color:#d7deea">$this</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">call</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;GET&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;/api/pets/&#x27;</span><span class="token operator" style="color:#d7deea">.</span><span class="token variable" style="color:#d7deea">$pet</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token property" style="color:#5a9bcf">id</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$this</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">assertResponseStatus</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">400</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token comment" style="color:#999999">     * Test fetching pet which does not exist</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token function-definition function" style="color:#79b6f2">testFetchingPetDoesNotExist</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Create a User</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$user</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">factory</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">AnimalFriend</span><span class="token class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">User</span><span class="token operator" style="color:#d7deea">::</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">create</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">            </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;bobsmith&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">            </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;bob@example.com&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$this</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">seeInDatabase</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;users&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;bob@example.com&#x27;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Create request</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$token</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name static-context" style="color:#FAC863">JWTAuth</span><span class="token operator" style="color:#d7deea">::</span><span class="token function" style="color:#79b6f2">fromUser</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token variable" style="color:#d7deea">$user</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$headers</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">array</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain">            </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;Authorization&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;Bearer &#x27;</span><span class="token operator" style="color:#d7deea">.</span><span class="token variable" style="color:#d7deea">$token</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Send it</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$this</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">json</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;GET&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;/api/pets/1&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token variable" style="color:#d7deea">$headers</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$this</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">assertResponseStatus</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">404</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token comment" style="color:#999999">     * Test fetching pet when authorised</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">47</span><span class="token comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">48</span><span class="token comment" style="color:#999999">     * @return void</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">49</span><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">50</span><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token function-definition function" style="color:#79b6f2">testFetchingPet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">51</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">52</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Create a Pet</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">53</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$pet</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">factory</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">AnimalFriend</span><span class="token class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">Pet</span><span class="token operator" style="color:#d7deea">::</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">create</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">54</span><span class="token plain">            </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;Freddie&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">55</span><span class="token plain">            </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;type&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;Cat&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">56</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">57</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$this</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">seeInDatabase</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;pets&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;type&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;Cat&#x27;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">58</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">59</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Create a User</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">60</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$user</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">factory</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">AnimalFriend</span><span class="token class-name class-name-fully-qualified static-context punctuation" style="color:#8dc891">\</span><span class="token class-name class-name-fully-qualified static-context" style="color:#FAC863">User</span><span class="token operator" style="color:#d7deea">::</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">create</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">61</span><span class="token plain">            </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;bobsmith&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">62</span><span class="token plain">            </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;bob@example.com&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">63</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">64</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$this</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">seeInDatabase</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;users&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;email&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;bob@example.com&#x27;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">65</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">66</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Create request</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">67</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$token</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name static-context" style="color:#FAC863">JWTAuth</span><span class="token operator" style="color:#d7deea">::</span><span class="token function" style="color:#79b6f2">fromUser</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token variable" style="color:#d7deea">$user</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">68</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$headers</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">array</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">69</span><span class="token plain">            </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;Authorization&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;Bearer &#x27;</span><span class="token operator" style="color:#d7deea">.</span><span class="token variable" style="color:#d7deea">$token</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">70</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">71</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">72</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Send it</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">73</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$this</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">json</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;GET&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;/api/pets/&#x27;</span><span class="token operator" style="color:#d7deea">.</span><span class="token variable" style="color:#d7deea">$pet</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token property" style="color:#5a9bcf">id</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token variable" style="color:#d7deea">$headers</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">74</span><span class="token plain">            </span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">seeJsonStructure</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">75</span><span class="token plain">                </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;id&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">76</span><span class="token plain">                </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;name&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">77</span><span class="token plain">                </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;type&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">78</span><span class="token plain">                </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;available&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">79</span><span class="token plain">                </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;picture&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">80</span><span class="token plain">                </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;created_at&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">81</span><span class="token plain">                </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;updated_at&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">82</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">83</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$this</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">assertResponseStatus</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">84</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Let&#x27;s check our tests fail:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ vendor/bin/phpunit </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">PHPUnit </span><span class="token number" style="color:#5a9bcf">5.5</span><span class="token plain">.4 by Sebastian Bergmann and contributors.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">..</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.FE</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">                                                           </span><span class="token number" style="color:#5a9bcf">9</span><span class="token plain"> / </span><span class="token number" style="color:#5a9bcf">9</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">%</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Time: </span><span class="token number" style="color:#5a9bcf">974</span><span class="token plain"> ms, Memory: </span><span class="token number" style="color:#5a9bcf">16</span><span class="token plain">.00MB</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">There was </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> error:</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain"></span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> PetControllerTest::testFetchingPet</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">PHPUnit_Framework_Exception: Argument </span><span class="token comment" style="color:#999999">#2 (No Value) of PHPUnit_Framework_Assert::assertArrayHasKey() must be a array or ArrayAccess</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php:304</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/tests/PetControllerTest.php:145</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">--</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">There was </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> failure:</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain"></span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> PetControllerTest::testFetchingPetDoesNotExist</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">Expected status code </span><span class="token number" style="color:#5a9bcf">404</span><span class="token plain">, got </span><span class="token number" style="color:#5a9bcf">400</span><span class="token plain">.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">Failed asserting that </span><span class="token number" style="color:#5a9bcf">400</span><span class="token plain"> matches expected </span><span class="token number" style="color:#5a9bcf">404</span><span class="token plain">.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php:648</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">/home/matthew/Projects/mynewanimalfriend-backend/tests/PetControllerTest.php:112</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">ERRORS</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">Tests: </span><span class="token number" style="color:#5a9bcf">9</span><span class="token plain">, Assertions: </span><span class="token number" style="color:#5a9bcf">31</span><span class="token plain">, Errors: </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain">, Failures: </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain">.</span></div></pre></div></pre><p class="py-2">Now, we already have the <code>show()</code> method hooked up by default, so we just have to implement it in <code>app/Http/Controllers/PetController.php</code>:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token comment" style="color:#999999">     * Display the specified resource.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token comment" style="color:#999999">     *</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token comment" style="color:#999999">     * @param  int  $id</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token comment" style="color:#999999">     * @return \Illuminate\Http\Response</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token function-definition function" style="color:#79b6f2">show</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token variable" style="color:#d7deea">$id</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Get pet</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">        </span><span class="token variable" style="color:#d7deea">$pet</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token variable" style="color:#d7deea">$this</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token property" style="color:#5a9bcf">pet</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">findOrFail</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token variable" style="color:#d7deea">$id</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Send response</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">response</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token operator" style="color:#d7deea">-&gt;</span><span class="token function" style="color:#79b6f2">json</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token variable" style="color:#d7deea">$pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">And let&#x27;s run our tests again:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ vendor/bin/phpunit </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">PHPUnit </span><span class="token number" style="color:#5a9bcf">5.5</span><span class="token plain">.4 by Sebastian Bergmann and contributors.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">..</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.                                                           </span><span class="token number" style="color:#5a9bcf">9</span><span class="token plain"> / </span><span class="token number" style="color:#5a9bcf">9</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">%</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Time: </span><span class="token number" style="color:#5a9bcf">693</span><span class="token plain"> ms, Memory: </span><span class="token number" style="color:#5a9bcf">16</span><span class="token plain">.00MB</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">OK </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">9</span><span class="token plain"> tests, </span><span class="token number" style="color:#5a9bcf">39</span><span class="token plain"> assertions</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Now we have all the endpoints we need to get started with the app. You can find the source code for this backend on <a href="https://github.com/matthewbdaly/mynewanimalfriend-backend" class="border-b-2 border-green-400">Github</a> - check out the <code>lesson-1</code> tag.</p><p class="py-2">That seems like a good place to stop for now. We have our first pass at the back end. It&#x27;s not complete by any means, but it&#x27;s a good start, and is sufficient for us to get some basic functionality up and running in the app. In the next instalment we&#x27;ll start working with Phonegap to build the first pass at the app itself. Later instalments will see us working with both the app and backend to build it into a more useful whole.</p></section><hr/><div class="py-4"><a class="p-category" href="/blog/categories/php/"><span class="inline-block px-4 py-2 my-2 mr-2 text-sm font-bold text-gray-900 bg-purple-200 rounded-full hover:bg-purple-800 hover:text-gray-200 transition-colors duration-500">php</span></a><a class="p-category" href="/blog/categories/laravel/"><span class="inline-block px-4 py-2 my-2 mr-2 text-sm font-bold text-gray-900 bg-purple-200 rounded-full hover:bg-purple-800 hover:text-gray-200 transition-colors duration-500">laravel</span></a><a class="p-category" href="/blog/categories/javascript/"><span class="inline-block px-4 py-2 my-2 mr-2 text-sm font-bold text-gray-900 bg-purple-200 rounded-full hover:bg-purple-800 hover:text-gray-200 transition-colors duration-500">javascript</span></a><a class="p-category" href="/blog/categories/angular/"><span class="inline-block px-4 py-2 my-2 mr-2 text-sm font-bold text-gray-900 bg-purple-200 rounded-full hover:bg-purple-800 hover:text-gray-200 transition-colors duration-500">angular</span></a><a class="p-category" href="/blog/categories/phonegap/"><span class="inline-block px-4 py-2 my-2 mr-2 text-sm font-bold text-gray-900 bg-purple-200 rounded-full hover:bg-purple-800 hover:text-gray-200 transition-colors duration-500">phonegap</span></a><a class="p-category" href="/blog/categories/laravel-phonegap-tutorial/"><span class="inline-block px-4 py-2 my-2 mr-2 text-sm font-bold text-gray-900 bg-purple-200 rounded-full hover:bg-purple-800 hover:text-gray-200 transition-colors duration-500">laravel-phonegap-tutorial</span></a></div><nav class="pt-4 clear-both box-border"><a rel="prev" class="float-left w-1/2 p-2 shadow-sm hover:bg-gray-200 dark:hover:bg-gray-800 transition duration-300 ease-in-out" href="/blog/2016/09/05/deploying-new-versions-of-a-laravel-app-with-fabric/"><p><strong class="font-bold clear-both">← Previous page</strong></p><p class="pl-6">Deploying new versions of a Laravel app with Fabric</p></a><a rel="next" class="float-right w-1/2 p-2 shadow-sm hover:bg-gray-200 dark:hover:bg-gray-800 transition duration-300 ease-in-out" href="/blog/2016/09/18/building-a-phonegap-app-with-laravel-and-angular-part-2/"><p><strong>→ Next page</strong></p><p class="pl-6">Building a Phonegap app with Laravel and Angular - Part 2</p></a></nav><div id="disqus_thread"></div></article></main></div><footer class="w-full p-4 text-gray-100 bg-gray-800"><ul class="flex flex-row flex-wrap justify-center w-full p-2 mx-auto text-center md:w-2/3 box-border"><li class="w-1/3 my-2 md:w-1/6"><a href="/posts/1">Blog</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="/about">About</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="/contact">Contact</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="https://twitter.com/mattbd">Twitter</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="https://github.com/matthewbdaly">Github</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="/rss.xml">Feed</a></li></ul><div class="w-full p-4 mx-auto text-center md:w-2/3"><p>© Matthew Daly <!-- -->2022</p></div></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-17043630-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2016/09/11/building-a-phonegap-app-with-laravel-and-angular-part-1/";window.___webpackCompilationHash="24a66320b98e19766621";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-11649d7082f91630a0f4.js"],"app":["/app-70d9172bf3fd43cbd65e.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-d99355bfc088afa60212.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-cd3c9aeb262d31f4738f.js"],"component---src-pages-search-tsx":["/component---src-pages-search-tsx-e93b9d2a4bf1d8518f68.js"],"component---src-templates-404-tsx":["/component---src-templates-404-tsx-dfb519f1975b2c946385.js"],"component---src-templates-archives-tsx":["/component---src-templates-archives-tsx-ad260b9de714fbd082c5.js"],"component---src-templates-categories-tsx":["/component---src-templates-categories-tsx-16c09be8d2349317ecb1.js"],"component---src-templates-category-tsx":["/component---src-templates-category-tsx-fe151db2072467694c26.js"],"component---src-templates-chunk-tsx":["/component---src-templates-chunk-tsx-0e1de4fb0a7a9892ad42.js"],"component---src-templates-page-tsx":["/component---src-templates-page-tsx-7ffb202f3f0ee82bb055.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-4d75edd4812735998de4.js"]};/*]]>*/</script><script src="/polyfill-11649d7082f91630a0f4.js" nomodule=""></script><script src="/app-70d9172bf3fd43cbd65e.js" async=""></script><script src="/framework-a6e7e2d9b047634414ab.js" async=""></script><script src="/webpack-runtime-899f909dad7c52bd5f43.js" async=""></script></body></html>