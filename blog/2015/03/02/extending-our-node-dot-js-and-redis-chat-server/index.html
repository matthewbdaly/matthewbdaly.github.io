<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta http-equiv="Content-Security-Policy" content="base-uri &#x27;self&#x27;; default-src &#x27;self&#x27; *.google-analytics.com disqus.com *.disqus.com *.disquscdn.com getform.io; script-src &#x27;self&#x27; localhost:* *.addthis.com *.google-analytics.com *.googletagmanager.com *.disquscdn.com *.disqus.com disqus.com *.addthisedge.com graph.facebook.com &#x27;unsafe-inline&#x27; &#x27;unsafe-eval&#x27;; style-src &#x27;self&#x27; fonts.googleapis.com *.addthis.com google-analytics.com *.disquscdn.com *.disqus.com &#x27;unsafe-inline&#x27;; object-src &#x27;none&#x27;; form-action &#x27;self&#x27; getform.io; font-src &#x27;self&#x27; data: fonts.google-apis.com fonts.gstatic.com; connect-src &#x27;self&#x27; ws://localhost:* *.google-analytics.com stats.g.doubleclick.net; img-src &#x27;self&#x27; *.google-analytics.com *.disquscdn.com *.disqus.com stats.g.doubleclick.net; child-src &#x27;self&#x27;; frame-src disqus.com *.addthis.com;"/><meta name="generator" content="Gatsby 4.20.0"/><meta data-react-helmet="true" name="description" content="In this tutorial, we&#x27;re going to extend the chat system we built in  the first tutorial  to include the following functionality: Persisting the data Prompting users to sign in and…"/><meta data-react-helmet="true" property="og:title" content="Extending our Node.js and Redis chat server"/><meta data-react-helmet="true" property="og:description" content="In this tutorial, we&#x27;re going to extend the chat system we built in  the first tutorial  to include the following functionality: Persisting the data Prompting users to sign in and…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta name="theme-color" content="#374151"/><style data-href="/styles.334ddc49367d6eafe98b.css" data-identity="gatsby-global-css">/* ! tailwindcss v3.1.8 | MIT License | https://tailwindcss.com */*,:after,:before{border:0 solid #e5e7eb;box-sizing:border-box}:after,:before{--tw-content:""}html{-webkit-text-size-adjust:100%;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{line-height:inherit;margin:0}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{color:inherit;font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }.float-right{float:right}.float-left{float:left}.float-none{float:none}.clear-both{clear:both}.m-0{margin:0}.mx-auto{margin-left:auto;margin-right:auto}.my-2{margin-bottom:.5rem;margin-top:.5rem}.my-4{margin-bottom:1rem;margin-top:1rem}.mx-0{margin-left:0;margin-right:0}.mt-2{margin-top:.5rem}.-mb-8{margin-bottom:-2rem}.-mb-4{margin-bottom:-1rem}.mr-8{margin-right:2rem}.mt-16{margin-top:4rem}.mr-2{margin-right:.5rem}.box-border{box-sizing:border-box}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.hidden{display:none}.h-2{height:.5rem}.h-4{height:1rem}.min-h-screen{min-height:100vh}.w-full{width:100%}.w-1\/3{width:33.333333%}.w-1\/2{width:50%}.w-3\/4{width:75%}.w-1\/4{width:25%}.flex-grow{flex-grow:1}.list-disc{list-style-type:disc}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.justify-center{justify-content:center}.space-y-32>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(8rem*var(--tw-space-y-reverse));margin-top:calc(8rem*(1 - var(--tw-space-y-reverse)))}.space-y-16>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(4rem*var(--tw-space-y-reverse));margin-top:calc(4rem*(1 - var(--tw-space-y-reverse)))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(2rem*var(--tw-space-y-reverse));margin-top:calc(2rem*(1 - var(--tw-space-y-reverse)))}.divide-y>:not([hidden])~:not([hidden]){--tw-divide-y-reverse:0;border-bottom-width:calc(1px*var(--tw-divide-y-reverse));border-top-width:calc(1px*(1 - var(--tw-divide-y-reverse)))}.divide-gray-800>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgb(31 41 55/var(--tw-divide-opacity))}.overflow-x-auto{overflow-x:auto}.overflow-x-scroll{overflow-x:scroll}.rounded-lg{border-radius:.5rem}.rounded-full{border-radius:9999px}.rounded-t-lg{border-top-left-radius:.5rem;border-top-right-radius:.5rem}.border-2{border-width:2px}.border-b-2{border-bottom-width:2px}.border-l-8{border-left-width:8px}.border-b-4{border-bottom-width:4px}.border-green-400{--tw-border-opacity:1;border-color:rgb(74 222 128/var(--tw-border-opacity))}.border-gray-500{--tw-border-opacity:1;border-color:rgb(107 114 128/var(--tw-border-opacity))}.border-gray-800{--tw-border-opacity:1;border-color:rgb(31 41 55/var(--tw-border-opacity))}.border-transparent{border-color:transparent}.border-gray-100{--tw-border-opacity:1;border-color:rgb(243 244 246/var(--tw-border-opacity))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246/var(--tw-bg-opacity))}.bg-gray-300{--tw-bg-opacity:1;background-color:rgb(209 213 219/var(--tw-bg-opacity))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251/var(--tw-bg-opacity))}.bg-red-200{--tw-bg-opacity:1;background-color:rgb(254 202 202/var(--tw-bg-opacity))}.bg-purple-200{--tw-bg-opacity:1;background-color:rgb(233 213 255/var(--tw-bg-opacity))}.bg-gradient-to-b{background-image:linear-gradient(to bottom,var(--tw-gradient-stops))}.bg-gradient-to-r{background-image:linear-gradient(to right,var(--tw-gradient-stops))}.from-gray-200{--tw-gradient-from:#e5e7eb;--tw-gradient-to:rgba(229,231,235,0);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.from-green-400{--tw-gradient-from:#4ade80;--tw-gradient-to:rgba(74,222,128,0);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.via-blue-500{--tw-gradient-to:rgba(59,130,246,0);--tw-gradient-stops:var(--tw-gradient-from),#3b82f6,var(--tw-gradient-to)}.to-gray-300{--tw-gradient-to:#d1d5db}.to-purple-500{--tw-gradient-to:#a855f7}.p-4{padding:1rem}.p-2{padding:.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-4{padding-bottom:1rem;padding-top:1rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-4{padding-right:1rem}.pl-4,.px-4{padding-left:1rem}.pb-16{padding-bottom:4rem}.pt-4{padding-top:1rem}.pl-6{padding-left:1.5rem}.text-center{text-align:center}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.font-sans{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}.text-sm{font-size:.875rem;line-height:1.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-xl{font-size:1.25rem}.text-lg,.text-xl{line-height:1.75rem}.text-lg{font-size:1.125rem}.font-bold{font-weight:700}.font-semibold{font-weight:600}.lowercase{text-transform:lowercase}.italic{font-style:italic}.leading-6{line-height:1.5rem}.text-gray-200{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.text-gray-900{--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55/var(--tw-text-opacity))}.text-gray-100{--tw-text-opacity:1;color:rgb(243 244 246/var(--tw-text-opacity))}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.shadow-lg,.shadow-sm{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgba(0,0,0,.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition-colors{transition-duration:.15s;transition-property:color,background-color,border-color,fill,stroke,-webkit-text-decoration-color;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,-webkit-text-decoration-color;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition{transition-duration:.15s;transition-property:color,background-color,border-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-text-decoration-color,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-text-decoration-color,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-500{transition-duration:.5s}.duration-300{transition-duration:.3s}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}code[class*=language-],pre[class*=language-]{display:block}.hover\:border-green-400:hover{--tw-border-opacity:1;border-color:rgb(74 222 128/var(--tw-border-opacity))}.hover\:bg-gray-200:hover{--tw-bg-opacity:1;background-color:rgb(229 231 235/var(--tw-bg-opacity))}.hover\:bg-purple-800:hover{--tw-bg-opacity:1;background-color:rgb(107 33 168/var(--tw-bg-opacity))}.hover\:text-gray-200:hover{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.focus\:border-blue-300:focus{--tw-border-opacity:1;border-color:rgb(147 197 253/var(--tw-border-opacity))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(3px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}@media (prefers-color-scheme:dark){.dark\:divide-gray-200>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgb(229 231 235/var(--tw-divide-opacity))}.dark\:bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}.dark\:bg-gray-900{--tw-bg-opacity:1;background-color:rgb(17 24 39/var(--tw-bg-opacity))}.dark\:bg-gray-700{--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity))}.dark\:text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219/var(--tw-text-opacity))}.dark\:text-gray-100{--tw-text-opacity:1;color:rgb(243 244 246/var(--tw-text-opacity))}.dark\:text-gray-200{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.dark\:text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55/var(--tw-text-opacity))}.dark\:hover\:bg-gray-800:hover{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}}@media (min-width:768px){.md\:float-none{float:none}.md\:block{display:block}.md\:w-2\/3{width:66.666667%}.md\:w-1\/6{width:16.666667%}}@media (min-width:1024px){.lg\:float-right{float:right}.lg\:float-left{float:left}.lg\:mt-4{margin-top:1rem}.lg\:text-left{text-align:left}}.prism-code{-webkit-overflow-scrolling:touch;background-color:transparent;border-radius:.2em;float:left;font-size:1rem;margin-bottom:1rem;margin-top:1rem;overflow:initial;padding-bottom:1rem;padding-top:1rem;position:relative}.prism-code.title{border-radius:0 0 .2em .2em}pre.prism-code{float:left;min-width:100%;overflow:initial;padding:20px}.token{display:inline-block}li>code,p>code{word-wrap:break-word;color:#ab79d6;white-space:pre-wrap}.gatsby-highlight{-webkit-overflow-scrolling:touch;font-size:1rem;overflow:auto;position:relative}.gatsby-highlight::-webkit-scrollbar{display:none}.gatsby-highlight>code[class*=language-],.gatsby>pre[class*=language-]{-webkit-hyphens:none;hyphens:none;line-height:1.5;overflow-wrap:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-break:normal;word-spacing:normal}.gatsby-highlight .token-line{border-left:4px solid transparent;margin-left:-20px;margin-right:-20px}.line-number-style{display:inline-block;opacity:.3;padding-left:1em;padding-right:2em;position:relative;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:1.2em}.gatsby-highlight .token-line.highlight-line{background-color:#023751;border-left:4px solid #029bce}.gatsby-highlight .token-line.highlight-line .line-number-style{left:0;opacity:.5;width:calc(1.2em - 4px)}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="search" type="application/opensearchdescription+xml" title="Matthew Daly" href="/opensearch.xml"/><script data-gatsby="web-vitals-polyfill">
              !function(){var e,t,n,i,r={passive:!0,capture:!0},a=new Date,o=function(){i=[],t=-1,e=null,f(addEventListener)},c=function(i,r){e||(e=r,t=i,n=new Date,f(removeEventListener),u())},u=function(){if(t>=0&&t<n-a){var r={entryType:"first-input",name:e.type,target:e.target,cancelable:e.cancelable,startTime:e.timeStamp,processingStart:e.timeStamp+t};i.forEach((function(e){e(r)})),i=[]}},s=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var n=function(){c(e,t),a()},i=function(){a()},a=function(){removeEventListener("pointerup",n,r),removeEventListener("pointercancel",i,r)};addEventListener("pointerup",n,r),addEventListener("pointercancel",i,r)}(t,e):c(t,e)}},f=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,s,r)}))},p="hidden"===document.visibilityState?0:1/0;addEventListener("visibilitychange",(function e(t){"hidden"===document.visibilityState&&(p=t.timeStamp,removeEventListener("visibilitychange",e,!0))}),!0);o(),self.webVitals={firstInputPolyfill:function(e){i.push(e),u()},resetFirstInputPolyfill:o,get firstHiddenTime(){return p}}}();
            </script><script>window.dataLayer = window.dataLayer || [];window.dataLayer.push({"platform":"gatsby"}); (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl+'';f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer', 'G-68VZX216JS');</script><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><title data-react-helmet="true">Extending our Node.js and Redis chat server | Matthew Daly</title><link data-react-helmet="true" href="https://matthewdaly.co.uk/blog/2015/03/02/extending-our-node-dot-js-and-redis-chat-server/" rel="canonical"/><link data-react-helmet="true" href="https://github.com/matthewbdaly" rel="me"/><link data-react-helmet="true" href="https://mstdn.social/@matthewbdaly" rel="me"/><link data-react-helmet="true" href="mailto:matthew@matthewdaly.co.uk" rel="me"/><link data-react-helmet="true" href="/key.pub" rel="pgpkey"/><link data-react-helmet="true" href="https://webmention.io/matthewdaly.co.uk/xmlrpc" rel="pingback"/><link data-react-helmet="true" href="https://webmention.io/matthewdaly.co.uk/webmention" rel="webmention"/><link data-react-helmet="true" rel="authorization_endpoint" href="https://indieauth.com/auth"/><link data-react-helmet="true" rel="token_endpoint" href="https://tokens.indieauth.com/token"/><link data-react-helmet="true" rel="openid.delegate" href="https://matthewdaly.co.uk"/><link data-react-helmet="true" rel="openid.server" href="https://openid.indieauth.com/openid"/><link data-react-helmet="true" rel="alternate" type="application/rss+xml" title="Matthew Daly - feed" href="/rss.xml"/><link data-react-helmet="true" rel="alternate" type="application/atom+xml" title="Matthew Daly - feed" href="/atom.xml"/><link data-react-helmet="true" rel="alternate" type="application/feed+json" title="Matthew Daly - feed" href="/feed.json"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link rel="icon" href="/favicon-32x32.png?v=53aa06cf17e4239d0dba6ffd09854e02" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=53aa06cf17e4239d0dba6ffd09854e02"/></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=G-68VZX216JS" height="0" width="0" style="display: none; visibility: hidden" aria-hidden="true"></iframe></noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="flex flex-col min-h-screen pb-16 font-sans text-lg antialiased text-gray-800 bg-gray-50 dark:text-gray-100 dark:bg-gray-700 leading-6"><div class="w-full h-2 bg-gradient-to-r from-green-400 via-blue-500 to-purple-500"></div><nav class="w-full p-4 mx-auto lowercase md:w-2/3"><h1 class="block float-none py-4 text-4xl text-center lg:float-left lg:text-left"><a href="/">Matthew Daly</a></h1><ul class="py-2 text-center lg:float-right md:block lg:text-left"><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/blog/archives">Archives</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/about">About</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/uses">Uses</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/posts/1">Blog</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/blog/categories">Categories</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/search">Search</a></li></ul></nav><div class="w-full h-4 clear"></div><main class="flex-grow w-full p-4 mx-auto md:w-2/3"><article class="h-entry"><header><h2 class="py-4 text-2xl font-bold e-content p-name"><a class="u-url" href="https://matthewdaly.co.uk/blog/2015/03/02/extending-our-node-dot-js-and-redis-chat-server/">Extending our Node.js and Redis chat server</a></h2><p class="my-4 text-lg font-semibold">Published by <a href="/" rel="author">Matthew Daly</a> at <!-- -->2nd March 2015 11:03 pm</p><time class="hidden dt-published">2015-03-02T23:03:48+00:00</time></header><section><p class="py-2">In this tutorial, we&#x27;re going to extend the chat system we built in <a href="/blog/2014/12/31/building-a-chat-server-with-node-dot-js-and-redis/" class="border-b-2 border-green-400">the first tutorial</a> to include the following functionality:</p><ul class="py-2 pl-4"><li class="list-disc">Persisting the data</li><li class="list-disc">Prompting users to sign in and storing their details in a Redis-backed session</li></ul><p class="py-2">In the process, we&#x27;ll pick up a bit more about using Redis.</p><h2 class="py-4 text-2xl font-bold">Persistence</h2><p class="py-2">Our first task is to make our messages persist when the session ends. Now, in order to do this, we&#x27;re going to use a list. A list in Redis can be thought of as equivalent to an array or list in most programming languages, and can be retrieved by passing the key in a similar fashion to how you would retrieve a string.</p><p class="py-2">As usual, we will write our test first. Open up <code>test/test.js</code> and replace the test for sending a message with this:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Test sending a message</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">    </span><span class="token function" style="color:#79b6f2">describe</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Test sending a message&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token function" style="color:#79b6f2">it</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;should return &#x27;Message received&#x27;&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">done</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">            </span><span class="token comment" style="color:#999999">// Connect to server</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> socket </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> io</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">connect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">                </span><span class="token string-property property" style="color:#5a9bcf">&#x27;reconnection delay&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">                </span><span class="token string-property property" style="color:#5a9bcf">&#x27;reopen delay&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">                </span><span class="token string-property property" style="color:#5a9bcf">&#x27;force new connection&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">true</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">            </span><span class="token comment" style="color:#999999">// Handle the message being received</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">            socket</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">on</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;message&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">                </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">include</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Message received&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">                client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">lrange</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;chat:messages&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> messages</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">                    </span><span class="token comment" style="color:#999999">// Check message has been persisted</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">                    </span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> message_list </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">                    messages</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">forEach</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">message</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> i</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">                        message_list</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">push</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">message_list</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">0</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">include</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Message received&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">                    </span><span class="token comment" style="color:#999999">// Finish up</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">                    socket</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">disconnect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">done</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">                </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">            </span><span class="token comment" style="color:#999999">// Send the message</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">            socket</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">emit</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;send&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">message</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Message received&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">The main difference here is that we use our Redis client to get the list <code>chat:messages</code>, and check to see if our message appears in it. Now, let&#x27;s run our test to ensure it fails:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> babblr@1.0.0 </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"> /Users/matthewdaly/Projects/babblr</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> grunt </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"> --verbose</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Initializing</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">Command-line options: --verbose</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">Reading </span><span class="token string" style="color:#8dc891">&quot;Gruntfile.js&quot;</span><span class="token plain"> Gruntfile</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">Registering Gruntfile tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">Initializing config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-contrib-jshint&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-contrib-jshint/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-contrib-jshint/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;jshint.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">+ jshint</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-coveralls&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-coveralls/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-coveralls/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;coverallsTask.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">+ coveralls</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-mocha-istanbul&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-mocha-istanbul/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-mocha-istanbul/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;index.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">+ istanbul_check_coverage, mocha_istanbul</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;Gruntfile.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">+ </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">Running tasks: </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;test&quot;</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint&quot;</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint:all&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">jshint</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token plain">Verifying property jshint.all exists </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token plain">Files: test/test.js, index.js -</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> all</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token plain">Options: </span><span class="token assign-left variable" style="color:#d7deea">force</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">reporterOutput</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">null</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token plain">OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> files lint free.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">47</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">mocha_istanbul</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">48</span><span class="token plain">Verifying property mocha_istanbul.coverage exists </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">49</span><span class="token plain">Files: </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">50</span><span class="token plain">Options: </span><span class="token assign-left variable" style="color:#d7deea">require</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">ui</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">globals</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">reporter</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">timeout</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">coverage</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">slow</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">grep</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">dryRun</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">quiet</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">recursive</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">mask</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;*.js&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">root</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">print</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">noColors</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">harmony</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">coverageFolder</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;coverage&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">reportFormats</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&quot;cobertura&quot;</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">&quot;html&quot;</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">&quot;lcovonly&quot;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">check</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">&quot;statements&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;lines&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;functions&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;branches&quot;</span><span class="token plain">:false</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">excludes</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">mochaOptions</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">istanbulOptions</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">51</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Will execute: </span><span class="token function" style="color:#79b6f2">node</span><span class="token plain"> /Users/matthewdaly/Projects/babblr/node_modules/istanbul/lib/cli.js cover --dir</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">cobertura --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">html --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">lcovonly /Users/matthewdaly/Projects/babblr/node_modules/mocha/bin/_mocha -- test/*.js</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">52</span><span class="token plain">Listening on port </span><span class="token number" style="color:#5a9bcf">5000</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">53</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">54</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">55</span><span class="token plain">  server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">56</span><span class="token plain">Starting the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">57</span><span class="token plain">    Test the index route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">58</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the title Babblr </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">484ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">59</span><span class="token plain">    Test sending a message</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">60</span><span class="token plain">      </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Message received&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">61</span><span class="token plain">Stopping the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">62</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">63</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">64</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> passing </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">552ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">65</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> failing</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">66</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">67</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> server Test sending a message should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Message received&#x27;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">68</span><span class="token plain">     Uncaught AssertionError: expected undefined to include </span><span class="token string" style="color:#8dc891">&#x27;Message received&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">69</span><span class="token plain">      at /Users/matthewdaly/Projects/babblr/test/test.js:62:48</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">70</span><span class="token plain">      at try_callback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/node_modules/redis/index.js:592:9</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">71</span><span class="token plain">      at RedisClient.return_reply </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/node_modules/redis/index.js:685:13</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">72</span><span class="token plain">      at HiredisReplyParser.</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token plain">anonymous</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/node_modules/redis/index.js:321:14</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">73</span><span class="token plain">      at HiredisReplyParser.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:95:17</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">74</span><span class="token plain">      at HiredisReplyParser.execute </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/node_modules/redis/lib/parser/hiredis.js:43:18</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">75</span><span class="token plain">      at RedisClient.on_data </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/node_modules/redis/index.js:547:27</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">76</span><span class="token plain">      at Socket.</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token plain">anonymous</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/node_modules/redis/index.js:102:14</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">77</span><span class="token plain">      at Socket.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:95:17</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">78</span><span class="token plain">      at Socket.</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token plain">anonymous</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">_stream_readable.js:765:14</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">79</span><span class="token plain">      at Socket.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:92:17</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">80</span><span class="token plain">      at emitReadable_ </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">_stream_readable.js:427:10</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">81</span><span class="token plain">      at emitReadable </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">_stream_readable.js:423:5</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">82</span><span class="token plain">      at readableAddChunk </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">_stream_readable.js:166:9</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">83</span><span class="token plain">      at Socket.Readable.push </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">_stream_readable.js:128:10</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">84</span><span class="token plain">      at TCP.onread </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">net.js:529:21</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">85</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">86</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">87</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">88</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">89</span><span class="token plain">Writing coverage object </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage/coverage.json</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">90</span><span class="token plain">Writing coverage reports at </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">91</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">92</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">93</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> Coverage summary </span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">94</span><span class="token plain">Statements   </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">96.97</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">32</span><span class="token plain">/33 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">5</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">95</span><span class="token plain">Branches     </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain">/6 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">96</span><span class="token plain">Functions    </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">80</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">4</span><span class="token plain">/5 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">97</span><span class="token plain">Lines        </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">96.97</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">32</span><span class="token plain">/33 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">98</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">99</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">100</span><span class="token plain">Warning: Task </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> failed. Use --force to continue.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">101</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">102</span><span class="token plain">Aborted due to warnings.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">103</span><span class="token plain"></span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> ERR</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"> Test failed.  See above </span><span class="token keyword" style="color:#c5a5c5">for</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">more</span><span class="token plain"> details.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">104</span><span class="token plain"></span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> ERR</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"> not ok code </span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Our test fails, so now we can start work on implementing the functionality we need. First of all, when a new message is sent, we need to push it to the list. Amend the new message handler in <code>index.js</code> to look like this:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">// Handle new messages</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">io</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">sockets</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">on</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;connection&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">socket</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Subscribe to the Redis channel</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">    subscribe</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">subscribe</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;ChatChannel&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Handle incoming messages</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">    socket</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">on</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;send&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Publish it</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">        client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">publish</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;ChatChannel&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">message</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Persist it to a Redis list</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">        client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">rpush</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;chat:messages&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Anonymous Coward : &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> data</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">message</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Handle receiving messages</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> </span><span class="token function-variable function" style="color:#79b6f2">callback</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">channel</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> data</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">        socket</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">emit</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;message&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">    subscribe</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">on</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;message&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> callback</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Handle disconnect</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">    socket</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">on</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;disconnect&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">        subscribe</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">removeListener</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;message&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> callback</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">The only significant change is the <code>Persist it to a Redis list</code> section. Here we call the <code>RPUSH</code> command to push the current message to <code>chat:messages</code>. <code>RPUSH</code> pushes a message to the end of the list. There&#x27;s a similar command, <code>LPUSH</code>, which pushes an item to the beginning of the list, as well as <code>LPOP</code> and <code>RPOP</code>, which remove and return an item from the beginning and end of the list respectively.</p><p class="py-2">Next we need to handle displaying the list when the main route loads. Replace the index route in <code>index.js</code> with this:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">// Define index route</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;/&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Get messages</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">    client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">lrange</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;chat:messages&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> messages</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">        </span><span class="token comment" style="color:#999999">/* istanbul ignore if */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">        </span><span class="token keyword control-flow" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">            </span><span class="token console class-name" style="color:#FAC863">console</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">log</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#c5a5c5">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">            </span><span class="token comment" style="color:#999999">// Get messages</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> message_list </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">            messages</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">forEach</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">message</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> i</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">                </span><span class="token comment" style="color:#999999">/* istanbul ignore next */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">                message_list</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">push</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">            </span><span class="token comment" style="color:#999999">// Render page</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">            res</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">render</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;index&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">messages</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> message_list</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Here we use the client to return all messages in the list by using the <code>LRANGE</code> command and defining the slice as being from the start to the end of the list. We then loop through the messages and push each to a list, before passing that list to the view.</p><p class="py-2">Speaking of which, we also need to update <code>views/index.hbs</code>:</p><pre><div class="gatsby-highlight" data-language="handlebars"><pre class="prism-code language-handlebars" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">___HANDLEBARS0___</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">container</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">row</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">                </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">col-md-8</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">                    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">conversation</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">                        ___HANDLEBARS1___</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">                        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">p</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">___HANDLEBARS2___</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">p</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">                        ___HANDLEBARS3___</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">                    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">                </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">                </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">col-md-4</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">                    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">form</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">                        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">form-group</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">                            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">label</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">for</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">message</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">Message</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">label</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">                            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">textarea</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">form-control</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">message</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">rows</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">20</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">textarea</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">                            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">a</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">submitbutton</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">btn btn-primary form-control</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">Submit</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">a</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">                        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">                    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">form</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">                </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">            </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">___HANDLEBARS4___</span></div></pre></div></pre><p class="py-2">This just loops through the messages and prints each one in turn. Now let&#x27;s run our tests and make sure they pass:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> babblr@1.0.0 </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"> /Users/matthewdaly/Projects/babblr</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> grunt </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"> --verbose</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Initializing</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">Command-line options: --verbose</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">Reading </span><span class="token string" style="color:#8dc891">&quot;Gruntfile.js&quot;</span><span class="token plain"> Gruntfile</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">Registering Gruntfile tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">Initializing config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-contrib-jshint&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-contrib-jshint/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-contrib-jshint/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;jshint.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">+ jshint</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-coveralls&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-coveralls/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-coveralls/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;coverallsTask.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">+ coveralls</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-mocha-istanbul&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-mocha-istanbul/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-mocha-istanbul/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;index.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">+ istanbul_check_coverage, mocha_istanbul</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;Gruntfile.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">+ </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">Running tasks: </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;test&quot;</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint&quot;</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint:all&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">jshint</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token plain">Verifying property jshint.all exists </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token plain">Files: test/test.js, index.js -</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> all</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token plain">Options: </span><span class="token assign-left variable" style="color:#d7deea">force</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">reporterOutput</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">null</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token plain">OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> files lint free.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">47</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">mocha_istanbul</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">48</span><span class="token plain">Verifying property mocha_istanbul.coverage exists </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">49</span><span class="token plain">Files: </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">50</span><span class="token plain">Options: </span><span class="token assign-left variable" style="color:#d7deea">require</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">ui</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">globals</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">reporter</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">timeout</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">coverage</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">slow</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">grep</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">dryRun</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">quiet</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">recursive</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">mask</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;*.js&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">root</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">print</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">noColors</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">harmony</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">coverageFolder</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;coverage&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">reportFormats</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&quot;cobertura&quot;</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">&quot;html&quot;</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">&quot;lcovonly&quot;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">check</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">&quot;statements&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;lines&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;functions&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;branches&quot;</span><span class="token plain">:false</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">excludes</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">mochaOptions</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">istanbulOptions</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">51</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Will execute: </span><span class="token function" style="color:#79b6f2">node</span><span class="token plain"> /Users/matthewdaly/Projects/babblr/node_modules/istanbul/lib/cli.js cover --dir</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">cobertura --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">html --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">lcovonly /Users/matthewdaly/Projects/babblr/node_modules/mocha/bin/_mocha -- test/*.js</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">52</span><span class="token plain">Listening on port </span><span class="token number" style="color:#5a9bcf">5000</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">53</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">54</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">55</span><span class="token plain">  server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">56</span><span class="token plain">Starting the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">57</span><span class="token plain">    Test the index route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">58</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the title Babblr </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">1262ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">59</span><span class="token plain">    Test sending a message</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">60</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Message received&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">48ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">61</span><span class="token plain">Stopping the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">62</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">63</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">64</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> passing </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">2s</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">65</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">66</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">67</span><span class="token plain">Writing coverage object </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage/coverage.json</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">68</span><span class="token plain">Writing coverage reports at </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">69</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">70</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">71</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> Coverage summary </span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">72</span><span class="token plain">Statements   </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">40</span><span class="token plain">/40 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">7</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">73</span><span class="token plain">Branches     </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">8</span><span class="token plain">/8 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">74</span><span class="token plain">Functions    </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">85.71</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain">/7 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">75</span><span class="token plain">Lines        </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">40</span><span class="token plain">/40 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">76</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">77</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Done. Check coverage folder.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">78</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">79</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;coveralls&quot;</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">80</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">81</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;coveralls:app&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">coveralls</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">82</span><span class="token plain">Verifying property coveralls.app exists </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">83</span><span class="token plain">Files: coverage/lcov.info</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">84</span><span class="token plain">Options: </span><span class="token assign-left variable" style="color:#d7deea">src</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;coverage/lcov.info&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">force</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">85</span><span class="token plain">Submitting </span><span class="token function" style="color:#79b6f2">file</span><span class="token plain"> to coveralls.io: coverage/lcov.info</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">86</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Failed to submit </span><span class="token string" style="color:#8dc891">&#x27;coverage/lcov.info&#x27;</span><span class="token plain"> to coveralls: Bad response: </span><span class="token number" style="color:#5a9bcf">422</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">&quot;message&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token string" style="color:#8dc891">&quot;Couldn&#x27;t find a repository matching this job.&quot;</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">&quot;error&quot;</span><span class="token plain">:true</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">87</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Failed to submit coverage results to coveralls</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">88</span><span class="token plain">Warning: Task </span><span class="token string" style="color:#8dc891">&quot;coveralls:app&quot;</span><span class="token plain"> failed. Use --force to continue.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">89</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">90</span><span class="token plain">Aborted due to warnings.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">91</span><span class="token plain"></span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> ERR</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"> Test failed.  See above </span><span class="token keyword" style="color:#c5a5c5">for</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">more</span><span class="token plain"> details.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">92</span><span class="token plain"></span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> ERR</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"> not ok code </span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">As before, don&#x27;t worry about Coveralls not working - it&#x27;s only an issue when it runs on Travis CI. If everything else is fine, our chat server should now persist our changes.</p><h2 class="py-4 text-2xl font-bold">Sessions and user login</h2><p class="py-2">At present, it&#x27;s hard to carry on a conversation with someone using this site because you can&#x27;t see who is responding to you. We need to implement a mechanism to obtain a username for each user, store it in a session, and then use it to identify all of a user&#x27;s messages. In this case, we&#x27;re going to just prompt the user to enter a username of their choice, but if you wish, you can use something like <a href="http://passportjs.org/" class="border-b-2 border-green-400">Passport.js</a> to allow authentication using third-party services - I&#x27;ll leave that as an exercise for the reader.</p><p class="py-2">Now, Express doesn&#x27;t include any support for sessions out of the box, so we have to install some additional libraries:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">install</span><span class="token plain"> connect-redis express-session body-parser --save</span></div></pre></div></pre><p class="py-2">The <code>express-session</code> library is middleware for Express that allows for storing and retrieving session variables, while <code>connect-redis</code> allows it to use Redis to store this data. We used <code>body-parser</code> for the URL shortener to process <code>POST</code> data, so we will use it again here. Now, we need to set it up. Replace the part of <code>index.js</code> before we set up the templating with this:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">/*jslint node: true */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain"></span><span class="token string" style="color:#8dc891">&#x27;use strict&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Declare variables used</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> app</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> base_url</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> client</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> express</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> hbs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> io</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token maybe-class-name">RedisStore</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> rtg</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> session</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> subscribe</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Define values</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">express </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;express&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">app </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">express</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">port </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">PORT</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">||</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">5000</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">base_url </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">BASE_URL</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">||</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">hbs </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;hbs&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">session </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;express-session&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain"></span><span class="token maybe-class-name">RedisStore</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;connect-redis&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">session</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Set up connection to Redis</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain"></span><span class="token comment" style="color:#999999">/* istanbul ignore if */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain"></span><span class="token keyword control-flow" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">REDISTOGO_URL</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">    rtg  </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;url&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">parse</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">REDISTOGO_URL</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">    client </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;redis&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">createClient</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">port</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">hostname</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">    subscribe </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;redis&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">createClient</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">port</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">hostname</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">    client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">auth</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">auth</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">split</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;:&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">    subscribe</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">auth</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">auth</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">split</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;:&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#c5a5c5">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">    client </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;redis&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">createClient</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">    subscribe </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;redis&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">createClient</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Set up session</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">use</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token function" style="color:#79b6f2">session</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">    </span><span class="token literal-property property" style="color:#5a9bcf">store</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">RedisStore</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">        </span><span class="token literal-property property" style="color:#5a9bcf">client</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> client</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">    </span><span class="token literal-property property" style="color:#5a9bcf">secret</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;blibble&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">This just sets up the session and configures it to use Redis as the back end. Don&#x27;t forget to change the value of <code>secret</code>.</p><p class="py-2">Now, let&#x27;s plan out how our username system is going to work. If a user visits the site and there is no session set, then they should be redirected to a new route, <code>/login</code>. Here they will be prompted to enter a username. Once a satisfactory username (eg one or more characters) has been submitted via the form, it should be stored in the session and the user redirected to the index. There should also be a <code>/logout</code> route to destroy the session and redirect the user back to the login form.</p><p class="py-2">First, let&#x27;s implement a test for fetching the login form in <code>test/test.js</code>:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Test submitting to the login route</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">    </span><span class="token function" style="color:#79b6f2">describe</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Test submitting to the login route&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token function" style="color:#79b6f2">it</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;should store the username in the session and redirect the user to the index&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">done</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">            request</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">post</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">url</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000/login&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">                </span><span class="token literal-property property" style="color:#5a9bcf">form</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token literal-property property" style="color:#5a9bcf">username</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;bobsmith&#x27;</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">                </span><span class="token literal-property property" style="color:#5a9bcf">followRedirect</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">false</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">                </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> response</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">headers</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">location</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;/&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">statusCode</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">302</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">done</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">This test sends a <code>POST</code> request containing the field <code>username</code> with the value <code>bobsmith</code>. We expect to be redirected to the index route.</p><p class="py-2">Let&#x27;s run the test to make sure it fails:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> babblr@1.0.0 </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"> /Users/matthewdaly/Projects/babblr</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> grunt </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"> --verbose</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Initializing</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">Command-line options: --verbose</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">Reading </span><span class="token string" style="color:#8dc891">&quot;Gruntfile.js&quot;</span><span class="token plain"> Gruntfile</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">Registering Gruntfile tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">Initializing config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-contrib-jshint&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-contrib-jshint/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-contrib-jshint/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;jshint.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">+ jshint</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-coveralls&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-coveralls/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-coveralls/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;coverallsTask.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">+ coveralls</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-mocha-istanbul&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-mocha-istanbul/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-mocha-istanbul/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;index.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">+ istanbul_check_coverage, mocha_istanbul</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;Gruntfile.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">+ </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">Running tasks: </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;test&quot;</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint&quot;</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint:all&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">jshint</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token plain">Verifying property jshint.all exists </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token plain">Files: test/test.js, index.js -</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> all</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token plain">Options: </span><span class="token assign-left variable" style="color:#d7deea">force</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">reporterOutput</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">null</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token plain">OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> files lint free.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">47</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">mocha_istanbul</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">48</span><span class="token plain">Verifying property mocha_istanbul.coverage exists </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">49</span><span class="token plain">Files: </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">50</span><span class="token plain">Options: </span><span class="token assign-left variable" style="color:#d7deea">require</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">ui</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">globals</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">reporter</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">timeout</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">coverage</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">slow</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">grep</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">dryRun</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">quiet</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">recursive</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">mask</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;*.js&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">root</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">print</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">noColors</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">harmony</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">coverageFolder</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;coverage&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">reportFormats</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&quot;cobertura&quot;</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">&quot;html&quot;</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">&quot;lcovonly&quot;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">check</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">&quot;statements&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;lines&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;functions&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;branches&quot;</span><span class="token plain">:false</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">excludes</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">mochaOptions</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">istanbulOptions</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">51</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Will execute: </span><span class="token function" style="color:#79b6f2">node</span><span class="token plain"> /Users/matthewdaly/Projects/babblr/node_modules/istanbul/lib/cli.js cover --dir</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">cobertura --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">html --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">lcovonly /Users/matthewdaly/Projects/babblr/node_modules/mocha/bin/_mocha -- test/*.js</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">52</span><span class="token plain">express-session deprecated undefined resave option</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> provide resave option index.js:9:1585</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">53</span><span class="token plain">express-session deprecated undefined saveUninitialized option</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> provide saveUninitialized option index.js:9:1585</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">54</span><span class="token plain">Listening on port </span><span class="token number" style="color:#5a9bcf">5000</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">55</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">56</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">57</span><span class="token plain">  server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">58</span><span class="token plain">Starting the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">59</span><span class="token plain">    Test the index route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">60</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the title Babblr </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">45ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">61</span><span class="token plain">    Test the login route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">62</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the text Please enter a handle</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">63</span><span class="token plain">    Test submitting to the login route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">64</span><span class="token plain">      </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> should store the username </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> the session and redirect the user to the index</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">65</span><span class="token plain">    Test sending a message</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">66</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Message received&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">42ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">67</span><span class="token plain">Stopping the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">68</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">69</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">70</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain"> passing </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">122ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">71</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> failing</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">72</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">73</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> server Test submitting to the login route should store the username </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> the session and redirect the user to the index:</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">74</span><span class="token plain">     Uncaught AssertionError: expected undefined to equal </span><span class="token string" style="color:#8dc891">&#x27;/&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">75</span><span class="token plain">      at Request._callback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/test/test.js:61:58</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">76</span><span class="token plain">      at Request.self.callback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/node_modules/request/request.js:373:22</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">77</span><span class="token plain">      at Request.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:98:17</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">78</span><span class="token plain">      at Request.</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token plain">anonymous</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/node_modules/request/request.js:1318:14</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">79</span><span class="token plain">      at Request.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:117:20</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">80</span><span class="token plain">      at IncomingMessage.</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token plain">anonymous</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/node_modules/request/request.js:1266:12</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">81</span><span class="token plain">      at IncomingMessage.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:117:20</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">82</span><span class="token plain">      at _stream_readable.js:944:16</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">83</span><span class="token plain">      at process._tickCallback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">node.js:442:13</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">84</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">85</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">86</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">87</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">88</span><span class="token plain">Writing coverage object </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage/coverage.json</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">89</span><span class="token plain">Writing coverage reports at </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">90</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">91</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">92</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> Coverage summary </span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">93</span><span class="token plain">Statements   </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">45</span><span class="token plain">/45 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">7</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">94</span><span class="token plain">Branches     </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">8</span><span class="token plain">/8 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">95</span><span class="token plain">Functions    </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">87.5</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">7</span><span class="token plain">/8 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">96</span><span class="token plain">Lines        </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">45</span><span class="token plain">/45 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">97</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">98</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">99</span><span class="token plain">Warning: Task </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> failed. Use --force to continue.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">100</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">101</span><span class="token plain">Aborted due to warnings.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">102</span><span class="token plain"></span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> ERR</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"> Test failed.  See above </span><span class="token keyword" style="color:#c5a5c5">for</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">more</span><span class="token plain"> details.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">103</span><span class="token plain"></span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> ERR</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"> not ok code </span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Now, all we need to do to make this test pass is create a view containing the form and define a route to display it. First, we&#x27;ll define our new route in <code>index.js</code>:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">// Define login route</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;/login&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Render view</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">    res</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">render</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;login&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Next, we&#x27;ll create our new template at <code>views/login.hbs</code>:</p><pre><div class="gatsby-highlight" data-language="handlebars"><pre class="prism-code language-handlebars" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">___HANDLEBARS0___</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">container</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">row</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">                </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">col-md-12</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">                    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">form</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">action</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">/login</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">method</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">POST</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">                        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">form-group</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">                            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">label</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">for</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">Username</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">Please enter a handle</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">label</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">                            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">input</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">text</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">form-control</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">size</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">20</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">required</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">username</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">username</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">input</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">                            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">input</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">submit</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">btn btn-primary form-control</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">input</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">                        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">                    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">form</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">                </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">            </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">___HANDLEBARS1___</span></div></pre></div></pre><p class="py-2">Let&#x27;s run our tests and make sure they pass:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> babblr@1.0.0 </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"> /Users/matthewdaly/Projects/babblr</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> grunt </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"> --verbose</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Initializing</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">Command-line options: --verbose</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">Reading </span><span class="token string" style="color:#8dc891">&quot;Gruntfile.js&quot;</span><span class="token plain"> Gruntfile</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">Registering Gruntfile tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">Initializing config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-contrib-jshint&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-contrib-jshint/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-contrib-jshint/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;jshint.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">+ jshint</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-coveralls&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-coveralls/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-coveralls/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;coverallsTask.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">+ coveralls</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-mocha-istanbul&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-mocha-istanbul/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-mocha-istanbul/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;index.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">+ istanbul_check_coverage, mocha_istanbul</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;Gruntfile.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">+ </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">Running tasks: </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;test&quot;</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint&quot;</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint:all&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">jshint</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token plain">Verifying property jshint.all exists </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token plain">Files: test/test.js, index.js -</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> all</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token plain">Options: </span><span class="token assign-left variable" style="color:#d7deea">force</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">reporterOutput</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">null</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token plain">OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> files lint free.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">47</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">mocha_istanbul</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">48</span><span class="token plain">Verifying property mocha_istanbul.coverage exists </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">49</span><span class="token plain">Files: </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">50</span><span class="token plain">Options: </span><span class="token assign-left variable" style="color:#d7deea">require</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">ui</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">globals</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">reporter</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">timeout</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">coverage</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">slow</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">grep</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">dryRun</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">quiet</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">recursive</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">mask</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;*.js&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">root</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">print</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">noColors</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">harmony</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">coverageFolder</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;coverage&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">reportFormats</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&quot;cobertura&quot;</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">&quot;html&quot;</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">&quot;lcovonly&quot;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">check</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">&quot;statements&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;lines&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;functions&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;branches&quot;</span><span class="token plain">:false</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">excludes</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">mochaOptions</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">istanbulOptions</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">51</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Will execute: </span><span class="token function" style="color:#79b6f2">node</span><span class="token plain"> /Users/matthewdaly/Projects/babblr/node_modules/istanbul/lib/cli.js cover --dir</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">cobertura --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">html --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">lcovonly /Users/matthewdaly/Projects/babblr/node_modules/mocha/bin/_mocha -- test/*.js</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">52</span><span class="token plain">express-session deprecated undefined resave option</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> provide resave option index.js:9:1585</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">53</span><span class="token plain">express-session deprecated undefined saveUninitialized option</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> provide saveUninitialized option index.js:9:1585</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">54</span><span class="token plain">Listening on port </span><span class="token number" style="color:#5a9bcf">5000</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">55</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">56</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">57</span><span class="token plain">  server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">58</span><span class="token plain">Starting the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">59</span><span class="token plain">    Test the index route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">60</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the title Babblr </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">64ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">61</span><span class="token plain">    Test the login route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">62</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the text Please enter a handle</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">63</span><span class="token plain">    Test sending a message</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">64</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Message received&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">78ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">65</span><span class="token plain">Stopping the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">66</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">67</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">68</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain"> passing </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">179ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">69</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">70</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">71</span><span class="token plain">Writing coverage object </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage/coverage.json</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">72</span><span class="token plain">Writing coverage reports at </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">73</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">74</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">75</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> Coverage summary </span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">76</span><span class="token plain">Statements   </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">45</span><span class="token plain">/45 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">7</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">77</span><span class="token plain">Branches     </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">8</span><span class="token plain">/8 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">78</span><span class="token plain">Functions    </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">87.5</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">7</span><span class="token plain">/8 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">79</span><span class="token plain">Lines        </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">45</span><span class="token plain">/45 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">80</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">81</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Done. Check coverage folder.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">82</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">83</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;coveralls&quot;</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">84</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">85</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;coveralls:app&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">coveralls</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">86</span><span class="token plain">Verifying property coveralls.app exists </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">87</span><span class="token plain">Files: coverage/lcov.info</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">88</span><span class="token plain">Options: </span><span class="token assign-left variable" style="color:#d7deea">src</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;coverage/lcov.info&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">force</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">89</span><span class="token plain">Submitting </span><span class="token function" style="color:#79b6f2">file</span><span class="token plain"> to coveralls.io: coverage/lcov.info</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">90</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Failed to submit </span><span class="token string" style="color:#8dc891">&#x27;coverage/lcov.info&#x27;</span><span class="token plain"> to coveralls: Bad response: </span><span class="token number" style="color:#5a9bcf">422</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">&quot;message&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token string" style="color:#8dc891">&quot;Couldn&#x27;t find a repository matching this job.&quot;</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">&quot;error&quot;</span><span class="token plain">:true</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">91</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Failed to submit coverage results to coveralls</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">92</span><span class="token plain">Warning: Task </span><span class="token string" style="color:#8dc891">&quot;coveralls:app&quot;</span><span class="token plain"> failed. Use --force to continue.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">93</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">94</span><span class="token plain">Aborted due to warnings.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">95</span><span class="token plain"></span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> ERR</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"> Test failed.  See above </span><span class="token keyword" style="color:#c5a5c5">for</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">more</span><span class="token plain"> details.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">96</span><span class="token plain"></span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> ERR</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"> not ok code </span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Next, we need to process the submitted form, set the session, and redirect the user back to the index. First, let&#x27;s add another test:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Test submitting to the login route</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">    </span><span class="token function" style="color:#79b6f2">describe</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Test submitting to the login route&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token function" style="color:#79b6f2">it</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;should store the username in the session and redirect the user to the index&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">done</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">            request</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">post</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">url</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000/login&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">                </span><span class="token literal-property property" style="color:#5a9bcf">form</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token literal-property property" style="color:#5a9bcf">username</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;bobsmith&#x27;</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">                </span><span class="token literal-property property" style="color:#5a9bcf">followRedirect</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">false</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">                </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> response</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">headers</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">location</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">statusCode</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">301</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">done</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">This test submits the username, and makes sure that the response received is a 301 redirect to the index route. Let&#x27;s check to make sure it fails:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> babblr@1.0.0 </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"> /Users/matthewdaly/Projects/babblr</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> grunt </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"> --verbose</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Initializing</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">Command-line options: --verbose</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">Reading </span><span class="token string" style="color:#8dc891">&quot;Gruntfile.js&quot;</span><span class="token plain"> Gruntfile</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">Registering Gruntfile tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">Initializing config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-contrib-jshint&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-contrib-jshint/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-contrib-jshint/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;jshint.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">+ jshint</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-coveralls&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-coveralls/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-coveralls/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;coverallsTask.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">+ coveralls</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-mocha-istanbul&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-mocha-istanbul/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-mocha-istanbul/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;index.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">+ istanbul_check_coverage, mocha_istanbul</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;Gruntfile.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">+ </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">Running tasks: </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;test&quot;</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint&quot;</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint:all&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">jshint</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token plain">Verifying property jshint.all exists </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token plain">Files: test/test.js, index.js -</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> all</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token plain">Options: </span><span class="token assign-left variable" style="color:#d7deea">force</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">reporterOutput</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">null</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token plain">OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> files lint free.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">47</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">mocha_istanbul</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">48</span><span class="token plain">Verifying property mocha_istanbul.coverage exists </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">49</span><span class="token plain">Files: </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">50</span><span class="token plain">Options: </span><span class="token assign-left variable" style="color:#d7deea">require</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">ui</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">globals</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">reporter</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">timeout</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">coverage</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">slow</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">grep</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">dryRun</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">quiet</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">recursive</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">mask</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;*.js&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">root</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">print</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">noColors</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">harmony</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">coverageFolder</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;coverage&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">reportFormats</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&quot;cobertura&quot;</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">&quot;html&quot;</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">&quot;lcovonly&quot;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">check</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">&quot;statements&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;lines&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;functions&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;branches&quot;</span><span class="token plain">:false</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">excludes</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">mochaOptions</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">istanbulOptions</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">51</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Will execute: </span><span class="token function" style="color:#79b6f2">node</span><span class="token plain"> /Users/matthewdaly/Projects/babblr/node_modules/istanbul/lib/cli.js cover --dir</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">cobertura --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">html --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">lcovonly /Users/matthewdaly/Projects/babblr/node_modules/mocha/bin/_mocha -- test/*.js</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">52</span><span class="token plain">express-session deprecated undefined resave option</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> provide resave option index.js:9:1585</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">53</span><span class="token plain">express-session deprecated undefined saveUninitialized option</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> provide saveUninitialized option index.js:9:1585</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">54</span><span class="token plain">Listening on port </span><span class="token number" style="color:#5a9bcf">5000</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">55</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">56</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">57</span><span class="token plain">  server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">58</span><span class="token plain">Starting the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">59</span><span class="token plain">    Test the index route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">60</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the title Babblr </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">476ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">61</span><span class="token plain">    Test the login route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">62</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the text Please enter a handle</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">63</span><span class="token plain">    Test submitting to the login route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">64</span><span class="token plain">      </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> should store the username </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> the session and redirect the user to the index</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">65</span><span class="token plain">    Test sending a message</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">66</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Message received&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">42ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">67</span><span class="token plain">Stopping the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">68</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">69</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">70</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain"> passing </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">557ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">71</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> failing</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">72</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">73</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> server Test submitting to the login route should store the username </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> the session and redirect the user to the index:</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">74</span><span class="token plain">     Uncaught AssertionError: expected undefined to equal </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">75</span><span class="token plain">      at Request._callback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/test/test.js:61:58</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">76</span><span class="token plain">      at Request.self.callback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/node_modules/request/request.js:373:22</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">77</span><span class="token plain">      at Request.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:98:17</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">78</span><span class="token plain">      at Request.</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token plain">anonymous</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/node_modules/request/request.js:1318:14</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">79</span><span class="token plain">      at Request.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:117:20</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">80</span><span class="token plain">      at IncomingMessage.</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token plain">anonymous</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/node_modules/request/request.js:1266:12</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">81</span><span class="token plain">      at IncomingMessage.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:117:20</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">82</span><span class="token plain">      at _stream_readable.js:944:16</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">83</span><span class="token plain">      at process._tickCallback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">node.js:442:13</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">84</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">85</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">86</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">87</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">88</span><span class="token plain">Writing coverage object </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage/coverage.json</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">89</span><span class="token plain">Writing coverage reports at </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">90</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">91</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">92</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> Coverage summary </span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">93</span><span class="token plain">Statements   </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">45</span><span class="token plain">/45 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">7</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">94</span><span class="token plain">Branches     </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">8</span><span class="token plain">/8 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">95</span><span class="token plain">Functions    </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">87.5</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">7</span><span class="token plain">/8 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">96</span><span class="token plain">Lines        </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">45</span><span class="token plain">/45 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">97</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">98</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">99</span><span class="token plain">Warning: Task </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> failed. Use --force to continue.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">100</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">101</span><span class="token plain">Aborted due to warnings.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">102</span><span class="token plain"></span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> ERR</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"> Test failed.  See above </span><span class="token keyword" style="color:#c5a5c5">for</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">more</span><span class="token plain"> details.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">103</span><span class="token plain"></span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> ERR</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"> not ok code </span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Now, in order to process <code>POST</code> data we&#x27;ll need to use <code>body-parser</code>. Amend the top of <code>index.js</code> to look like this::</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">/*jslint node: true */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain"></span><span class="token string" style="color:#8dc891">&#x27;use strict&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Declare variables used</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> app</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> base_url</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> bodyParser</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> client</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> express</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> hbs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> io</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token maybe-class-name">RedisStore</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> rtg</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> session</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> subscribe</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Define values</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">express </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;express&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">app </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">express</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">bodyParser </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;body-parser&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">port </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">PORT</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">||</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">5000</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">base_url </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">BASE_URL</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">||</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">hbs </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;hbs&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">session </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;express-session&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain"></span><span class="token maybe-class-name">RedisStore</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;connect-redis&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">session</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Set up connection to Redis</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain"></span><span class="token comment" style="color:#999999">/* istanbul ignore if */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain"></span><span class="token keyword control-flow" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">REDISTOGO_URL</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">    rtg  </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;url&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">parse</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">REDISTOGO_URL</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">    client </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;redis&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">createClient</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">port</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">hostname</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">    subscribe </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;redis&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">createClient</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">port</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">hostname</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">    client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">auth</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">auth</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">split</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;:&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">    subscribe</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">auth</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">auth</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">split</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;:&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#c5a5c5">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">    client </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;redis&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">createClient</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">    subscribe </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;redis&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">createClient</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Set up session</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">use</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token function" style="color:#79b6f2">session</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">    </span><span class="token literal-property property" style="color:#5a9bcf">store</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">RedisStore</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain">        </span><span class="token literal-property property" style="color:#5a9bcf">client</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> client</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain">    </span><span class="token literal-property property" style="color:#5a9bcf">secret</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;blibble&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Set up templating</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">set</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;views&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> __dirname </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;/views&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">set</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;view engine&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;hbs&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">engine</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;hbs&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;hbs&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">__express</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Register partials</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token plain">hbs</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">registerPartials</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">__dirname </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;/views/partials&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Set URL</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">47</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">set</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;base_url&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> base_url</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">48</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">49</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Handle POST data</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">50</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">use</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">bodyParser</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">json</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">51</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">use</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">bodyParser</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">urlencoded</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">52</span><span class="token plain">      </span><span class="token literal-property property" style="color:#5a9bcf">extended</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">true</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">53</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Next, we define a <code>POST</code> route to handle the username input:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">// Process login</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">post</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;/login&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Get username</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> username </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> req</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">username</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// If username length is zero, reload the page</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">    </span><span class="token keyword control-flow" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">username</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">===</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">        res</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">render</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;login&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#c5a5c5">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Store username in session and redirect to index</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">        req</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">session</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">username</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> username</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">        res</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">redirect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;/&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">This should be fairly straightforward. This route accepts a username parameter. If this parameter is not present, the user will see the login form again. Otherwise, they are redirected back to the index.</p><p class="py-2">Now, if you check <code>coverage/index.html</code> after running the tests again, you&#x27;ll notice that there&#x27;s a gap in our coverage for the scenario when a user submits an empty username. Let&#x27;s fix that - add the following test to <code>test/test.js</code>:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Test empty login</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">    </span><span class="token function" style="color:#79b6f2">describe</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Test empty login&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token function" style="color:#79b6f2">it</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;should show the login form&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">done</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">            request</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">post</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">url</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000/login&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">                </span><span class="token literal-property property" style="color:#5a9bcf">form</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token literal-property property" style="color:#5a9bcf">username</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;&#x27;</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">                </span><span class="token literal-property property" style="color:#5a9bcf">followRedirect</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">false</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">                </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> response</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">statusCode</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">include</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Please enter a handle&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">done</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Let&#x27;s run our tests again:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> babblr@1.0.0 </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"> /Users/matthewdaly/Projects/babblr</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> grunt </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"> --verbose</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Initializing</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">Command-line options: --verbose</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">Reading </span><span class="token string" style="color:#8dc891">&quot;Gruntfile.js&quot;</span><span class="token plain"> Gruntfile</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">Registering Gruntfile tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">Initializing config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-contrib-jshint&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-contrib-jshint/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-contrib-jshint/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;jshint.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">+ jshint</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-coveralls&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-coveralls/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-coveralls/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;coverallsTask.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">+ coveralls</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">Registering </span><span class="token string" style="color:#8dc891">&quot;grunt-mocha-istanbul&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#FAC863">local</span><span class="token plain"> Npm module tasks.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">Reading /Users/matthewdaly/Projects/babblr/node_modules/grunt-mocha-istanbul/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">Parsing /Users/matthewdaly/Projects/babblr/node_modules/grunt-mocha-istanbul/package.json</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;index.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">+ istanbul_check_coverage, mocha_istanbul</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">Loading </span><span class="token string" style="color:#8dc891">&quot;Gruntfile.js&quot;</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">+ </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">Running tasks: </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;test&quot;</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint&quot;</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint:all&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">jshint</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token plain">Verifying property jshint.all exists </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token plain">Files: test/test.js, index.js -</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> all</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token plain">Options: </span><span class="token assign-left variable" style="color:#d7deea">force</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">reporterOutput</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">null</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token plain">OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> files lint free.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">47</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">mocha_istanbul</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">48</span><span class="token plain">Verifying property mocha_istanbul.coverage exists </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">49</span><span class="token plain">Files: </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">50</span><span class="token plain">Options: </span><span class="token assign-left variable" style="color:#d7deea">require</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">ui</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">globals</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">reporter</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">timeout</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">coverage</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">slow</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">grep</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">dryRun</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">quiet</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">recursive</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">mask</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;*.js&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">root</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">print</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">noColors</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">harmony</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">coverageFolder</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;coverage&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">reportFormats</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&quot;cobertura&quot;</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">&quot;html&quot;</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">&quot;lcovonly&quot;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">check</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">&quot;statements&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;lines&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;functions&quot;</span><span class="token plain">:false,</span><span class="token string" style="color:#8dc891">&quot;branches&quot;</span><span class="token plain">:false</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">excludes</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">mochaOptions</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false, </span><span class="token assign-left variable" style="color:#d7deea">istanbulOptions</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">51</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Will execute: </span><span class="token function" style="color:#79b6f2">node</span><span class="token plain"> /Users/matthewdaly/Projects/babblr/node_modules/istanbul/lib/cli.js cover --dir</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">cobertura --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">html --report</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">lcovonly /Users/matthewdaly/Projects/babblr/node_modules/mocha/bin/_mocha -- test/*.js</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">52</span><span class="token plain">express-session deprecated undefined resave option</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> provide resave option index.js:9:1669</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">53</span><span class="token plain">express-session deprecated undefined saveUninitialized option</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> provide saveUninitialized option index.js:9:1669</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">54</span><span class="token plain">Listening on port </span><span class="token number" style="color:#5a9bcf">5000</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">55</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">56</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">57</span><span class="token plain">  server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">58</span><span class="token plain">Starting the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">59</span><span class="token plain">    Test the index route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">60</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the title Babblr </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">44ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">61</span><span class="token plain">    Test the login route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">62</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the text Please enter a handle</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">63</span><span class="token plain">    Test submitting to the login route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">64</span><span class="token plain">      ✓ should store the username </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> the session and redirect the user to the index</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">65</span><span class="token plain">    Test empty login</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">66</span><span class="token plain">      ✓ should show the login form</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">67</span><span class="token plain">    Test sending a message</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">68</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Message received&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">41ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">69</span><span class="token plain">Stopping the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">70</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">71</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">72</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">5</span><span class="token plain"> passing </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">145ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">73</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">74</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">75</span><span class="token plain">Writing coverage object </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage/coverage.json</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">76</span><span class="token plain">Writing coverage reports at </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">77</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">78</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">79</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> Coverage summary </span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">80</span><span class="token plain">Statements   </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">54</span><span class="token plain">/54 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">7</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">81</span><span class="token plain">Branches     </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">10</span><span class="token plain">/10 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">82</span><span class="token plain">Functions    </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">88.89</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">8</span><span class="token plain">/9 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">83</span><span class="token plain">Lines        </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">54</span><span class="token plain">/54 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">84</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">85</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Done. Check coverage folder.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">86</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">87</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;coveralls&quot;</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">88</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">89</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;coveralls:app&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">coveralls</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">90</span><span class="token plain">Verifying property coveralls.app exists </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> config</span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.OK</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">91</span><span class="token plain">Files: coverage/lcov.info</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">92</span><span class="token plain">Options: </span><span class="token assign-left variable" style="color:#d7deea">src</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;coverage/lcov.info&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#d7deea">force</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">false</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">93</span><span class="token plain">Submitting </span><span class="token function" style="color:#79b6f2">file</span><span class="token plain"> to coveralls.io: coverage/lcov.info</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">94</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Failed to submit </span><span class="token string" style="color:#8dc891">&#x27;coverage/lcov.info&#x27;</span><span class="token plain"> to coveralls: Bad response: </span><span class="token number" style="color:#5a9bcf">422</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">&quot;message&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token string" style="color:#8dc891">&quot;Couldn&#x27;t find a repository matching this job.&quot;</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">&quot;error&quot;</span><span class="token plain">:true</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">95</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Failed to submit coverage results to coveralls</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">96</span><span class="token plain">Warning: Task </span><span class="token string" style="color:#8dc891">&quot;coveralls:app&quot;</span><span class="token plain"> failed. Use --force to continue.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">97</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">98</span><span class="token plain">Aborted due to warnings.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">99</span><span class="token plain"></span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> ERR</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"> Test failed.  See above </span><span class="token keyword" style="color:#c5a5c5">for</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">more</span><span class="token plain"> details.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">100</span><span class="token plain"></span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> ERR</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"> not ok code </span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Our test now passes (bar, of course, Coveralls failing). Our next step is to actually do something with the session. Now, the <code>request</code> module we use in our test requires a third-party module called <code>tough-cookie</code> to work with cookies, so we need to install that:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">install</span><span class="token plain"> tough-cookie --save-dev</span></div></pre></div></pre><p class="py-2">Next, amend the login test as follows:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Test submitting to the login route</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">    </span><span class="token function" style="color:#79b6f2">describe</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Test submitting to the login route&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token function" style="color:#79b6f2">it</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;should store the username in the session and redirect the user to the index&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">done</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">            request</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">post</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">url</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000/login&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">                </span><span class="token literal-property property" style="color:#5a9bcf">form</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token literal-property property" style="color:#5a9bcf">username</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;bobsmith&#x27;</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">                </span><span class="token literal-property property" style="color:#5a9bcf">jar</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">true</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">                </span><span class="token literal-property property" style="color:#5a9bcf">followRedirect</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">false</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">                </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> response</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">headers</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">location</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;/&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">statusCode</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">302</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">                    </span><span class="token comment" style="color:#999999">// Check the username</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">                    request</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">url</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000/&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">jar</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> response</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">                        </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">include</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;bobsmith&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">                        </span><span class="token function" style="color:#79b6f2">done</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Here we&#x27;re using a new parameter, namely <code>jar</code> - this tells <code>request</code> to store the cookies. We POST the username to the login form, and then we get the index route and verify that the username is shown in the request. Check the test fails, then amend the index route in <code>index.js</code> as follows:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">// Define index route</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;/&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Get messages</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">    client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">lrange</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;chat:messages&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> messages</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">        </span><span class="token comment" style="color:#999999">/* istanbul ignore if */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">        </span><span class="token keyword control-flow" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">            </span><span class="token console class-name" style="color:#FAC863">console</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">log</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#c5a5c5">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">            </span><span class="token comment" style="color:#999999">// Get username</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> username </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> req</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">session</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">username</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">            </span><span class="token comment" style="color:#999999">// Get messages</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> message_list </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">            messages</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">forEach</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">message</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> i</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">                </span><span class="token comment" style="color:#999999">/* istanbul ignore next */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">                message_list</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">push</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">            </span><span class="token comment" style="color:#999999">// Render page</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">            res</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">render</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;index&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">messages</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> message_list</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">username</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> username </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Note we get the username and pass it through to the view. We need to adapt the header view to display the username. Amend <code>views/partials/header.hbs</code> to look like this:</p><pre><div class="gatsby-highlight" data-language="handlebars"><pre class="prism-code language-handlebars" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token doctype punctuation" style="color:#8dc891">&lt;!</span><span class="token doctype doctype-tag" style="color:#999999">DOCTYPE</span><span class="token doctype" style="color:#999999"> </span><span class="token doctype name" style="color:#999999">html</span><span class="token doctype punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain"></span><span class="token comment" style="color:#999999">&lt;!--[if lt IE 7]&gt;      &lt;html class=&quot;no-js lt-ie9 lt-ie8 lt-ie7&quot;&gt; &lt;![endif]--&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain"></span><span class="token comment" style="color:#999999">&lt;!--[if IE 7]&gt;         &lt;html class=&quot;no-js lt-ie9 lt-ie8&quot;&gt; &lt;![endif]--&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token comment" style="color:#999999">&lt;!--[if IE 8]&gt;         &lt;html class=&quot;no-js lt-ie9&quot;&gt; &lt;![endif]--&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">!--[if</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">gt</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">IE</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">8]</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">!--</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">html</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">no-js</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999999">&lt;!--&lt;![endif]--&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">head</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">meta</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">charset</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">utf-8</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">meta</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">http-equiv</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">X-UA-Compatible</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">IE=edge</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">title</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">Babblr</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">title</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">meta</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">description</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">meta</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">viewport</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">width=device-width, initial-scale=1</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">        </span><span class="token comment" style="color:#999999">&lt;!-- Place favicon.ico and apple-touch-icon.png in the root directory --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">link</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">rel</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">stylesheet</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">href</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">/bower_components/bootstrap/dist/css/bootstrap.min.css</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">link</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">rel</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">stylesheet</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">href</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">/bower_components/bootstrap/dist/css/bootstrap-theme.min.css</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">link</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">rel</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">stylesheet</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">href</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">/css/style.css</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">head</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">body</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">        </span><span class="token comment" style="color:#999999">&lt;!--[if lt IE 7]&gt;</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token comment" style="color:#999999">            &lt;p class=&quot;browsehappy&quot;&gt;You are using an &lt;strong&gt;outdated&lt;/strong&gt; browser. Please &lt;a href=&quot;http://browsehappy.com/&quot;&gt;upgrade your browser&lt;/a&gt; to improve your experience.&lt;/p&gt;</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token comment" style="color:#999999">        &lt;![endif]--&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">nav</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">navbar navbar-inverse navbar-static-top</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">role</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">navigation</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">container-fluid</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">                </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">navbar-header</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">                    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">button</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">button</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">navbar-toggle</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">data-toggle</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">collapse</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">data-target</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">#header-nav</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">                        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">span</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">icon-bar</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">span</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">                        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">span</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">icon-bar</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">span</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">                        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">span</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">icon-bar</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">span</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">                    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">button</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">                    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">a</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">navbar-brand</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">href</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">/</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">Babblr</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">a</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">                    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">collapse navbar-collapse navbar-right</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">header-nav</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain">                        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">ul</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">nav navbar-nav</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">                            ___HANDLEBARS0___</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain">                            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">li</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">a</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">href</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">/logout</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">Logged in as ___HANDLEBARS1___</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">a</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">li</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain">                            ___HANDLEBARS2___</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain">                            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">li</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">a</span><span class="token tag" style="color:#fc929e"> </span><span class="token tag attr-name" style="color:#c5a5c5">href</span><span class="token tag attr-value punctuation attr-equals" style="color:#8dc891">=</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag attr-value" style="color:#8dc891">/login</span><span class="token tag attr-value punctuation" style="color:#8dc891">&quot;</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">Log in</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">a</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">li</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token plain">                            ___HANDLEBARS3___</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token plain">                        </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">ul</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token plain">                    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token plain">                </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token plain">            </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">div</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">nav</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Note the addition of a logout link, which we will implement later. Let&#x27;s check our tests pass:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ grunt </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint:all&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">jshint</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> files lint free.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">mocha_istanbul</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">express-session deprecated undefined resave option</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> provide resave option index.js:9:1669</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">express-session deprecated undefined saveUninitialized option</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> provide saveUninitialized option index.js:9:1669</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">Listening on port </span><span class="token number" style="color:#5a9bcf">5000</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">  server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">Starting the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">    Test the index route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the title Babblr </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">44ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">    Test the login route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the text Please enter a handle</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">    Test submitting to the login route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">      ✓ should store the username </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> the session and redirect the user to the index</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">    Test empty login</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">      ✓ should show the login form</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">    Test sending a message</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Message received&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">45ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">Stopping the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">5</span><span class="token plain"> passing </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">156ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">Writing coverage object </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage/coverage.json</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">Writing coverage reports at </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> Coverage summary </span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">Statements   </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">55</span><span class="token plain">/55 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">7</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain">Branches     </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">10</span><span class="token plain">/10 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain">Functions    </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">88.89</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">8</span><span class="token plain">/9 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain">Lines        </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">55</span><span class="token plain">/55 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Done. Check coverage folder.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;coveralls:app&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">coveralls</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Failed to submit </span><span class="token string" style="color:#8dc891">&#x27;coverage/lcov.info&#x27;</span><span class="token plain"> to coveralls: Bad response: </span><span class="token number" style="color:#5a9bcf">422</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">&quot;message&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token string" style="color:#8dc891">&quot;Couldn&#x27;t find a repository matching this job.&quot;</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">&quot;error&quot;</span><span class="token plain">:true</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Failed to submit coverage results to coveralls</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token plain">Warning: Task </span><span class="token string" style="color:#8dc891">&quot;coveralls:app&quot;</span><span class="token plain"> failed. Use --force to continue.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token plain">Aborted due to warnings.</span></div></pre></div></pre><p class="py-2">Excellent! Next, let&#x27;s implement the test for our logout route:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Test logout</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">    </span><span class="token function" style="color:#79b6f2">describe</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Test logout&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token function" style="color:#79b6f2">it</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;should log the user out&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">done</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">            request</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">post</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">url</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000/login&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">                </span><span class="token literal-property property" style="color:#5a9bcf">form</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token literal-property property" style="color:#5a9bcf">username</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;bobsmith&#x27;</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">                </span><span class="token literal-property property" style="color:#5a9bcf">jar</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">true</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">                </span><span class="token literal-property property" style="color:#5a9bcf">followRedirect</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">false</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">                </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> response</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">headers</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">location</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;/&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">statusCode</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">302</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">                    </span><span class="token comment" style="color:#999999">// Check the username</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">                    request</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">url</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000/&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">jar</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> response</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">                        </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">include</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;bobsmith&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">                        </span><span class="token comment" style="color:#999999">// Log the user out</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">                        request</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">url</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000/logout&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">jar</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> response</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">                            </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">include</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Log in&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">                            </span><span class="token function" style="color:#79b6f2">done</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">                            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">This is largely the same as the previous test, but adds some additional content at the end to test logging out afterwards. Let&#x27;s run the test:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ grunt </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint:all&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">jshint</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> files lint free.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">mocha_istanbul</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">express-session deprecated undefined resave option</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> provide resave option index.js:9:1669</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">express-session deprecated undefined saveUninitialized option</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> provide saveUninitialized option index.js:9:1669</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">Listening on port </span><span class="token number" style="color:#5a9bcf">5000</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">  server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">Starting the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">    Test the index route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the title Babblr </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">536ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">    Test the login route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the text Please enter a handle</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">    Test submitting to the login route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">      ✓ should store the username </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> the session and redirect the user to the index</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">    Test empty login</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">      ✓ should show the login form</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">    Test </span><span class="token builtin class-name" style="color:#FAC863">logout</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">      </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> should log the user out</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">    Test sending a message</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Message received&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">49ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">Stopping the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">5</span><span class="token plain"> passing </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">682ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> failing</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> server Test </span><span class="token builtin class-name" style="color:#FAC863">logout</span><span class="token plain"> should log the user out:</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">     Uncaught AssertionError: expected </span><span class="token string" style="color:#8dc891">&#x27;Cannot GET /logout\n&#x27;</span><span class="token plain"> to include </span><span class="token string" style="color:#8dc891">&#x27;Log in&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain">      at Request._callback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/test/test.js:105:45</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">      at Request.self.callback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/node_modules/request/request.js:373:22</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain">      at Request.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:98:17</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain">      at Request.</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token plain">anonymous</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/node_modules/request/request.js:1318:14</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain">      at Request.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:117:20</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token plain">      at IncomingMessage.</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token plain">anonymous</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/babblr/node_modules/request/request.js:1266:12</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token plain">      at IncomingMessage.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:117:20</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token plain">      at _stream_readable.js:944:16</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token plain">      at process._tickCallback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">node.js:442:13</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token plain">Writing coverage object </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage/coverage.json</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">47</span><span class="token plain">Writing coverage reports at </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/babblr/coverage</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">48</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">49</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">50</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> Coverage summary </span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">51</span><span class="token plain">Statements   </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">55</span><span class="token plain">/55 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">7</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">52</span><span class="token plain">Branches     </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">10</span><span class="token plain">/10 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">53</span><span class="token plain">Functions    </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">88.89</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">8</span><span class="token plain">/9 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">54</span><span class="token plain">Lines        </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">55</span><span class="token plain">/55 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">55</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">56</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">57</span><span class="token plain">Warning: Task </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> failed. Use --force to continue.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">58</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">59</span><span class="token plain">Aborted due to warnings.</span></div></pre></div></pre><p class="py-2">Now we have a failing test, let&#x27;s implement our logout route. Add the following route to <code>index.js</code>:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">// Process logout</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;/logout&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Delete username from session</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">    req</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">session</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">username</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#c5a5c5">null</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Redirect user</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">    res</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">redirect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;/&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">If you run your tests again, they should now pass.</p><p class="py-2">Now that we have the user&#x27;s name stored in the session, we can make use of it. First, let&#x27;s amend <code>static/js/main.js</code> so that it no longer adds a default username:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token function" style="color:#79b6f2">$</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token dom variable" style="color:#d7deea">document</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">ready</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">    </span><span class="token string" style="color:#8dc891">&#x27;use strict&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Set up the connection</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> field</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> socket</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> output</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">    socket </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> io</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">connect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token dom variable" style="color:#d7deea">window</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">location</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">href</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Get a reference to the input</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">    field </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">$</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;textarea#message&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Get a reference to the output</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">    output </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">$</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;div.conversation&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Handle message submit</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">    </span><span class="token function" style="color:#79b6f2">$</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;a#submitbutton&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">on</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;click&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Create the message</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">        msg </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> field</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">val</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">        socket</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">emit</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;send&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">message</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> msg </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">        field</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">val</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Handle incoming messages</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">    socket</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">on</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;message&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Insert the message</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">        output</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">append</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;&lt;p&gt;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> data </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;&lt;/p&gt;&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Then, in <code>index.js</code>, we need to declare a variable for our session middleware, which will be shared between Socket.IO and Express:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">// Declare variables used</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> app</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> base_url</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> bodyParser</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> client</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> express</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> hbs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> io</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token maybe-class-name">RedisStore</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> rtg</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> session</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> sessionMiddleware</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> subscribe</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Then we amend the session setup to make it easier to reuse for Socket.IO:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">// Set up session</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">sessionMiddleware </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">session</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token literal-property property" style="color:#5a9bcf">store</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">RedisStore</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">        </span><span class="token literal-property property" style="color:#5a9bcf">client</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> client</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">    </span><span class="token literal-property property" style="color:#5a9bcf">secret</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;blibble&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">use</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">sessionMiddleware</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Towards the end of the file, before we set up our handlers for Socket.IO, we integrate our sessions:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">// Integrate sessions</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">io</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">use</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">socket</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> next</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token function" style="color:#79b6f2">sessionMiddleware</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">socket</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">request</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> socket</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">request</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">res</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> next</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Finally, we rewrite our session handlers to use the username from the session:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">// Handle new messages</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">io</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">sockets</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">on</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;connection&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">socket</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Subscribe to the Redis channel</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">    subscribe</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">subscribe</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;ChatChannel&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Handle incoming messages</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">    socket</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">on</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;send&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Define variables</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> username</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Get username</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">        username </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> socket</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">request</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">session</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">username</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">        </span><span class="token keyword control-flow" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain">username</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">            username </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Anonymous Coward&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">        message </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> username </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;: &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> data</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">message</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Publish it</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">        client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">publish</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;ChatChannel&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Persist it to a Redis list</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">        client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">rpush</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;chat:messages&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Handle receiving messages</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> </span><span class="token function-variable function" style="color:#79b6f2">callback</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">channel</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> data</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">        socket</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">emit</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;message&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">    subscribe</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">on</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;message&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> callback</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Handle disconnect</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">    socket</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">on</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;disconnect&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain">        subscribe</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">removeListener</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;message&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> callback</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Note here that when a message is sent, we get the username from the session, and if it&#x27;s empty, set it to Anonymous Coward. We then prepend it to the message, publish it, and persist it.</p><h2 class="py-4 text-2xl font-bold">One final thing...</h2><p class="py-2">One last job remains. At present, users can pass JavaScript through in messages, which is not terribly secure! We need to fix it. Amend the <code>send</code> handler as follows:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Handle incoming messages</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">    socket</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">on</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;send&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Define variables</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> username</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Strip tags from message</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">        message </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">message</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">replace</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">&lt;[^&gt;]*&gt;</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">g</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Get username</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">        username </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> socket</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">request</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">session</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">username</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">        </span><span class="token keyword control-flow" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain">username</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">            username </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Anonymous Coward&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">        message </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> username </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;: &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> message</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Publish it</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">        client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">publish</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;ChatChannel&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Persist it to a Redis list</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">        client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">rpush</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;chat:messages&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Here we use a regex to strip out any HTML tags from the message - this will prevent anyone injecting JavaScript into our chat client.</p><p class="py-2">And that&#x27;s all, folks! If you want to check out the source for this lesson it&#x27;s in the repository on GitHub, tagged <code>lesson-2</code>. If you want to carry on working on this on your own, there&#x27;s still plenty you can do, such as:</p><ul class="py-2 pl-4"><li class="list-disc">Adding support for multiple rooms</li><li class="list-disc">Using Passport.js to allow logging in using third-party services such as Twitter or Facebook</li><li class="list-disc">Adding formatting for messages, either by using something like Markdown, or a client-side rich text editor</li></ul><p class="py-2">As you can see, it&#x27;s surprising how much you can accomplish using only Redis, and under certain circumstances it offers a lot of advantages over a relational database. It&#x27;s always worth thinking about whether Redis can be used for your project.</p></section><hr/><div class="py-4"><a class="p-category" href="/blog/categories/node-js/"><span class="inline-block px-4 py-2 my-2 mr-2 text-sm font-bold text-gray-900 bg-purple-200 rounded-full hover:bg-purple-800 hover:text-gray-200 transition-colors duration-500">node.js</span></a><a class="p-category" href="/blog/categories/redis/"><span class="inline-block px-4 py-2 my-2 mr-2 text-sm font-bold text-gray-900 bg-purple-200 rounded-full hover:bg-purple-800 hover:text-gray-200 transition-colors duration-500">redis</span></a></div><nav class="pt-4 clear-both box-border"><a rel="prev" class="float-left w-1/2 p-2 shadow-sm hover:bg-gray-200 dark:hover:bg-gray-800 transition duration-300 ease-in-out" href="/blog/2015/02/15/switching-to-my-own-static-site-generator/"><p><strong class="font-bold clear-both">← Previous page</strong></p><p class="pl-6">Switching to my own static site generator</p></a><a rel="next" class="float-right w-1/2 p-2 shadow-sm hover:bg-gray-200 dark:hover:bg-gray-800 transition duration-300 ease-in-out" href="/blog/2015/03/02/syntax-highlighting-in-fenced-code-blocks-in-vim/"><p><strong>→ Next page</strong></p><p class="pl-6">Syntax highlighting in fenced code blocks in Vim</p></a></nav><div id="disqus_thread"></div></article></main></div><footer class="w-full p-4 text-gray-100 bg-gray-800"><ul class="flex flex-row flex-wrap justify-center w-full p-2 mx-auto text-center md:w-2/3 box-border"><li class="w-1/3 my-2 md:w-1/6"><a href="/posts/1">Blog</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="/about">About</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="/contact">Contact</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="https://github.com/matthewbdaly">Github</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="/rss.xml">Feed</a></li></ul><div class="w-full p-4 mx-auto text-center md:w-2/3"><p>© Matthew Daly <!-- -->2023</p></div></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-17043630-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2015/03/02/extending-our-node-dot-js-and-redis-chat-server/";window.___webpackCompilationHash="03b109b95fcb61496370";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-292603999ddf931fbc86.js"],"app":["/app-3e2927c8e54976ecfe87.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-37b4064d2301b772dd78.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-d1e9b895e921a2de2939.js"],"component---src-pages-search-tsx":["/component---src-pages-search-tsx-81cfc8d0339572b55d7b.js"],"component---src-templates-404-tsx":["/component---src-templates-404-tsx-a89b753395f26e6168a7.js"],"component---src-templates-archives-tsx":["/component---src-templates-archives-tsx-3f1ab59e4439981f640f.js"],"component---src-templates-categories-tsx":["/component---src-templates-categories-tsx-76b4e7ca90e18aed5334.js"],"component---src-templates-category-tsx":["/component---src-templates-category-tsx-62f85f91a74032618c5f.js"],"component---src-templates-chunk-tsx":["/component---src-templates-chunk-tsx-335b21a7f665e318e694.js"],"component---src-templates-page-tsx":["/component---src-templates-page-tsx-908068858c97e0fdd11e.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-8d0569f3557f8a07669e.js"]};/*]]>*/</script><script src="/polyfill-292603999ddf931fbc86.js" nomodule=""></script><script src="/app-3e2927c8e54976ecfe87.js" async=""></script><script src="/532a2f07-ffc59c6af1ce0926f24d.js" async=""></script><script src="/framework-a6e7e2d9b047634414ab.js" async=""></script><script src="/webpack-runtime-86553a97766a217594c9.js" async=""></script></body></html>