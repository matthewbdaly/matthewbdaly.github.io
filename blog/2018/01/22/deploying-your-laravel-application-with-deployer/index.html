<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta http-equiv="Content-Security-Policy" content="base-uri &#x27;self&#x27;; default-src &#x27;self&#x27; *.google-analytics.com disqus.com *.disqus.com *.disquscdn.com getform.io; script-src &#x27;self&#x27; localhost:* *.addthis.com *.google-analytics.com *.disquscdn.com *.disqus.com disqus.com *.addthisedge.com graph.facebook.com &#x27;unsafe-inline&#x27; &#x27;unsafe-eval&#x27;; style-src &#x27;self&#x27; fonts.googleapis.com *.addthis.com google-analytics.com *.disquscdn.com *.disqus.com &#x27;unsafe-inline&#x27;; object-src &#x27;none&#x27;; form-action &#x27;self&#x27; getform.io; font-src &#x27;self&#x27; data: fonts.google-apis.com fonts.gstatic.com; connect-src &#x27;self&#x27; ws://localhost:* *.google-analytics.com stats.g.doubleclick.net; img-src &#x27;self&#x27; *.google-analytics.com *.disquscdn.com *.disqus.com stats.g.doubleclick.net; child-src &#x27;self&#x27;; frame-src disqus.com *.addthis.com;"/><meta name="theme-color" content="#3b82f6"/><meta data-react-helmet="true" name="twitter:description" content="Deployment processes have a nasty tendency to be a mish-mash of cobbled-together scripts or utilities in many web shops, with little or no consistency in practice between them. As…"/><meta data-react-helmet="true" name="twitter:title" content="Deploying your Laravel application with Deployer"/><meta data-react-helmet="true" name="twitter:creator" content="mattbd"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:description" content="Deployment processes have a nasty tendency to be a mish-mash of cobbled-together scripts or utilities in many web shops, with little or no consistency in practice between them. As…"/><meta data-react-helmet="true" property="og:title" content="Deploying your Laravel application with Deployer"/><meta data-react-helmet="true" name="description" content="Deployment processes have a nasty tendency to be a mish-mash of cobbled-together scripts or utilities in many web shops, with little or no consistency in practice between them. As…"/><meta name="generator" content="Gatsby 4.15.2"/><style data-href="/styles.2c84e2444e0a46017e4b.css" data-identity="gatsby-global-css">/* ! tailwindcss v3.0.24 | MIT License | https://tailwindcss.com */*,:after,:before{border:0 solid #e5e7eb;box-sizing:border-box}:after,:before{--tw-content:""}html{-webkit-text-size-adjust:100%;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{line-height:inherit;margin:0}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{color:inherit;font-family:inherit;font-size:100%;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]{display:none}*,:after,:before{--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }.float-right{float:right}.float-left{float:left}.float-none{float:none}.clear-both{clear:both}.m-0{margin:0}.mx-auto{margin-left:auto;margin-right:auto}.my-8{margin-bottom:2rem;margin-top:2rem}.my-4{margin-bottom:1rem;margin-top:1rem}.my-2{margin-bottom:.5rem;margin-top:.5rem}.mx-0{margin-left:0;margin-right:0}.mt-2{margin-top:.5rem}.-mb-8{margin-bottom:-2rem}.-mb-4{margin-bottom:-1rem}.mt-8{margin-top:2rem}.mr-8{margin-right:2rem}.mt-16{margin-top:4rem}.mr-2{margin-right:.5rem}.box-border{box-sizing:border-box}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.hidden{display:none}.h-2{height:.5rem}.h-4{height:1rem}.min-h-screen{min-height:100vh}.w-full{width:100%}.w-1\/3{width:33.333333%}.w-2\/3{width:66.666667%}.w-1\/2{width:50%}.w-3\/4{width:75%}.w-1\/4{width:25%}.flex-grow{flex-grow:1}.resize-none{resize:none}.list-disc{list-style-type:disc}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.justify-center{justify-content:center}.space-y-32>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(8rem*var(--tw-space-y-reverse));margin-top:calc(8rem*(1 - var(--tw-space-y-reverse)))}.space-y-16>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(4rem*var(--tw-space-y-reverse));margin-top:calc(4rem*(1 - var(--tw-space-y-reverse)))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(2rem*var(--tw-space-y-reverse));margin-top:calc(2rem*(1 - var(--tw-space-y-reverse)))}.divide-y>:not([hidden])~:not([hidden]){--tw-divide-y-reverse:0;border-bottom-width:calc(1px*var(--tw-divide-y-reverse));border-top-width:calc(1px*(1 - var(--tw-divide-y-reverse)))}.divide-gray-800>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgb(31 41 55/var(--tw-divide-opacity))}.overflow-x-auto{overflow-x:auto}.overflow-x-scroll{overflow-x:scroll}.rounded-lg{border-radius:.5rem}.rounded-full{border-radius:9999px}.rounded-t-lg{border-top-left-radius:.5rem;border-top-right-radius:.5rem}.border-2{border-width:2px}.border-b-2{border-bottom-width:2px}.border-l-8{border-left-width:8px}.border-b-4{border-bottom-width:4px}.border-green-400{--tw-border-opacity:1;border-color:rgb(74 222 128/var(--tw-border-opacity))}.border-gray-500{--tw-border-opacity:1;border-color:rgb(107 114 128/var(--tw-border-opacity))}.border-gray-800{--tw-border-opacity:1;border-color:rgb(31 41 55/var(--tw-border-opacity))}.border-white{--tw-border-opacity:1;border-color:rgb(255 255 255/var(--tw-border-opacity))}.border-transparent{border-color:transparent}.border-gray-100{--tw-border-opacity:1;border-color:rgb(243 244 246/var(--tw-border-opacity))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246/var(--tw-bg-opacity))}.bg-gray-300{--tw-bg-opacity:1;background-color:rgb(209 213 219/var(--tw-bg-opacity))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235/var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251/var(--tw-bg-opacity))}.bg-red-200{--tw-bg-opacity:1;background-color:rgb(254 202 202/var(--tw-bg-opacity))}.bg-purple-200{--tw-bg-opacity:1;background-color:rgb(233 213 255/var(--tw-bg-opacity))}.bg-gradient-to-b{background-image:linear-gradient(to bottom,var(--tw-gradient-stops))}.bg-gradient-to-r{background-image:linear-gradient(to right,var(--tw-gradient-stops))}.from-gray-200{--tw-gradient-from:#e5e7eb;--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to,rgba(229,231,235,0))}.from-green-400{--tw-gradient-from:#4ade80;--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to,rgba(74,222,128,0))}.via-blue-500{--tw-gradient-stops:var(--tw-gradient-from),#3b82f6,var(--tw-gradient-to,rgba(59,130,246,0))}.to-gray-300{--tw-gradient-to:#d1d5db}.to-purple-500{--tw-gradient-to:#a855f7}.p-4{padding:1rem}.p-2{padding:.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-4{padding-bottom:1rem;padding-top:1rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-4{padding-right:1rem}.pl-4,.px-4{padding-left:1rem}.pb-16{padding-bottom:4rem}.pt-4{padding-top:1rem}.pl-6{padding-left:1.5rem}.text-center{text-align:center}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.font-sans{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}.text-sm{font-size:.875rem;line-height:1.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-xl{font-size:1.25rem}.text-lg,.text-xl{line-height:1.75rem}.text-lg{font-size:1.125rem}.font-bold{font-weight:700}.font-semibold{font-weight:600}.lowercase{text-transform:lowercase}.italic{font-style:italic}.leading-6{line-height:1.5rem}.text-gray-200{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.text-gray-900{--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55/var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.text-black{--tw-text-opacity:1;color:rgb(0 0 0/var(--tw-text-opacity))}.text-gray-100{--tw-text-opacity:1;color:rgb(243 244 246/var(--tw-text-opacity))}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.shadow-lg,.shadow-sm{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgba(0,0,0,.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition-colors{transition-duration:.15s;transition-property:color,background-color,border-color,fill,stroke,-webkit-text-decoration-color;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,-webkit-text-decoration-color;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition{transition-duration:.15s;transition-property:color,background-color,border-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-text-decoration-color,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-text-decoration-color,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-500{transition-duration:.5s}.duration-300{transition-duration:.3s}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}code[class*=language-],pre[class*=language-]{display:block}.hover\:border-green-400:hover{--tw-border-opacity:1;border-color:rgb(74 222 128/var(--tw-border-opacity))}.hover\:bg-gray-200:hover{--tw-bg-opacity:1;background-color:rgb(229 231 235/var(--tw-bg-opacity))}.hover\:bg-purple-800:hover{--tw-bg-opacity:1;background-color:rgb(107 33 168/var(--tw-bg-opacity))}.hover\:text-gray-200:hover{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.focus\:border-blue-300:focus{--tw-border-opacity:1;border-color:rgb(147 197 253/var(--tw-border-opacity))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(3px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}@media (prefers-color-scheme:dark){.dark\:divide-gray-200>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgb(229 231 235/var(--tw-divide-opacity))}.dark\:border-black{--tw-border-opacity:1;border-color:rgb(0 0 0/var(--tw-border-opacity))}.dark\:bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}.dark\:bg-gray-900{--tw-bg-opacity:1;background-color:rgb(17 24 39/var(--tw-bg-opacity))}.dark\:bg-gray-700{--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity))}.dark\:text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219/var(--tw-text-opacity))}.dark\:text-gray-100{--tw-text-opacity:1;color:rgb(243 244 246/var(--tw-text-opacity))}.dark\:text-gray-200{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity))}.dark\:hover\:bg-gray-800:hover{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}}@media (min-width:768px){.md\:float-none{float:none}.md\:block{display:block}.md\:w-40{width:10rem}.md\:w-2\/3{width:66.666667%}.md\:w-1\/6{width:16.666667%}}@media (min-width:1024px){.lg\:float-right{float:right}.lg\:float-left{float:left}.lg\:mt-4{margin-top:1rem}.lg\:text-left{text-align:left}}.prism-code{-webkit-overflow-scrolling:touch;background-color:transparent;border-radius:.2em;float:left;font-size:1rem;margin-bottom:1rem;margin-top:1rem;overflow:initial;padding-bottom:1rem;padding-top:1rem;position:relative}.prism-code.title{border-radius:0 0 .2em .2em}pre.prism-code{float:left;min-width:100%;overflow:initial;padding:20px}.token{display:inline-block}li>code,p>code{word-wrap:break-word;background:#011627;border-radius:.2em;color:#d6deeb;padding:.2em;white-space:pre-wrap}.gatsby-highlight{-webkit-overflow-scrolling:touch;font-size:1rem;overflow:auto;position:relative}.gatsby-highlight::-webkit-scrollbar{display:none}.gatsby-highlight>code[class*=language-],.gatsby>pre[class*=language-]{-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;overflow-wrap:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-break:normal;word-spacing:normal}.gatsby-highlight .token-line{border-left:4px solid transparent;margin-left:-20px;margin-right:-20px}.line-number-style{display:inline-block;opacity:.3;padding-left:1em;padding-right:2em;position:relative;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1.2em}.gatsby-highlight .token-line.highlight-line{background-color:#023751;border-left:4px solid #029bce}.gatsby-highlight .token-line.highlight-line .line-number-style{left:0;opacity:.5;width:calc(1.2em - 4px)}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="search" type="application/opensearchdescription+xml" title="Matthew Daly" href="/opensearch.xml"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><title data-react-helmet="true">Deploying your Laravel application with Deployer | Matthew Daly</title><link data-react-helmet="true" href="https://matthewdaly.co.uk/blog/2018/01/22/deploying-your-laravel-application-with-deployer/" rel="canonical"/><link data-react-helmet="true" href="https://twitter.com/mattbd" rel="me"/><link data-react-helmet="true" href="https://github.com/matthewbdaly" rel="me"/><link data-react-helmet="true" href="mailto:matthew@matthewdaly.co.uk" rel="me"/><link data-react-helmet="true" href="/key.pub" rel="pgpkey"/><link data-react-helmet="true" href="https://webmention.io/matthewdaly.co.uk/xmlrpc" rel="pingback"/><link data-react-helmet="true" href="https://webmention.io/matthewdaly.co.uk/webmention" rel="webmention"/><link data-react-helmet="true" rel="authorization_endpoint" href="https://indieauth.com/auth"/><link data-react-helmet="true" rel="token_endpoint" href="https://tokens.indieauth.com/token"/><link data-react-helmet="true" rel="openid.delegate" href="https://matthewdaly.co.uk"/><link data-react-helmet="true" rel="openid.server" href="https://openid.indieauth.com/openid"/><link data-react-helmet="true" rel="alternate" type="application/rss+xml" title="Matthew Daly - feed" href="/rss.xml"/><link data-react-helmet="true" rel="alternate" type="application/atom+xml" title="Matthew Daly - feed" href="/atom.xml"/><link data-react-helmet="true" rel="alternate" type="application/feed+json" title="Matthew Daly - feed" href="/feed.json"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link rel="icon" href="/favicon-32x32.png?v=53aa06cf17e4239d0dba6ffd09854e02" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=53aa06cf17e4239d0dba6ffd09854e02"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="flex flex-col min-h-screen pb-16 font-sans text-lg antialiased text-gray-800 bg-gray-50 dark:text-gray-100 dark:bg-gray-700 leading-6"><div class="w-full h-2 bg-gradient-to-r from-green-400 via-blue-500 to-purple-500"></div><nav class="w-full p-4 mx-auto lowercase md:w-2/3"><h1 class="block float-none py-4 text-4xl text-center lg:float-left lg:text-left"><a href="/">Matthew Daly</a></h1><ul class="py-2 text-center lg:float-right md:block lg:text-left"><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/blog/archives">Archives</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/about">About</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/uses">Uses</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/posts/1">Blog</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/blog/categories">Categories</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/search">Search</a></li></ul></nav><div class="w-full h-4 clear"></div><main class="flex-grow w-full p-4 mx-auto md:w-2/3"><article class="h-entry"><header><h2 class="py-4 text-2xl font-bold e-content p-name"><a class="u-url" href="https://matthewdaly.co.uk/blog/2018/01/22/deploying-your-laravel-application-with-deployer/">Deploying your Laravel application with Deployer</a></h2><p class="my-4 text-lg font-semibold">Published by <a href="/" rel="author">Matthew Daly</a> at <!-- -->22nd January 2018 12:00 pm</p><time class="hidden dt-published">2018-01-22T12:00:14+00:00</time></header><section><p class="py-2">Deployment processes have a nasty tendency to be a mish-mash of cobbled-together scripts or utilities in many web shops, with little or no consistency in practice between them. As a result, it&#x27;s all too easy for even the most experienced developer to mess up a deployment.</p><p class="py-2">I personally have used all kinds of bodged-together solutions. For a while I used Envoy scripts to deploy my Laravel apps, but then there was an issue with the SSH library in PHP 7 that made it impractical to use it. Then I adopted Fabric, which I&#x27;d used before for deploying Django apps and will do fine for deploying PHP apps too, but it wasn&#x27;t much more sophisticated than using shell scripts for deployment purposes. There are third-party services like Deploybot, but these are normally quite expensive for what they are.</p><p class="py-2">A while back I heard of <a href="https://deployer.org/" class="border-b-2 border-green-400">Deployer</a>, but I didn&#x27;t have the opportunity to try it until recently on a personal project as I was working somewhere that had its own in-house deployment process. It&#x27;s a PHP-specific deployment tool with recipes for deploying applications built with various frameworks and CMS&#x27;s, including Laravel, Symfony, CodeIgniter and Drupal.</p><h2 class="py-4 text-2xl font-bold">Installing Deployer</h2><p class="py-2">Deployer is installed as a <code>.phar</code> file, much like you would with Composer:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> -LO https://deployer.org/deployer.phar</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">mv</span><span class="token plain"> deployer.phar /usr/local/bin/dep</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">chmod</span><span class="token plain"> +x /usr/local/bin/dep</span></div></pre></div></pre><p class="py-2">With that done, you should be able to run the following command in your project&#x27;s directory to create a Deployer script:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ dep init</span></div></pre></div></pre><p class="py-2">In response, you should see a list of project types:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">  Welcome to the Deployer config generator  </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">                                            </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain"> This utility will walk you through creating a deploy.php file.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain"> It only covers the </span><span class="token function" style="color:#79b6f2">most</span><span class="token plain"> common items, and tries to guess sensible defaults.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain"> Press ^C at any </span><span class="token function" style="color:#79b6f2">time</span><span class="token plain"> to quit.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain"> Please </span><span class="token keyword" style="color:#c5a5c5">select</span><span class="token plain"> your project </span><span class="token builtin class-name" style="color:#FAC863">type</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">Common</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">:</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">0</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> Common</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> Laravel</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> Symfony</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">3</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> Yii</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">4</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> Yii2 Basic App</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">5</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> Yii2 Advanced App</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">6</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> Zend Framework</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">7</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> CakePHP</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">8</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> CodeIgniter</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">9</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> Drupal</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Here I chose Laravel as I was deploying a Laravel project. I was then prompted for the repository URL - this will be filled in with the origin remote if the current folder is already a Git repository:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">Repository </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">git@gitlab.com:Group/Project.git</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">:</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span></div></pre></div></pre><p class="py-2">You&#x27;ll also see a message about contributing anonymous usage data. After answering this, the file <code>deploy.php</code> will be generated:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token php language-php delimiter important" style="font-weight:400">&lt;?php</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">namespace</span><span class="token php language-php"> </span><span class="token php language-php package">Deployer</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token php language-php"></span><span class="token php language-php keyword" style="color:#c5a5c5">require</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;recipe/laravel.php&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999999">// Configuration</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token php language-php"></span><span class="token php language-php function" style="color:#79b6f2">set</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;repository&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;git@gitlab.com:Group/Project.git&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token php language-php"></span><span class="token php language-php function" style="color:#79b6f2">set</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;git_tty&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php constant boolean" style="color:#ff8b50">true</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"> </span><span class="token php language-php comment" style="color:#999999">// [Optional] Allocate tty for git on first deployment</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token php language-php"></span><span class="token php language-php function" style="color:#79b6f2">add</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;shared_files&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token php language-php"></span><span class="token php language-php function" style="color:#79b6f2">add</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;shared_dirs&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token php language-php"></span><span class="token php language-php function" style="color:#79b6f2">add</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;writable_dirs&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">[</span><span class="token php language-php punctuation" style="color:#8dc891">]</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999999">// Hosts</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token php language-php"></span><span class="token php language-php function" style="color:#79b6f2">host</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;project.com&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token php language-php">    </span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">stage</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;production&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token php language-php">    </span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">set</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;deploy_path&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;/var/www/project.com&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token php language-php">    </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token php language-php"></span><span class="token php language-php function" style="color:#79b6f2">host</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;beta.project.com&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token php language-php">    </span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">stage</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;beta&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token php language-php">    </span><span class="token php language-php operator" style="color:#d7deea">-&gt;</span><span class="token php language-php function" style="color:#79b6f2">set</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;deploy_path&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;/var/www/project.com&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php">  </span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999999">// Tasks</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token php language-php"></span><span class="token php language-php function" style="color:#79b6f2">desc</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;Restart PHP-FPM service&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token php language-php"></span><span class="token php language-php function" style="color:#79b6f2">task</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;php-fpm:restart&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php keyword" style="color:#c5a5c5">function</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php"> </span><span class="token php language-php punctuation" style="color:#8dc891">{</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">// The user must have rights for restart service</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token php language-php">    </span><span class="token php language-php comment" style="color:#999999">// /etc/sudoers: username ALL=NOPASSWD:/bin/systemctl restart php-fpm.service</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token php language-php">    </span><span class="token php language-php function" style="color:#79b6f2">run</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;sudo systemctl restart php-fpm.service&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token php language-php"></span><span class="token php language-php punctuation" style="color:#8dc891">}</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token php language-php"></span><span class="token php language-php function" style="color:#79b6f2">after</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;deploy:symlink&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;php-fpm:restart&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999999">// [Optional] if deploy fails automatically unlock.</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token php language-php"></span><span class="token php language-php function" style="color:#79b6f2">after</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;deploy:failed&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;deploy:unlock&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token php language-php"></span><span class="token php language-php comment" style="color:#999999">// Migrate database before symlink new release.</span><span class="token php language-php"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token php language-php" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token php language-php"></span><span class="token php language-php function" style="color:#79b6f2">before</span><span class="token php language-php punctuation" style="color:#8dc891">(</span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;deploy:symlink&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">,</span><span class="token php language-php"> </span><span class="token php language-php string single-quoted-string" style="color:#8dc891">&#x27;artisan:migrate&#x27;</span><span class="token php language-php punctuation" style="color:#8dc891">)</span><span class="token php language-php punctuation" style="color:#8dc891">;</span><span class="token php language-php"></span></div></pre></div></pre><p class="py-2">By default it has two hosts, <code>beta</code> and <code>production</code>, and you can refer to them by these names. You can also add or remove hosts, and amend the existing ones. Note the deploy path as well - this sets the place where the application gets deployed to.</p><p class="py-2">Note that it&#x27;s set up to expect the server to be using PHP-FPM and Nginx by default, so if you&#x27;re using Apache you may need to amend the command to restart the server. Also, note that if like me you&#x27;re using PHP 7 on a distro like Debian that also has PHP 5 around, you&#x27;ll probably need to change the references to <code>php-fpm</code> as follows:</p><pre><div class="gatsby-highlight" data-language="php"><pre class="prism-code language-php" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token function" style="color:#79b6f2">desc</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;Restart PHP-FPM service&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain"></span><span class="token function" style="color:#79b6f2">task</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;php-fpm:restart&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// The user must have rights for restart service</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// /etc/sudoers: username ALL=NOPASSWD:/bin/systemctl restart php-fpm.service</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">    </span><span class="token function" style="color:#79b6f2">run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;sudo systemctl restart php7.0-fpm.service&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain"></span><span class="token function" style="color:#79b6f2">after</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;deploy:symlink&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#8dc891">&#x27;php-fpm:restart&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">You will also need to make sure the <code>acl</code> package is installed - on Debian and Ubuntu you can install it as follows:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">sudo</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">install</span><span class="token plain"> acl</span></div></pre></div></pre><p class="py-2">Now, the recipe for deploying a Laravel app will include the following:</p><ul class="py-2 pl-4"><li class="list-disc">Pulling from the Git remote</li><li class="list-disc">Updating any Composer dependencies to match <code>composer.json</code></li><li class="list-disc">Running the migrations</li><li class="list-disc">Optimising the application</li></ul><p class="py-2">In addition, one really great feature Deployer offers is rollbacks. Rather than checking out your application directly into the project root you specify, it numbers each release and deploys it in a separate folder, before symlinking that folder to the project root as <code>current</code>. That way, if a release cannot be deployed successfully, rather than leaving your application in an unfinished state, Deployer will symlink the previous version so that you still have a working version of your application.</p><p class="py-2">If you have configured Deployer for that project, you can deploy using the following command where <code>production</code> is the name of the host you&#x27;re deploying to:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ dep deploy production</span></div></pre></div></pre><p class="py-2">The output will look something like this:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">✔ Executing task deploy:prepare</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">✔ Executing task deploy:lock</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">✔ Executing task deploy:release</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">➤ Executing task deploy:update_code</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">Counting objects: </span><span class="token number" style="color:#5a9bcf">761</span><span class="token plain">, done.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Compressing objects: </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">313</span><span class="token plain">/313</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, done.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">Writing objects: </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">761</span><span class="token plain">/761</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, done.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">Total </span><span class="token number" style="color:#5a9bcf">761</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">delta </span><span class="token number" style="color:#5a9bcf">384</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, reused </span><span class="token number" style="color:#5a9bcf">757</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">delta </span><span class="token number" style="color:#5a9bcf">380</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">Connection to linklater.shellshocked.info closed.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">✔ Ok</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">✔ Executing task deploy:shared</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">✔ Executing task deploy:vendors</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">✔ Executing task deploy:writable</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">✔ Executing task artisan:storage:link</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">✔ Executing task artisan:view:clear</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">✔ Executing task artisan:cache:clear</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">✔ Executing task artisan:config:cache</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">✔ Executing task artisan:optimize</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">✔ Executing task artisan:migrate</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">✔ Executing task deploy:symlink</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">✔ Executing task php-fpm:restart</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">✔ Executing task deploy:unlock</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">✔ Executing task cleanup</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">✔ Executing task success</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">Successfully deployed</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">As you can see, we first of all lock the application and pull the latest version from the Git remote. Next we copy the files shared between releases (eg the <code>.env</code> file, the <code>storage/</code> directory etc), update the dependencies, and make sure the permissions are correct. Next we link the storage, clear all the cached content, optimise our app, and migrate the database, before we set up the symlink. Finally we restart the web server and unlock the application.</p><p class="py-2">In the event you discover a problem after deploy and need to rollback manually, you can do so with the following command:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ dep rollback production</span></div></pre></div></pre><p class="py-2">That makes it easy to ensure that in the event of something going wrong, you can quickly switch back to an earlier version with zero downtime.</p><p class="py-2">Deployer has made deployments a lot less painful for me than any other solution I&#x27;ve tried. The support for rollbacks means that if something goes wrong it&#x27;s trivial to switch back to an earlier revision.</p></section><hr/><div class="py-4"><a class="p-category" href="/blog/categories/php/"><span class="inline-block px-4 py-2 my-2 mr-2 text-sm font-bold text-gray-900 bg-purple-200 rounded-full hover:bg-purple-800 hover:text-gray-200 transition-colors duration-500">php</span></a><a class="p-category" href="/blog/categories/laravel/"><span class="inline-block px-4 py-2 my-2 mr-2 text-sm font-bold text-gray-900 bg-purple-200 rounded-full hover:bg-purple-800 hover:text-gray-200 transition-colors duration-500">laravel</span></a><a class="p-category" href="/blog/categories/deployment/"><span class="inline-block px-4 py-2 my-2 mr-2 text-sm font-bold text-gray-900 bg-purple-200 rounded-full hover:bg-purple-800 hover:text-gray-200 transition-colors duration-500">deployment</span></a></div><nav class="pt-4 clear-both box-border"><a rel="prev" class="float-left w-1/2 p-2 shadow-sm hover:bg-gray-200 dark:hover:bg-gray-800 transition duration-300 ease-in-out" href="/blog/2018/01/12/creating-a-caching-user-provider-for-laravel/"><p><strong class="font-bold clear-both">← Previous page</strong></p><p class="pl-6">Creating a caching user provider for Laravel</p></a><a rel="next" class="float-right w-1/2 p-2 shadow-sm hover:bg-gray-200 dark:hover:bg-gray-800 transition duration-300 ease-in-out" href="/blog/2018/01/28/why-the-speed-of-your-mvc-framework-is-usually-a-red-herring/"><p><strong>→ Next page</strong></p><p class="pl-6">Why the speed of your MVC framework is usually a red herring</p></a></nav><div id="disqus_thread"></div></article></main></div><footer class="w-full p-4 text-gray-100 bg-gray-800"><ul class="flex flex-row flex-wrap justify-center w-full p-2 mx-auto text-center md:w-2/3 box-border"><li class="w-1/3 my-2 md:w-1/6"><a href="/posts/1">Blog</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="/about">About</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="/contact">Contact</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="https://twitter.com/mattbd">Twitter</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="https://github.com/matthewbdaly">Github</a></li><li class="w-1/3 my-2 md:w-1/6"><a href="/rss.xml">Feed</a></li></ul><div class="w-full p-4 mx-auto text-center md:w-2/3"><p>© Matthew Daly <!-- -->2022</p></div></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-17043630-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2018/01/22/deploying-your-laravel-application-with-deployer/";window.___webpackCompilationHash="24a66320b98e19766621";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-11649d7082f91630a0f4.js"],"app":["/app-70d9172bf3fd43cbd65e.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-d99355bfc088afa60212.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-cd3c9aeb262d31f4738f.js"],"component---src-pages-search-tsx":["/component---src-pages-search-tsx-e93b9d2a4bf1d8518f68.js"],"component---src-templates-404-tsx":["/component---src-templates-404-tsx-dfb519f1975b2c946385.js"],"component---src-templates-archives-tsx":["/component---src-templates-archives-tsx-ad260b9de714fbd082c5.js"],"component---src-templates-categories-tsx":["/component---src-templates-categories-tsx-16c09be8d2349317ecb1.js"],"component---src-templates-category-tsx":["/component---src-templates-category-tsx-fe151db2072467694c26.js"],"component---src-templates-chunk-tsx":["/component---src-templates-chunk-tsx-0e1de4fb0a7a9892ad42.js"],"component---src-templates-page-tsx":["/component---src-templates-page-tsx-7ffb202f3f0ee82bb055.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-4d75edd4812735998de4.js"]};/*]]>*/</script><script src="/polyfill-11649d7082f91630a0f4.js" nomodule=""></script><script src="/app-70d9172bf3fd43cbd65e.js" async=""></script><script src="/framework-a6e7e2d9b047634414ab.js" async=""></script><script src="/webpack-runtime-899f909dad7c52bd5f43.js" async=""></script></body></html>