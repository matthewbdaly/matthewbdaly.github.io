<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e3adbc0bd75eaf448024.css" data-identity="gatsby-global-css">/*! tailwindcss v2.2.4 | MIT License | https://tailwindcss.com */

/*! modern-normalize v1.1.0 | MIT License | https://github.com/sindresorhus/modern-normalize */html{-webkit-text-size-adjust:100%;line-height:1.15;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;margin:0}hr{color:inherit;height:0}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=submit],button{-webkit-appearance:button}legend{padding:0}progress{vertical-align:baseline}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body{font-family:inherit;line-height:inherit}*,:after,:before{border:0 solid;box-sizing:border-box}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{color:inherit;line-height:inherit;padding:0}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}*,:after,:before{--tw-border-opacity:1;border-color:rgba(229,231,235,var(--tw-border-opacity))}.float-right{float:right}.float-left{float:left}.float-none{float:none}.clear-both{clear:both}.m-0{margin:0}.mx-0{margin-left:0;margin-right:0}.mx-auto{margin-left:auto;margin-right:auto}.my-2{margin-bottom:.5rem;margin-top:.5rem}.my-4{margin-bottom:1rem;margin-top:1rem}.mt-2{margin-top:.5rem}.mt-16{margin-top:4rem}.mr-2{margin-right:.5rem}.mr-8{margin-right:2rem}.-mb-4{margin-bottom:-1rem}.-mb-8{margin-bottom:-2rem}.box-border{box-sizing:border-box}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.table{display:table}.hidden{display:none}.h-2{height:.5rem}.h-4{height:1rem}.min-h-screen{min-height:100vh}.w-1\/2{width:50%}.w-1\/3{width:33.333333%}.w-1\/4{width:25%}.w-3\/4{width:75%}.w-full{width:100%}.flex-grow{flex-grow:1}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{opacity:0;transform:scale(2)}}@keyframes ping{75%,to{opacity:0;transform:scale(2)}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1);transform:translateY(-25%)}50%{-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1);transform:none}}@keyframes bounce{0%,to{-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1);transform:translateY(-25%)}50%{-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1);transform:none}}.list-disc{list-style-type:disc}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.justify-center{justify-content:center}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(2rem*var(--tw-space-y-reverse));margin-top:calc(2rem*(1 - var(--tw-space-y-reverse)))}.space-y-16>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(4rem*var(--tw-space-y-reverse));margin-top:calc(4rem*(1 - var(--tw-space-y-reverse)))}.space-y-32>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(8rem*var(--tw-space-y-reverse));margin-top:calc(8rem*(1 - var(--tw-space-y-reverse)))}.divide-y>:not([hidden])~:not([hidden]){--tw-divide-y-reverse:0;border-bottom-width:calc(1px*var(--tw-divide-y-reverse));border-top-width:calc(1px*(1 - var(--tw-divide-y-reverse)))}.divide-gray-800>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgba(31,41,55,var(--tw-divide-opacity))}@media (prefers-color-scheme:dark){.dark\:divide-gray-200>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgba(229,231,235,var(--tw-divide-opacity))}}.overflow-x-auto{overflow-x:auto}.overflow-x-scroll{overflow-x:scroll}.rounded-full{border-radius:9999px}.rounded-t-lg{border-top-left-radius:.5rem;border-top-right-radius:.5rem}.border-2{border-width:2px}.border-b-2{border-bottom-width:2px}.border-b-4{border-bottom-width:4px}.border-l-8{border-left-width:8px}.border-transparent{border-color:transparent}.border-gray-100{--tw-border-opacity:1;border-color:rgba(243,244,246,var(--tw-border-opacity))}.border-gray-500{--tw-border-opacity:1;border-color:rgba(107,114,128,var(--tw-border-opacity))}.border-gray-800{--tw-border-opacity:1;border-color:rgba(31,41,55,var(--tw-border-opacity))}.border-green-400,.hover\:border-green-400:hover{--tw-border-opacity:1;border-color:rgba(52,211,153,var(--tw-border-opacity))}.focus\:border-blue-300:focus{--tw-border-opacity:1;border-color:rgba(147,197,253,var(--tw-border-opacity))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgba(249,250,251,var(--tw-bg-opacity))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgba(243,244,246,var(--tw-bg-opacity))}.bg-gray-300{--tw-bg-opacity:1;background-color:rgba(209,213,219,var(--tw-bg-opacity))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgba(31,41,55,var(--tw-bg-opacity))}.bg-purple-200{--tw-bg-opacity:1;background-color:rgba(221,214,254,var(--tw-bg-opacity))}.hover\:bg-gray-200:hover{--tw-bg-opacity:1;background-color:rgba(229,231,235,var(--tw-bg-opacity))}.hover\:bg-purple-800:hover{--tw-bg-opacity:1;background-color:rgba(91,33,182,var(--tw-bg-opacity))}@media (prefers-color-scheme:dark){.dark\:bg-gray-700{--tw-bg-opacity:1;background-color:rgba(55,65,81,var(--tw-bg-opacity))}.dark\:bg-gray-800{--tw-bg-opacity:1;background-color:rgba(31,41,55,var(--tw-bg-opacity))}.dark\:bg-gray-900{--tw-bg-opacity:1;background-color:rgba(17,24,39,var(--tw-bg-opacity))}.dark\:hover\:bg-gray-800:hover{--tw-bg-opacity:1;background-color:rgba(31,41,55,var(--tw-bg-opacity))}}.bg-gradient-to-r{background-image:linear-gradient(to right,var(--tw-gradient-stops))}.bg-gradient-to-b{background-image:linear-gradient(to bottom,var(--tw-gradient-stops))}.from-gray-200{--tw-gradient-from:#e5e7eb;--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to,rgba(229,231,235,0))}.from-green-400{--tw-gradient-from:#34d399;--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to,rgba(52,211,153,0))}.via-blue-500{--tw-gradient-stops:var(--tw-gradient-from),#3b82f6,var(--tw-gradient-to,rgba(59,130,246,0))}.to-gray-300{--tw-gradient-to:#d1d5db}.to-purple-500{--tw-gradient-to:#8b5cf6}.p-2{padding:.5rem}.p-4{padding:1rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-4{padding-left:1rem;padding-right:1rem}.px-8{padding-left:2rem;padding-right:2rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.py-4{padding-bottom:1rem}.pt-4,.py-4{padding-top:1rem}.pb-16{padding-bottom:4rem}.pl-4{padding-left:1rem}.pl-6{padding-left:1.5rem}.text-center{text-align:center}.font-sans{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.text-sm{font-size:.875rem;line-height:1.25rem}.text-lg{font-size:1.125rem}.text-lg,.text-xl{line-height:1.75rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.font-semibold{font-weight:600}.font-bold{font-weight:700}.lowercase{text-transform:lowercase}.italic{font-style:italic}.leading-6{line-height:1.5rem}.text-gray-100{--tw-text-opacity:1;color:rgba(243,244,246,var(--tw-text-opacity))}.text-gray-200{--tw-text-opacity:1;color:rgba(229,231,235,var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgba(31,41,55,var(--tw-text-opacity))}.text-gray-900{--tw-text-opacity:1;color:rgba(17,24,39,var(--tw-text-opacity))}.hover\:text-gray-200:hover{--tw-text-opacity:1;color:rgba(229,231,235,var(--tw-text-opacity))}@media (prefers-color-scheme:dark){.dark\:text-gray-100{--tw-text-opacity:1;color:rgba(243,244,246,var(--tw-text-opacity))}.dark\:text-gray-200{--tw-text-opacity:1;color:rgba(229,231,235,var(--tw-text-opacity))}.dark\:text-gray-300{--tw-text-opacity:1;color:rgba(209,213,219,var(--tw-text-opacity))}}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}*,:after,:before{--tw-shadow:0 0 #0000}.shadow-sm{--tw-shadow:0 1px 2px 0 rgba(0,0,0,0.05)}.shadow-lg,.shadow-sm{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05)}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}*,:after,:before{--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000}.focus\:ring:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(3px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.filter{--tw-blur:var(--tw-empty,/*!*/ /*!*/);--tw-brightness:var(--tw-empty,/*!*/ /*!*/);--tw-contrast:var(--tw-empty,/*!*/ /*!*/);--tw-grayscale:var(--tw-empty,/*!*/ /*!*/);--tw-hue-rotate:var(--tw-empty,/*!*/ /*!*/);--tw-invert:var(--tw-empty,/*!*/ /*!*/);--tw-saturate:var(--tw-empty,/*!*/ /*!*/);--tw-sepia:var(--tw-empty,/*!*/ /*!*/);--tw-drop-shadow:var(--tw-empty,/*!*/ /*!*/);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition{transition-duration:.15s;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-colors{transition-duration:.15s;transition-property:background-color,border-color,color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-300{transition-duration:.3s}.duration-500{transition-duration:.5s}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}code[class*=language-],pre[class*=language-]{display:block}@media (min-width:768px){.md\:float-none{float:none}.md\:block{display:block}.md\:w-2\/3{width:66.666667%}.md\:w-1\/5{width:20%}}@media (min-width:1024px){.lg\:float-right{float:right}.lg\:float-left{float:left}.lg\:mt-4{margin-top:1rem}.lg\:text-left{text-align:left}}.prism-code{-webkit-overflow-scrolling:touch;background-color:transparent;border-radius:.2em;float:left;font-size:1rem;margin-bottom:1rem;margin-top:1rem;overflow:initial;padding-bottom:1rem;padding-top:1rem;position:relative}.prism-code.title{border-radius:0 0 .2em .2em}pre.prism-code{float:left;min-width:100%;overflow:initial;padding:20px}.token{display:inline-block}li>code,p>code{word-wrap:break-word;background:#011627;border-radius:.2em;color:#d6deeb;padding:.2em;white-space:pre-wrap}.gatsby-highlight{-webkit-overflow-scrolling:touch;font-size:1rem;overflow:auto;position:relative}.gatsby-highlight::-webkit-scrollbar{display:none}.gatsby-highlight>code[class*=language-],.gatsby>pre[class*=language-]{-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;overflow-wrap:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-break:normal;word-spacing:normal}.gatsby-highlight .token-line{border-left:4px solid transparent;margin-left:-20px;margin-right:-20px}.line-number-style{display:inline-block;opacity:.3;padding-left:1em;padding-right:2em;position:relative;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1.2em}.gatsby-highlight .token-line.highlight-line{background-color:#023751;border-left:4px solid #029bce}.gatsby-highlight .token-line.highlight-line .line-number-style{left:0;opacity:.5;width:calc(1.2em - 4px)}</style><meta name="generator" content="Gatsby 3.8.0"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="search" type="application/opensearchdescription+xml" crossorigin="anonymous" href="/opensearch.xml"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><title data-react-helmet="true">Building a URL shortener with Node.js and Redis | Matthew Daly</title><link data-react-helmet="true" href="https://matthewdaly.co.uk" rel="canonical"/><link data-react-helmet="true" href="https://twitter.com/mattbd" rel="me"/><link data-react-helmet="true" href="https://github.com/matthewbdaly" rel="me"/><link data-react-helmet="true" href="mailto:matthew@matthewdaly.co.uk" rel="me"/><link data-react-helmet="true" href="/key.pub" rel="pgpkey"/><link data-react-helmet="true" href="https://webmention.io/matthewdaly.co.uk/xmlrpc" rel="pingback"/><link data-react-helmet="true" href="https://webmention.io/matthewdaly.co.uk/webmention" rel="webmention"/><link data-react-helmet="true" rel="authorization_endpoint" href="https://indieauth.com/auth"/><link data-react-helmet="true" rel="token_endpoint" href="https://tokens.indieauth.com/token"/><link data-react-helmet="true" rel="openid.delegate" href="https://matthewdaly.co.uk"/><link data-react-helmet="true" rel="openid.server" href="https://openid.indieauth.com/openid"/><link data-react-helmet="true" rel="alternate" type="application/rss+xml" title="Matthew Daly - feed" href="/rss.xml"/><link data-react-helmet="true" rel="alternate" type="application/atom+xml" title="Matthew Daly - feed" href="/atom.xml"/><link data-react-helmet="true" rel="alternate" type="application/feed+json" title="Matthew Daly - feed" href="/feed.json"/><meta data-react-helmet="true" name="description" content="The NoSQL movement is an exciting one for web developers. While relational databases such as MySQL are applicable to solving a wide range of problems, they aren&#x27;t the best solution…"/><meta data-react-helmet="true" property="og:title" content="Building a URL shortener with Node.js and Redis"/><meta data-react-helmet="true" property="og:description" content="The NoSQL movement is an exciting one for web developers. While relational databases such as MySQL are applicable to solving a wide range of problems, they aren&#x27;t the best solution…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="mattbd"/><meta data-react-helmet="true" name="twitter:title" content="Building a URL shortener with Node.js and Redis"/><meta data-react-helmet="true" name="twitter:description" content="The NoSQL movement is an exciting one for web developers. While relational databases such as MySQL are applicable to solving a wide range of problems, they aren&#x27;t the best solution…"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link rel="icon" href="/favicon-32x32.png?v=53aa06cf17e4239d0dba6ffd09854e02" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#3b82f6"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=53aa06cf17e4239d0dba6ffd09854e02"/><link as="script" rel="preload" href="/webpack-runtime-88d477ac36829d76e952.js"/><link as="script" rel="preload" href="/framework-cb6229a8adb5817307a4.js"/><link as="script" rel="preload" href="/532a2f07-672258f0b4da4ed2ff53.js"/><link as="script" rel="preload" href="/app-5e95bfecb5da57fd1ffa.js"/><link as="script" rel="preload" href="/f0e45107-763177929e8eed3c13bb.js"/><link as="script" rel="preload" href="/e87769ff526c098a69bffbfff9ee9d57397fcb93-49d3f7242fa2c053e36d.js"/><link as="script" rel="preload" href="/15a3be27178e285ff113e12c60c30466a8f4d4c5-26cc17c8e4fe76c4927b.js"/><link as="script" rel="preload" href="/7840d69eefded84ab93ff6e879351e9a3a16821f-3cc77dc4aa7437d407dd.js"/><link as="script" rel="preload" href="/component---src-templates-post-tsx-493c03ff50c97c3525f1.js"/><link as="fetch" rel="preload" href="/page-data/blog/2014/11/09/building-a-url-shortener-with-node-dot-js-and-redis/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/290055352.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2909664151.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="flex flex-col min-h-screen font-sans text-lg antialiased text-gray-800 bg-gray-50 dark:text-gray-100 dark:bg-gray-700 leading-6 pb-16"><div class="w-full h-2 bg-gradient-to-r from-green-400 via-blue-500 to-purple-500"></div><nav class="w-full p-4 mx-auto lowercase md:w-2/3"><h1 class="block float-none py-4 text-4xl text-center lg:float-left lg:text-left"><a href="/">Matthew Daly</a></h1><ul class="py-2 text-center lg:float-right md:block lg:text-left"><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/blog/archives">Archives</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/about">About</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/uses">Uses</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/posts/1">Blog</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/blog/categories">Categories</a></li><li class="inline-block pr py-2 mr-8 lg:mt-4 text-sm text-gray-900 dark:text-gray-200 border-b-4 border-transparent hover:border-green-400 transition-colors duration-500"><a href="/search">Search</a></li></ul></nav><div class="w-full h-4 clear"></div><main class="flex-grow w-full p-4 mx-auto md:w-2/3"><article class="h-entry"><header><h2 class="py-4 text-2xl font-bold e-content p-name"><a class="u-url" href="https://matthewdaly.co.uk/blog/2014/11/09/building-a-url-shortener-with-node-dot-js-and-redis/">Building a URL shortener with Node.js and Redis</a></h2><p class="my-4 text-lg font-semibold">Published by <a href="/" rel="author">Matthew Daly</a> at <!-- -->9th November 2014 5:13 pm</p><time class="hidden dt-published">2014-11-09T17:13:16+00:00</time></header><section><p class="py-2">The NoSQL movement is an exciting one for web developers. While relational databases such as MySQL are applicable to solving a wide range of problems, they aren&#x27;t the best solution for every problem. Sometimes you may find yourself dealing with a problem where an alternative data store may make more sense.</p><p class="py-2">Redis is one of the data stores that have appeared as part of this movement, and is arguably one of the more generally useful ones. Since it solves different problems to a relational database, it&#x27;s not generally useful as an alternative to them - instead it is often used alongside them.</p><h2 class="py-4 text-2xl font-bold">What is Redis?</h2><p class="py-2">Redis is described as follows on the website:</p><blockquote class="pl-4 italic text-gray-200 text-gray-900 bg-gray-100 border-l-8 border-gray-500 dark:text-gray-300 dark:bg-gray-800"><p class="py-2">&quot;Redis is an open source, BSD licensed, advanced key-value cache and store. It is often referred to as a data structure server since keys can contain strings, hashes, lists, sets, sorted sets, bitmaps and hyperloglogs&quot;.</p></blockquote><p class="py-2">In other words, its core functionality is that it allows you to store a value by a key, and later retrieve that data using the key. It also allows you to set an optional expiry time for that key-value pair. It&#x27;s quite similar to Memcached in that respect, and indeed one obvious use case for Redis is as an alternative to Memcached. However, it offers a number of additional benefits - for one thing, it supports more data types, and for another, it allows you to persist your data to disk (unlike Memcached, which only retains the data in memory, meaning it&#x27;s lost on restart or if Memcached crashes). The latter means that for some very simple web applications, Redis can be used as your sole data store.</p><p class="py-2">In this tutorial, we&#x27;ll build a simple URL shortener, using Redis as the sole data store. A URL shortener only really requires two fields:</p><ul class="py-2 pl-4"><li class="list-disc">A string to identify the correct URL</li><li class="list-disc">The URL</li></ul><p class="py-2">That makes Redis a good fit for this use case since all we need to do is generate an ID for each URL, then when a link is followed, look up the URL for that key, and redirect the user to it. As long as this is all our application needs to do, we can quite happily use Redis for this rather than a relational database, and it will be significantly faster than a relational database would be for this use case.</p><h2 class="py-4 text-2xl font-bold">Getting started</h2><p class="py-2">We&#x27;re more interested in the fundamentals of using Redis in our application than a specific language here. As JavaScript is pretty much required to be a web developer, I think it&#x27;s a fairly safe bet to use Node.js rather than PHP or Python, since that way, even if your only experience of JavaScript is client-side, you shouldn&#x27;t have too much trouble following along.</p><p class="py-2">You&#x27;ll need to have Node.js installed, and I&#x27;ll leave the details of installing this to you. You&#x27;ll also need the Grunt CLI - install this globally as follows:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">sudo</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">install</span><span class="token plain"> -g grunt-cli</span></div></pre></div></pre><p class="py-2">Finally, you&#x27;ll want to have Redis itself installed. You might also want to install hiredis, which is a faster Redis client that gets used automatically where available.</p><p class="py-2">Now, let&#x27;s create our <code>package.json</code> file:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> init</span></div></pre></div></pre><p class="py-2">You&#x27;ll see a number of questions. Your generated <code>package.json</code> file should look something like this:</p><pre><div class="gatsby-highlight" data-language="json"><pre class="prism-code language-json" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">  </span><span class="token property" style="color:#5a9bcf">&quot;name&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;url-shortener&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">  </span><span class="token property" style="color:#5a9bcf">&quot;version&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;1.0.0&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">  </span><span class="token property" style="color:#5a9bcf">&quot;description&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;A URL shortener&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">  </span><span class="token property" style="color:#5a9bcf">&quot;main&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;index.js&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">  </span><span class="token property" style="color:#5a9bcf">&quot;scripts&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">&quot;test&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;grunt test&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">  </span><span class="token property" style="color:#5a9bcf">&quot;keywords&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;URL&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;shortener&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">  </span><span class="token property" style="color:#5a9bcf">&quot;author&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Matthew Daly &lt;matthew@matthewdaly.co.uk&gt; (http://matthewdaly.co.uk/)&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">  </span><span class="token property" style="color:#5a9bcf">&quot;license&quot;</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;GPLv2&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Note in particular that we set our test command to <code>grunt test</code>.</p><p class="py-2">Next, we install our required Node.js modules. First, install, the normal dependencies:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">install</span><span class="token plain"> --save body-parser express redis hiredis jade shortid</span></div></pre></div></pre><p class="py-2">Next, install the development dependencies:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">npm</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">install</span><span class="token plain"> --save-dev grunt grunt-contrib-jshint grunt-mocha-istanbul istanbul mocha chai request</span></div></pre></div></pre><p class="py-2">Now, we&#x27;re going to use Grunt to run our tests, so that we can easily lint the JavaScript and generate code coverage details. Here&#x27;s the Gruntfile:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">module</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method-variable function-variable method function property-access" style="color:#79b6f2">exports</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">grunt</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">    </span><span class="token string" style="color:#8dc891">&#x27;use strict&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">    grunt</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">initConfig</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">        jshint</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">            all</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">                </span><span class="token string" style="color:#8dc891">&#x27;test/*.js&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">                </span><span class="token string" style="color:#8dc891">&#x27;index.js&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">        mocha_istanbul</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">            coverage</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">                src</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;test&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// the folder, not the files,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">                options</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">                    mask</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;*.js&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">                    reportFormats</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&#x27;cobertura&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;html&#x27;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">                </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">    </span><span class="token operator" style="color:#d7deea">/</span><span class="token operator" style="color:#d7deea">/</span><span class="token plain"> </span><span class="token maybe-class-name">Load</span><span class="token plain"> tasks</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">    grunt</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">loadNpmTasks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;grunt-contrib-jshint&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">    grunt</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">loadNpmTasks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;grunt-mocha-istanbul&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">    </span><span class="token operator" style="color:#d7deea">/</span><span class="token operator" style="color:#d7deea">/</span><span class="token plain"> </span><span class="token maybe-class-name">Register</span><span class="token plain"> tasks</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">    grunt</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">registerTask</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;test&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&#x27;jshint&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;mocha_istanbul:coverage&#x27;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">We&#x27;ll also create a <code>Procfile</code> in anticipation of deploying the app to Heroku:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">web: node index.js</span></div></pre></div></pre><h2 class="py-4 text-2xl font-bold">Creating the views</h2><p class="py-2">For this application we&#x27;ll be using the Express framework and the Jade templating system. We need three templates:</p><ul class="py-2 pl-4"><li class="list-disc">Submission form</li><li class="list-disc">Output form</li><li class="list-disc">404 page</li></ul><p class="py-2">Create the folder <code>views</code> under the application directory and add the files <code>views/index.jade</code>:</p><pre><div class="gatsby-highlight" data-language="pug"><pre class="prism-code language-pug" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token doctype" style="color:#999999">doctype html</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain"></span><span class="token tag" style="color:#fc929e">html</span><span class="token tag attributes punctuation" style="color:#8dc891">(</span><span class="token tag attributes attr-name" style="color:#c5a5c5">lang</span><span class="token tag attributes punctuation" style="color:#8dc891">=</span><span class="token tag attributes attr-value string" style="color:#8dc891">&quot;en&quot;</span><span class="token tag attributes punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token tag" style="color:#fc929e">head</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">        </span><span class="token tag" style="color:#fc929e">title</span><span class="token punctuation" style="color:#8dc891">=</span><span class="token code string" style="color:#8dc891">&quot;Shortbread&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">    </span><span class="token tag" style="color:#fc929e">body</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">        </span><span class="token tag" style="color:#fc929e">div</span><span class="token tag attr-class" style="color:#fc929e">.container</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">            </span><span class="token tag" style="color:#fc929e">div</span><span class="token tag attr-class" style="color:#fc929e">.row</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">                </span><span class="token tag" style="color:#fc929e">h1</span><span class="token plain"> </span><span class="token plain-text">Shortbread</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">            </span><span class="token tag" style="color:#fc929e">div</span><span class="token tag attr-class" style="color:#fc929e">.row</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">                </span><span class="token tag" style="color:#fc929e">form</span><span class="token tag attributes punctuation" style="color:#8dc891">(</span><span class="token tag attributes attr-name" style="color:#c5a5c5">action</span><span class="token tag attributes punctuation" style="color:#8dc891">=</span><span class="token tag attributes attr-value string" style="color:#8dc891">&quot;/&quot;</span><span class="token tag attributes punctuation" style="color:#8dc891">,</span><span class="token tag attributes" style="color:#fc929e"> </span><span class="token tag attributes attr-name" style="color:#c5a5c5">method</span><span class="token tag attributes punctuation" style="color:#8dc891">=</span><span class="token tag attributes attr-value string" style="color:#8dc891">&quot;POST&quot;</span><span class="token tag attributes punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">                    </span><span class="token tag" style="color:#fc929e">input</span><span class="token tag attributes punctuation" style="color:#8dc891">(</span><span class="token tag attributes attr-name" style="color:#c5a5c5">type</span><span class="token tag attributes punctuation" style="color:#8dc891">=</span><span class="token tag attributes attr-value string" style="color:#8dc891">&quot;url&quot;</span><span class="token tag attributes punctuation" style="color:#8dc891">,</span><span class="token tag attributes" style="color:#fc929e"> </span><span class="token tag attributes attr-name" style="color:#c5a5c5">name</span><span class="token tag attributes punctuation" style="color:#8dc891">=</span><span class="token tag attributes attr-value string" style="color:#8dc891">&quot;url&quot;</span><span class="token tag attributes punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">                    </span><span class="token tag" style="color:#fc929e">input</span><span class="token tag attributes punctuation" style="color:#8dc891">(</span><span class="token tag attributes attr-name" style="color:#c5a5c5">type</span><span class="token tag attributes punctuation" style="color:#8dc891">=</span><span class="token tag attributes attr-value string" style="color:#8dc891">&quot;submit&quot;</span><span class="token tag attributes punctuation" style="color:#8dc891">,</span><span class="token tag attributes" style="color:#fc929e"> </span><span class="token tag attributes attr-name" style="color:#c5a5c5">value</span><span class="token tag attributes punctuation" style="color:#8dc891">=</span><span class="token tag attributes attr-value string" style="color:#8dc891">&quot;Submit&quot;</span><span class="token tag attributes punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Also <code>views/output.jade</code>:</p><pre><div class="gatsby-highlight" data-language="pug"><pre class="prism-code language-pug" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token doctype" style="color:#999999">doctype html</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain"></span><span class="token tag" style="color:#fc929e">html</span><span class="token tag attributes punctuation" style="color:#8dc891">(</span><span class="token tag attributes attr-name" style="color:#c5a5c5">lang</span><span class="token tag attributes punctuation" style="color:#8dc891">=</span><span class="token tag attributes attr-value string" style="color:#8dc891">&quot;en&quot;</span><span class="token tag attributes punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token tag" style="color:#fc929e">head</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">        </span><span class="token tag" style="color:#fc929e">title</span><span class="token punctuation" style="color:#8dc891">=</span><span class="token code maybe-class-name">Shortbread</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">    </span><span class="token tag" style="color:#fc929e">body</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">        </span><span class="token tag" style="color:#fc929e">div</span><span class="token tag attr-class" style="color:#fc929e">.container</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">            </span><span class="token tag" style="color:#fc929e">div</span><span class="token tag attr-class" style="color:#fc929e">.row</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">                </span><span class="token tag" style="color:#fc929e">h1</span><span class="token plain"> </span><span class="token plain-text">Shortbread</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">                </span><span class="token tag" style="color:#fc929e">p</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">|</span><span class="token plain"> Your shortened URL is</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">                    </span><span class="token tag" style="color:#fc929e">a</span><span class="token tag attributes punctuation" style="color:#8dc891">(</span><span class="token tag attributes attr-name" style="color:#c5a5c5">href</span><span class="token tag attributes punctuation" style="color:#8dc891">=</span><span class="token tag attributes attr-value" style="color:#8dc891">base_url</span><span class="token tag attributes attr-value operator" style="color:#d7deea">+</span><span class="token tag attributes attr-value string" style="color:#8dc891">&#x27;/&#x27;</span><span class="token tag attributes attr-value operator" style="color:#d7deea">+</span><span class="token tag attributes attr-value" style="color:#8dc891">id</span><span class="token tag attributes punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token plain-text">#{base_url}/#{id}</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">and <code>views/error.jade</code>:</p><pre><div class="gatsby-highlight" data-language="pug"><pre class="prism-code language-pug" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token doctype" style="color:#999999">doctype html</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain"></span><span class="token tag" style="color:#fc929e">html</span><span class="token tag attributes punctuation" style="color:#8dc891">(</span><span class="token tag attributes attr-name" style="color:#c5a5c5">lang</span><span class="token tag attributes punctuation" style="color:#8dc891">=</span><span class="token tag attributes attr-value string" style="color:#8dc891">&quot;en&quot;</span><span class="token tag attributes punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token tag" style="color:#fc929e">head</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">        </span><span class="token tag" style="color:#fc929e">title</span><span class="token punctuation" style="color:#8dc891">=</span><span class="token code string" style="color:#8dc891">&quot;Shortbread&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">    </span><span class="token tag" style="color:#fc929e">body</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">        </span><span class="token tag" style="color:#fc929e">div</span><span class="token tag attr-class" style="color:#fc929e">.container</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">            </span><span class="token tag" style="color:#fc929e">div</span><span class="token tag attr-class" style="color:#fc929e">.row</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">                </span><span class="token tag" style="color:#fc929e">h1</span><span class="token plain"> </span><span class="token plain-text">Shortbread</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">                </span><span class="token tag" style="color:#fc929e">p</span><span class="token plain"> </span><span class="token plain-text">Link not found</span><span class="token plain"></span></div></pre></div></pre><h2 class="py-4 text-2xl font-bold">Writing our first test</h2><p class="py-2">We&#x27;re going to use Mocha for our tests, together with the Chai assertion library. Create a folder called <code>test</code>, and put the following in <code>test/test.js</code>:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">/*jslint node: true */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain"></span><span class="token comment" style="color:#999999">/*global describe: false, before: false, after: false, it: false */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain"></span><span class="token string" style="color:#8dc891">&quot;use strict&quot;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Declare the variables used</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> expect </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;chai&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">expect</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">    request </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;request&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">    server </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;../index&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">    redis </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;redis&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">    client</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">client </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> redis</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">createClient</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Server tasks</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain"></span><span class="token function" style="color:#79b6f2">describe</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;server&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Beforehand, start the server</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">    </span><span class="token function" style="color:#79b6f2">before</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">done</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">        </span><span class="token console class-name" style="color:#FAC863">console</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">log</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Starting the server&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">        </span><span class="token function" style="color:#79b6f2">done</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Afterwards, stop the server and empty the database</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">    </span><span class="token function" style="color:#79b6f2">after</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">done</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">        </span><span class="token console class-name" style="color:#FAC863">console</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">log</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Stopping the server&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">        client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">flushdb</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">        </span><span class="token function" style="color:#79b6f2">done</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Test the index route</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">    </span><span class="token function" style="color:#79b6f2">describe</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Test the index route&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">        </span><span class="token function" style="color:#79b6f2">it</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;should return a page with the title Shortbread&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">done</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">            request</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> url</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> response</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain">                </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">include</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Shortbread&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">                </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">statusCode</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain">                </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">headers</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&#x27;content-type&#x27;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;text/html; charset=utf-8&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain">                </span><span class="token function" style="color:#79b6f2">done</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">This code bears a little explanation. First, we import the required modules, as well as our <code>index.js</code> file (which we have yet to add). Then we create a callback to contain our tests.</p><p class="py-2">Inside the callback, we call the <code>before()</code> and <code>after()</code> functions, which let us set up and tear down our tests. As part of the teardown process, we flush the Redis database.</p><p class="py-2">Finally, we fetch our home page and verify that it returns a 200 status code and a content type of text/html, as well as including the name or our application.</p><p class="py-2">We&#x27;ll need to create our <code>index.js</code> file to avoid a nasty error, but we won&#x27;t populate it just yet:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style"></span><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">touch</span><span class="token plain"> index.js</span></div></pre></div></pre><p class="py-2">Let&#x27;s run our tests:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ grunt </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint:all&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">jshint</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> files lint free.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">mocha_istanbul</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">  server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">Starting the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">    Test the index route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">      </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the title Shortbread</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">Stopping the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain"> passing </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">152ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> failing</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> server Test the index route should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the title Shortbread:</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">     Uncaught AssertionError: expected undefined to include </span><span class="token string" style="color:#8dc891">&#x27;Shortbread&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">      at Request._callback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/test/test.js:33:33</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">      at self.callback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:372:22</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">      at Request.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:95:17</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">      at Request.onRequestError </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:963:8</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">      at ClientRequest.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:95:17</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">      at Socket.socketErrorListener </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">http.js:1551:9</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">      at Socket.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:95:17</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">      at net.js:440:14</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">      at process._tickCallback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">node.js:419:13</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain">Writing coverage object </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/coverage/coverage.json</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">Writing coverage reports at </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/coverage</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> Coverage summary </span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token plain">Statements   </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain">/0 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token plain">Branches     </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain">/0 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token plain">Functions    </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain">/0 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token plain">Lines        </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain">/0 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token plain">Warning: Task </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> failed. Use --force to continue.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token plain">Aborted due to warnings.</span></div></pre></div></pre><p class="py-2">Now that we have a failing test, we can start work on our app proper. Open up <code>index.js</code> and add the following code:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">/*jslint node: true */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain"></span><span class="token string" style="color:#8dc891">&#x27;use strict&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Declare variables used</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> app</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> base_url</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> bodyParser</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> client</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> express</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> rtg</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> shortid</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Define values</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">express </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;express&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">app </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">express</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">port </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">PORT</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">||</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">5000</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">shortid </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;shortid&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">bodyParser </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;body-parser&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">base_url </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">BASE_URL</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">||</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Set up connection to Redis</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain"></span><span class="token keyword control-flow" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">REDISTOGO_URL</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">  rtg  </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;url&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">parse</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">REDISTOGO_URL</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">  client </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;redis&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">createClient</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">port</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">hostname</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">  client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">auth</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">auth</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">split</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;:&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#c5a5c5">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">  client </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;redis&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">createClient</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Set up templating</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">set</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;views&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> __dirname </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;/views&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">set</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;view engine&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;jade&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">engine</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;jade&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;jade&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">__express</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Set URL</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">set</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;base_url&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> base_url</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Handle POST data</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">use</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">bodyParser</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">json</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">use</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">bodyParser</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">urlencoded</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain">  extended</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">true</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Define index route</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;/&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token plain">  res</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">render</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;index&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Serve static files</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">use</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">express</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">static</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">__dirname </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;/static&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token plain"></span><span class="token comment" style="color:#999999">// Listen</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">47</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">listen</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">port</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">48</span><span class="token plain"></span><span class="token console class-name" style="color:#FAC863">console</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">log</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Listening on port &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> port</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Let&#x27;s go through this code. First we confirm that linting tools should treat this as a Node app, and use strict mode (I recommend always using strict mode in JavaScript).</p><p class="py-2">Then we declare our variables and import the required modules. Note here that we set the port to 5000, but can also set it based on the <code>PORT</code> environment variable, which is used by Heroku. We also define a base URL, which again can be overriden from an environment variable when hosted on Heroku.</p><p class="py-2">We then set up our connection to our Redis instance. When we push the code up to Heroku, we&#x27;ll use the Redis To Go addon, so we check for an environment variable containing the Redis URL. If it&#x27;s set, we use that to connect. Otherwise, we just connect as normal.</p><p class="py-2">We then set up templating using Jade, and define the folder containing our views, and store the base URL within the app. Then we set up <code>bodyParser</code> so that Express can handle POST data.</p><p class="py-2">Next, we define our index route to just render the <code>index.jade</code> file. Finally, we set up our static folder and set the app to listen on the correct port.</p><p class="py-2">Let&#x27;s run our test:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ grunt </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint:all&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">jshint</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> files lint free.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">mocha_istanbul</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Listening on port </span><span class="token number" style="color:#5a9bcf">5000</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">  server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">Starting the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">    Test the index route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the title Shortbread </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">116ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">Stopping the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> passing </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">128ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">Writing coverage object </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/coverage/coverage.json</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">Writing coverage reports at </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/coverage</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> Coverage summary </span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">Statements   </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">86.96</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">20</span><span class="token plain">/23 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">Branches     </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">83.33</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">5</span><span class="token plain">/6 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">Functions    </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain">/1 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">Lines        </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">86.96</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">20</span><span class="token plain">/23 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Done. Check coverage folder.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">Done, without errors.</span></div></pre></div></pre><p class="py-2">Note that Istanbul will have generated a nice HTML coverage report, which will be at <code>coverage/index.html</code>, but this won&#x27;t show 100% test coverage due to the Heroku-specific Redis section. To fix this, amend that section as follows:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">/* istanbul ignore if */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain"></span><span class="token keyword control-flow" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">REDISTOGO_URL</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    rtg  </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;url&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">parse</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">REDISTOGO_URL</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">    client </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;redis&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">createClient</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">port</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">hostname</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">    client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">auth</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">rtg</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">auth</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">split</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;:&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#c5a5c5">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">    client </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">require</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;redis&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">createClient</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">Telling Istanbul to ignore the if clause resolves that problem nicely.</p><h2 class="py-4 text-2xl font-bold">Submitting a URL</h2><p class="py-2">Next, let&#x27;s add the ability to add a URL. First, add the following test, after the one for the index:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Test submitting a URL</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">    </span><span class="token function" style="color:#79b6f2">describe</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Test submitting a URL&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token function" style="color:#79b6f2">it</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;should return the shortened URL&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">done</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">            request</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">post</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain">form</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain">url</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://www.google.co.uk&#x27;</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> response</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">                </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">include</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Your shortened URL is&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">                </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">statusCode</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">                </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">headers</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&#x27;content-type&#x27;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;text/html; charset=utf-8&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">                </span><span class="token function" style="color:#79b6f2">done</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">This test submits a URL via POST, and checks to see that the response view gets returned. Now, let&#x27;s run our tests again:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ grunt </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint:all&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">jshint</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> files lint free.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">mocha_istanbul</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Listening on port </span><span class="token number" style="color:#5a9bcf">5000</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">  server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">Starting the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">    Test the index route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the title Shortbread </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">223ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">    Test submitting a URL</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">      </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> the shortened URL</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">Stopping the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> passing </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">318ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> failing</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> server Test submitting a URL should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> the shortened URL:</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">     Uncaught AssertionError: expected </span><span class="token string" style="color:#8dc891">&#x27;Cannot POST /</span><span class="token string entity" style="color:#d7deea">\n</span><span class="token string" style="color:#8dc891">&#x27;</span><span class="token plain"> to include </span><span class="token string" style="color:#8dc891">&#x27;Your shortened URL is&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">      at Request._callback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/test/test.js:45:33</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">      at Request.self.callback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:372:22</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">      at Request.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:98:17</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">      at Request.</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token plain">anonymous</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:1310:14</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">      at Request.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:117:20</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">      at IncomingMessage.</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token plain">anonymous</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:1258:12</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">      at IncomingMessage.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:117:20</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">      at _stream_readable.js:943:16</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">      at process._tickCallback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">node.js:419:13</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain">Writing coverage object </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/coverage/coverage.json</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain">Writing coverage reports at </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/coverage</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> Coverage summary </span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token plain">Statements   </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">23</span><span class="token plain">/23 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token plain">Branches     </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain">/6 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token plain">Functions    </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain">/1 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token plain">Lines        </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">23</span><span class="token plain">/23 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">47</span><span class="token plain">Warning: Task </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> failed. Use --force to continue.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">48</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">49</span><span class="token plain">Aborted due to warnings.</span></div></pre></div></pre><p class="py-2">We have a failing test, so let&#x27;s make it pass. Add the following route after the index one:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">// Define submit route</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">post</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;/&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Declare variables</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> url</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Get URL</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">    url </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> req</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">url</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Create a hashed short version</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">    id </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> shortid</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">generate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Store them in Redis</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">    client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">set</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> url</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">        </span><span class="token comment" style="color:#999999">// Display the response</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">        res</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">render</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;output&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> id</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> id</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> base_url</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> base_url </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">This route is fairly simple. It handles POST requests to the index route, and first of all it gets the URL from the POST request. Then it randomly generates a hash to use as the key.</p><p class="py-2">The next part is where we see Redis in action. We create a new key-value pair, with the key set to the newly generated ID, and the value set to the URL. Once Redis confirms that has been done, the callback is fired, which renders the <code>output.jade</code> view with the ID and base URL passed through, so that we can see our shortened URL.</p><p class="py-2">With that done, our test should pass:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ grunt </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint:all&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">jshint</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> files lint free.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">mocha_istanbul</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Listening on port </span><span class="token number" style="color:#5a9bcf">5000</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">  server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">Starting the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">    Test the index route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the title Shortbread </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">89ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">    Test submitting a URL</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> the shortened URL </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">65ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">Stopping the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> passing </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">167ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">Writing coverage object </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/coverage/coverage.json</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">Writing coverage reports at </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/coverage</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> Coverage summary </span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">Statements   </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">29</span><span class="token plain">/29 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">Branches     </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain">/6 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">Functions    </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain">/3 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">Lines        </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">29</span><span class="token plain">/29 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Done. Check coverage folder.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain">Done, without errors.</span></div></pre></div></pre><p class="py-2">Our final task is to implement the short URL handling. We want to check to see if a short URL exists. If it does, we redirect the user to the destination. If it doesn&#x27;t, we raise a 404 error. For that we need two more tests. Here they are:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Test following a URL</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token function" style="color:#79b6f2">describe</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Test following a URL&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">        </span><span class="token function" style="color:#79b6f2">it</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;should redirect the user to the shortened URL&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">done</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">            </span><span class="token comment" style="color:#999999">// Create the URL</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">            client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">set</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;testurl&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://www.google.com&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">                </span><span class="token comment" style="color:#999999">// Follow the link</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">                request</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">                    url</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000/testurl&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">                    followRedirect</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">false</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">                </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> response</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">headers</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">location</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;http://www.google.com&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">statusCode</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">301</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">                    </span><span class="token function" style="color:#79b6f2">done</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">                </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Test non-existent link</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain">    </span><span class="token function" style="color:#79b6f2">describe</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Test following a non-existent-link&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">        </span><span class="token function" style="color:#79b6f2">it</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;should return a 404 error&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">done</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">            </span><span class="token comment" style="color:#999999">// Follow the link</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain">            request</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">                url</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:5000/nonexistenturl&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">                followRedirect</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">false</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> response</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">                </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">statusCode</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">404</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">                </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">include</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Link not found&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">                </span><span class="token function" style="color:#79b6f2">done</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">The first test creates a URL for testing purposes. It then navigates to that URL. Note that we set <code>followRedirect</code> to <code>true</code> - this is because, by default, <code>request</code> will follow any redirect, so we need to prevent it from doing so to ensure that the headers to redirect the user are set correctly.</p><p class="py-2">Once the response has been received, we then check that the status code is 301 (Moved Permanently), and that the <code>Location</code> header is set to the correct destination. When a real browser visits this page, it will be redirected accordingly.</p><p class="py-2">The second test tries to fetch a non-existent URL, and checks that the status code is 404, and the response contains the words <code>Link not found</code>.</p><p class="py-2">If we run our tests, they should now fail:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ grunt </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint:all&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">jshint</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> files lint free.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">mocha_istanbul</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Listening on port </span><span class="token number" style="color:#5a9bcf">5000</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">  server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">Starting the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">    Test the index route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the title Shortbread </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">252ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">    Test submitting a URL</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> the shortened URL </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">47ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">    Test following a URL</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">      </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> should redirect the user to the shortened URL</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">    Test following a non-existent-link</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">      </span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a </span><span class="token number" style="color:#5a9bcf">404</span><span class="token plain"> error</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">Stopping the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> passing </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">322ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> failing</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> server Test following a URL should redirect the user to the shortened URL:</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">     Uncaught AssertionError: expected undefined to equal </span><span class="token string" style="color:#8dc891">&#x27;http://www.google.com&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain">      at Request._callback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/test/test.js:63:58</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain">      at Request.self.callback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:372:22</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain">      at Request.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:98:17</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">      at Request.</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token plain">anonymous</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:1310:14</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">      at Request.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:117:20</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">      at IncomingMessage.</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token plain">anonymous</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:1258:12</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain">      at IncomingMessage.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:117:20</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain">      at _stream_readable.js:943:16</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain">      at process._tickCallback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">node.js:419:13</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> server Test following a non-existent-link should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a </span><span class="token number" style="color:#5a9bcf">404</span><span class="token plain"> error:</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">38</span><span class="token plain">     Uncaught AssertionError: expected </span><span class="token string" style="color:#8dc891">&#x27;Cannot GET /nonexistenturl</span><span class="token string entity" style="color:#d7deea">\n</span><span class="token string" style="color:#8dc891">&#x27;</span><span class="token plain"> to include </span><span class="token string" style="color:#8dc891">&#x27;Link not found&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">39</span><span class="token plain">      at Request._callback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/test/test.js:80:33</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">40</span><span class="token plain">      at Request.self.callback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:372:22</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">41</span><span class="token plain">      at Request.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:98:17</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">42</span><span class="token plain">      at Request.</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token plain">anonymous</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:1310:14</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">43</span><span class="token plain">      at Request.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:117:20</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">44</span><span class="token plain">      at IncomingMessage.</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token plain">anonymous</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/node_modules/request/request.js:1258:12</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">45</span><span class="token plain">      at IncomingMessage.emit </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">events.js:117:20</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">46</span><span class="token plain">      at _stream_readable.js:943:16</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">47</span><span class="token plain">      at process._tickCallback </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">node.js:419:13</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">48</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">49</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">50</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">51</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">52</span><span class="token plain">Writing coverage object </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/coverage/coverage.json</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">53</span><span class="token plain">Writing coverage reports at </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/coverage</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">54</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">55</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">56</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> Coverage summary </span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">57</span><span class="token plain">Statements   </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">29</span><span class="token plain">/29 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">58</span><span class="token plain">Branches     </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain">/6 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">59</span><span class="token plain">Functions    </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain">/3 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">60</span><span class="token plain">Lines        </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">29</span><span class="token plain">/29 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">61</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">62</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">63</span><span class="token plain">Warning: Task </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> failed. Use --force to continue.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">64</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">65</span><span class="token plain">Aborted due to warnings.</span></div></pre></div></pre><p class="py-2">Now, let&#x27;s add our final route:</p><pre><div class="gatsby-highlight" data-language="javascript"><pre class="prism-code language-javascript" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token comment" style="color:#999999">// Define link route</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">app</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">route</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;/:id&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">all</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Get ID</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">var</span><span class="token plain"> id </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> req</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">params</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">trim</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">    </span><span class="token comment" style="color:#999999">// Look up the URL</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain">    client</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#8dc891">,</span><span class="token parameter"> reply</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain">        </span><span class="token keyword control-flow" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">!</span><span class="token plain">err </span><span class="token operator" style="color:#d7deea">&amp;&amp;</span><span class="token plain"> reply</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">            </span><span class="token comment" style="color:#999999">// Redirect user to it</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">            res</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">status</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">301</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">            res</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">set</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Location&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> reply</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">            res</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">send</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#c5a5c5">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">            </span><span class="token comment" style="color:#999999">// Confirm no such link in database</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">            res</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">status</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">404</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">            res</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">render</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;error&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span></div></pre></div></pre><p class="py-2">We accept the ID as a parameter in the URL. We trim off any whitespace around it, and then we query Redis for a URL with that ID. If we find one, we set the status code to 301, and the location to the URL, and send the response. Otherwise, we set the status to 404 and render the error view.</p><p class="py-2">Now, let&#x27;s check it passes:</p><pre><div class="gatsby-highlight" data-language="bash"><pre class="prism-code language-bash" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="line-number-style">1</span><span class="token plain">$ grunt </span><span class="token builtin class-name" style="color:#FAC863">test</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">2</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;jshint:all&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">jshint</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">3</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> files lint free.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">4</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">5</span><span class="token plain">Running </span><span class="token string" style="color:#8dc891">&quot;mocha_istanbul:coverage&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">mocha_istanbul</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> task</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">6</span><span class="token plain">Listening on port </span><span class="token number" style="color:#5a9bcf">5000</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">8</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">9</span><span class="token plain">  server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">10</span><span class="token plain">Starting the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">11</span><span class="token plain">    Test the index route</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">12</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a page with the title Shortbread </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">90ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">13</span><span class="token plain">    Test submitting a URL</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">14</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> the shortened URL </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">47ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">15</span><span class="token plain">    Test following a URL</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">16</span><span class="token plain">      ✓ should redirect the user to the shortened URL</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">17</span><span class="token plain">    Test following a non-existent-link</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">18</span><span class="token plain">      ✓ should </span><span class="token builtin class-name" style="color:#FAC863">return</span><span class="token plain"> a </span><span class="token number" style="color:#5a9bcf">404</span><span class="token plain"> error</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">19</span><span class="token plain">Stopping the server</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">20</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">21</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">22</span><span class="token plain">  </span><span class="token number" style="color:#5a9bcf">4</span><span class="token plain"> passing </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">191ms</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">23</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">24</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">25</span><span class="token plain">Writing coverage object </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/coverage/coverage.json</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">26</span><span class="token plain">Writing coverage reports at </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">/Users/matthewdaly/Projects/url-shortener/coverage</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">27</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">28</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">29</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> Coverage summary </span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">30</span><span class="token plain">Statements   </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">38</span><span class="token plain">/38 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">31</span><span class="token plain">Branches     </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">10</span><span class="token plain">/10 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">, </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"> ignored</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">32</span><span class="token plain">Functions    </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">5</span><span class="token plain">/5 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">33</span><span class="token plain">Lines        </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain">% </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">38</span><span class="token plain">/38 </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">34</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">35</span><span class="token plain"></span><span class="token operator" style="color:#d7deea">&gt;&gt;</span><span class="token plain"> Done. Check coverage folder.</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">36</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="line-number-style">37</span><span class="token plain">Done, without errors.</span></div></pre></div></pre><p class="py-2">Excellent! Our URL shortener is now complete. From here, deploying it to Heroku is straightforward - you&#x27;ll need to install the Redis to Go addon, and refer to Heroku&#x27;s documentation on deploying Node.js applications for more details.</p><h2 class="py-4 text-2xl font-bold">Wrapping up</h2><p class="py-2">You&#x27;ll find the source for this application <a href="https://github.com/matthewbdaly/Shortbread" class="border-b-2 border-green-400">here</a> and a demo <a href="http://shortbread-example.herokuapp.com/" class="border-b-2 border-green-400">here</a>.</p><p class="py-2">I hope you&#x27;ve enjoyed this brief introduction to Redis, and that it&#x27;s opened your eyes to at least one of the alternatives out there to a relational database. I&#x27;ll hopefully be able to follow this up with examples of some other problems Redis is ideal for solving.</p></section><hr/><div class="py-4"><a class="p-category" href="/blog/categories/node-js/"><span class="inline-block px-4 py-2 my-2 mr-2 text-sm font-bold text-gray-900 bg-purple-200 rounded-full hover:bg-purple-800 hover:text-gray-200 transition-colors duration-500">node.js</span></a><a class="p-category" href="/blog/categories/redis/"><span class="inline-block px-4 py-2 my-2 mr-2 text-sm font-bold text-gray-900 bg-purple-200 rounded-full hover:bg-purple-800 hover:text-gray-200 transition-colors duration-500">redis</span></a></div><nav class="pt-4 clear-both box-border"><a rel="prev" class="float-left w-1/2 p-2 shadow-sm hover:bg-gray-200 dark:hover:bg-gray-800 transition duration-300 ease-in-out" href="/blog/2014/10/19/my-django-web-server-setup/"><p><strong class="font-bold clear-both">← Previous page</strong></p><p class="pl-6">My Django web server setup</p></a><a rel="next" class="float-right w-1/2 p-2 shadow-sm hover:bg-gray-200 dark:hover:bg-gray-800 transition duration-300 ease-in-out" href="/blog/2014/12/28/my-first-grunt-plugin/"><p><strong>→ Next page</strong></p><p class="pl-6">My first Grunt plugin</p></a></nav><div id="disqus_thread"></div></article></main></div><footer class="w-full p-4 text-gray-100 bg-gray-800"><ul class="flex flex-row flex-wrap justify-center w-full p-2 mx-auto text-center md:w-2/3 box-border"><li class="w-1/3 my-2 md:w-1/5"><a href="/posts/1">Blog</a></li><li class="w-1/3 my-2 md:w-1/5"><a href="/about">About</a></li><li class="w-1/3 my-2 md:w-1/5"><a href="https://twitter.com/mattbd">Twitter</a></li><li class="w-1/3 my-2 md:w-1/5"><a href="https://github.com/matthewbdaly">Github</a></li><li class="w-1/3 my-2 md:w-1/5"><a href="/rss.xml">Feed</a></li></ul><div class="w-full p-4 mx-auto text-center md:w-2/3"><p>© Matthew Daly <!-- -->2021</p></div></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-17043630-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2014/11/09/building-a-url-shortener-with-node-dot-js-and-redis/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-31be65513fba52a5a50c.js"],"app":["/app-5e95bfecb5da57fd1ffa.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-e15fb7b4e4c3e068158e.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-a8bec21bd19e150cd447.js"],"component---src-pages-search-tsx":["/component---src-pages-search-tsx-de35131b8b54d707dd3c.js"],"component---src-templates-404-tsx":["/component---src-templates-404-tsx-1e9ca5e77d61c162fbb8.js"],"component---src-templates-archives-tsx":["/component---src-templates-archives-tsx-df7825ea34c62a098040.js"],"component---src-templates-categories-tsx":["/component---src-templates-categories-tsx-151c44ef3edeea819ec2.js"],"component---src-templates-category-tsx":["/component---src-templates-category-tsx-249488b5bc3e35b8519c.js"],"component---src-templates-chunk-tsx":["/component---src-templates-chunk-tsx-e37127127dfaebd5f552.js"],"component---src-templates-page-tsx":["/component---src-templates-page-tsx-43a798b7c40f1e0cff4e.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-493c03ff50c97c3525f1.js"]};/*]]>*/</script><script src="/polyfill-31be65513fba52a5a50c.js" nomodule=""></script><script src="/component---src-templates-post-tsx-493c03ff50c97c3525f1.js" async=""></script><script src="/7840d69eefded84ab93ff6e879351e9a3a16821f-3cc77dc4aa7437d407dd.js" async=""></script><script src="/15a3be27178e285ff113e12c60c30466a8f4d4c5-26cc17c8e4fe76c4927b.js" async=""></script><script src="/e87769ff526c098a69bffbfff9ee9d57397fcb93-49d3f7242fa2c053e36d.js" async=""></script><script src="/f0e45107-763177929e8eed3c13bb.js" async=""></script><script src="/app-5e95bfecb5da57fd1ffa.js" async=""></script><script src="/532a2f07-672258f0b4da4ed2ff53.js" async=""></script><script src="/framework-cb6229a8adb5817307a4.js" async=""></script><script src="/webpack-runtime-88d477ac36829d76e952.js" async=""></script></body></html>